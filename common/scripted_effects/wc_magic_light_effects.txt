init_light_spells_effect = {
    add_to_global_variable_list = { name = light_spells target = flag:flash_of_light }
    add_to_global_variable_list = { name = light_spells target = flag:dispel }
    add_to_global_variable_list = { name = light_spells target = flag:holy_fire }
    add_to_global_variable_list = { name = light_spells target = flag:lightwell }
}

cast_flash_of_light_effect = { # Refer to Dispel sheet
    if = {
        limit = { exists = var:flash_of_light_recipient }
        var:flash_of_light_recipient = {
            save_temporary_scope_as = this_recipient
        }
    }
    else_if = {
        limit = {
            exists = var:current_spell_name
            var:current_spell_name = flag:flash_of_light
            exists = var:spellbook_open
            exists = var:spell_recipient
        }
        var:spell_recipient = {
            save_temporary_scope_as = this_recipient
        }
    }
    if = {
        limit = {
            exists = scope:this_recipient
        }
        # Look at ranks first
        if = {
            limit = {
                OR = { # current_spell_rank is for tooltips
                    AND = {
                        exists = var:flash_of_light_rank
                        var:flash_of_light_rank = 3
                    }
                    AND = {
                        exists = var:current_spell_rank
                        var:current_spell_rank = 3
                    }
                }
            }
            scope:this_recipient = {
                wc_dispel_template_effect = {
                    MAGIC_ILLNESS = "yes"
                    MAJOR_ILLNESS = "yes"
                    MAGIC_INJURY = "no"
                    MAJOR_INJURY = "no"
                    POISON = "no"
                    PSYCH_ILLNESS = "no"
                    ILLNESS = "no"
                    INJURY = "no"
                    REDUCE_SEVERITY = "yes"
                }
            }
        }
        else_if = {
            limit = {
                OR = {
                    AND = {
                        exists = var:flash_of_light_rank
                        var:flash_of_light_rank = 2
                    }
                    AND = {
                        exists = var:current_spell_rank
                        var:current_spell_rank = 2
                    }
                }
            }
            scope:this_recipient = {
                wc_dispel_template_effect = {
                    MAGIC_ILLNESS = "no"
                    MAJOR_ILLNESS = "no"
                    MAGIC_INJURY = "yes"
                    MAJOR_INJURY = "no"
                    POISON = "no"
                    PSYCH_ILLNESS = "no"
                    ILLNESS = "yes"
                    INJURY = "no"
                    REDUCE_SEVERITY = "yes"
                }
            }
        }
        else_if = {
            limit = {
                OR = {
                    AND = {
                        exists = var:flash_of_light_rank
                        var:flash_of_light_rank = 1
                    }
                    AND = {
                        exists = var:current_spell_rank
                        var:current_spell_rank = 1
                    }
                }
            }
            scope:this_recipient = {
                wc_dispel_template_effect = {
                    MAGIC_ILLNESS = "no"
                    MAJOR_ILLNESS = "no"
                    MAGIC_INJURY = "no"
                    MAJOR_INJURY = "no"
                    POISON = "no"
                    PSYCH_ILLNESS = "no"
                    ILLNESS = "no"
                    INJURY = "yes"
                    REDUCE_SEVERITY = "yes"
                }
            }
        }
        
    }

}

cast_dispel_effect = {
    if = {
        limit = { exists = var:flash_of_light_recipient }
        var:flash_of_light_recipient = {
            save_temporary_scope_as = this_recipient
        }
    }
    else_if = {
        limit = {
            exists = var:current_spell_name
            var:current_spell_name = flag:flash_of_light
            exists = var:spellbook_open
            exists = var:spell_recipient
        }
        var:spell_recipient = {
            save_temporary_scope_as = this_recipient
        }
    }

    scope:this_recipient ?= {
        random_list = {
            0 = {
                modifier = { add = 1 has_character_modifier = wc_burnout_modifier }
                remove_character_modifier = wc_burnout_modifier
            }
            0 = {
                modifier = { add = 1 has_character_modifier = wc_frostbolt_modifier }
                remove_character_modifier = wc_frostbolt_modifier
            }
            0 = {
                modifier = { add = 1 has_character_modifier = wc_blizzard_character_modifier }
                remove_character_modifier = wc_blizzard_character_modifier
            }
            0 = {
                modifier = { add = 1 has_character_modifier = wc_frost_nova_modifier }
                remove_character_modifier = wc_frost_nova_modifier
            }
            0 = {
                modifier = { add = 1 has_character_modifier = wc_slow_modifier }
                remove_character_modifier = wc_slow_modifier
            }
            0 = {
                modifier = { add = 1 has_character_modifier = wc_arcane_dome_character_modifier }
                remove_character_modifier = wc_arcane_dome_character_modifier
            }
        }
    }
}

cast_holy_light_effect = {}
cast_holy_fire_effect = {}