wc_blizzard_county_pulse = {
    effect = {
        if = {
            limit = {
                has_county_modifier = wc_blizzard_county_modifier
            }

            every_in_de_jure_hierarchy = {
                limit = {
                    tier = tier_barony
                }
                title_province = {
                    every_character_in_location = {
                        limit = {
                            NOT = {
                                has_character_modifier = wc_blizzard_character_modifier
                            }
                        }
                        apply_character_blizzard_effect = yes
                    }
                }
            }

            trigger_event = {
                on_action = wc_blizzard_county_pulse
                months = 1
            }
        }
    }
}

wc_blizzard_removal_pulse = {
    effect = {
        if = {
            limit = {
                has_character_modifier = wc_blizzard_character_modifier
            }

            if = {
                limit = {
                    exists = location.county
                    location.county = {
                        NOT = {
                            has_county_modifier = wc_blizzard_county_modifier
                        }
                    }
                }

                remove_character_modifier = wc_blizzard_character_modifier
            }
            else = {
                trigger_event = {
                    on_action = wc_blizzard_removal_pulse
                    months = 1
                }
            }
        }
    }
}

on_join_court_blizzard = {
    effect = {
        if = {
            limit = {
                exists = location.county
                location.county = { has_county_modifier = wc_blizzard_county_modifier }
                NOT = {
                    has_character_modifier = wc_blizzard_character_modifier
                }
            }
            apply_character_blizzard_effect = yes
        }
        else_if = {
            limit = {
                exists = location.county
                has_character_modifier = wc_blizzard_character_modifier
            }
            remove_character_modifier = wc_blizzard_character_modifier
        }
    }
}

wc_evocation_province_pulse = {
    effect = {
        if = {
            limit = {
                has_province_modifier = wc_evocation_province_modifier
            }

            every_character_in_location = {
                limit = {
                    NOT = {
                        has_character_modifier = wc_evocation_character_modifier
                    }
                }
                apply_character_evocation_effect = yes
            }

            trigger_event = {
                on_action = wc_evocation_province_pulse
                months = 1
            }
        }
    }
}

wc_evocation_removal_pulse = {
    effect = {
        if = {
            limit = {
                has_character_modifier = wc_evocation_character_modifier
            }

            if = {
                limit = {
                    exists = location
                    location = {
                        NOT = {
                            has_province_modifier = wc_evocation_province_modifier
                        }
                    }
                }

                remove_character_modifier = wc_evocation_character_modifier
            }
            else = {
                trigger_event = {
                    on_action = wc_evocation_removal_pulse
                    months = 1
                }
            }
        }
    }
}

wc_arcane_dome_county_pulse = {
    effect = {
        if = {
            limit = {
                has_county_modifier = wc_arcane_dome_county_modifier
            }

            save_scope_as = county

            every_in_de_jure_hierarchy = {
                limit = {
                    tier = tier_barony
                }
                title_province = {
                    every_army_in_location = {
                        save_scope_as = army
                        if = {
                            limit = {
                                NOT = {
                                    army_commander = {
                                        has_character_modifier = wc_arcane_dome_character_modifier
                                    }
                                }

                                NOR = {
                                    scope:county.holder = {
                                        OR = {
                                            any_ally = {
                                                any_army = {
                                                    army_commander = scope:army.army_commander
                                                }
                                            }
                                            any_war_ally = {
                                                any_army = {
                                                    army_commander = scope:army.army_commander
                                                }
                                            }
                                        }
                                    }
                                    army_commander = { target_is_liege_or_above = scope:county.holder }
                                    army_commander = { target_is_vassal_or_below = scope:county.holder }
                                    army_commander = scope:county.holder
                                    army_owner = { target_is_liege_or_above = scope:county.holder }
                                    army_owner = { target_is_vassal_or_below = scope:county.holder }
                                    army_owner = scope:county.holder
                                }
                            }

                            army_commander = {
                                apply_character_arcane_dome_effect = yes
                            }
                        }
                    }
                }
            }

            trigger_event = {
                on_action = wc_arcane_dome_county_pulse
                months = 1
            }
        }
    }
}

wc_arcane_dome_removal_pulse = {
    effect = {
        if = {
            limit = {
                has_character_modifier = wc_arcane_dome_character_modifier
            }

            if = {
                limit = {
                    exists = location.county
                    OR = {
                        location.county = {
                            NOT = {
                                has_county_modifier = wc_arcane_dome_county_modifier
                            }
                        }

                        OR = {
                            location.county.holder = {
                                OR = {
                                    any_ally = {
                                        any_army = {
                                            army_commander = scope:army.army_commander
                                        }
                                    }
                                    any_war_ally = {
                                        any_army = {
                                            army_commander = scope:army.army_commander
                                        }
                                    }
                                }
                            }
                            army_commander = { target_is_liege_or_above = location.county.holder }
                            army_commander = { target_is_vassal_or_below = location.county.holder }
                            army_commander = location.county.holder
                            army_owner = { target_is_liege_or_above = location.county.holder }
                            army_owner = { target_is_vassal_or_below = location.county.holder }
                            army_owner = location.county.holder
                        }
                    }
                }

                remove_character_arcane_dome_effect = yes
            }
            else = {
                trigger_event = {
                    on_action = wc_arcane_dome_removal_pulse
                    months = 1
                }
            }
        }
    }
}

on_join_court_evocation = {
    effect = {
        if = {
            limit = {
                exists = location
                location = { has_province_modifier = wc_evocation_province_modifier }
                NOT = {
                    has_character_modifier = wc_evocation_character_modifier
                }
            }
            apply_character_evocation_effect = yes
        }
        else_if = {
            limit = {
                exists = location.county
                has_character_modifier = wc_evocation_character_modifier
            }
            remove_character_modifier = wc_evocation_character_modifier
        }
    }
}