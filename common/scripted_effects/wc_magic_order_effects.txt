init_order_spells_effect = {
    add_to_global_variable_list = { name = order_spells target = flag:scorch }
}

cast_scorch_effect = {
    if = {
        limit = { exists = var:scorch_recipient }
        var:scorch_recipient = {
            save_scope_as = this_recipient
        }
    }
    else_if = {
        limit = {
            exists = var:current_spell_name
            var:current_spell_name = flag:scorch
            exists = var:spellbook_open
            exists = var:spell_recipient
        }
        var:spell_recipient = {
            save_scope_as = this_recipient
        }
    }

    scope:this_recipient = {
        if = { # cannot do a random knight because tooltip and effect will differ.
            limit = {
                NOT = { has_trait = burned_3 }
            }
            save_scope_value_as = {
                name = spell_dodge_chance
                value = wc_order_fire_magic_resistance_dodge_value
            }
            random_list = {
                100 = {
                    if = {
                        limit = {
                            NOT = { has_trait = burned_1 }
                        }
                        add_trait = burned_1
                    }
                    else = {
                        if = {
                            limit = {
                                has_trait = burned_1
                            }
                            remove_trait = burned_1
                            add_trait = burned_2
                        }
                        else_if = {
                            limit = {
                                has_trait = burned_2
                            }
                            remove_trait = burned_2
                            add_trait = burned_3
                        }
                    }
                    add_opinion = {
                        modifier = wc_burned_me
                        target = root
                    }
                }
                20 = {
                    custom_tooltip = wc_scorch_resist_tt
                    modifier = {
                        is_alive = yes
                        add = scope:spell_dodge_chance
                    }
                    hidden_effect = {
                        root = {
                            send_interface_toast = {
                                title = wc_spell_dodged
                                left_icon = scope:this_recipient
                                right_icon = root
                                custom_tooltip = wc_scorch_dodge
                            }
                        }
                    }
                }
            }
        }
    }
}