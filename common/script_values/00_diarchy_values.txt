#############
# Diarchy Scripted Values
#############

##################################################
# General Values



##################################################
# Diarch Loyalty Values

diarch_loyalty_visibly_loyal_threshold = 75
diarch_loyalty_visibly_disloyal_threshold = 25

diarch_loyalty_score_add_minor_value = 10
diarch_loyalty_score_add_medium_value = 25
diarch_loyalty_score_add_major_value = 50
diarch_loyalty_score_add_massive_value = 200
diarch_loyalty_score_add_omega_value = 1000

diarch_loyalty_score_add_minor_gain = diarch_loyalty_score_add_minor_value
diarch_loyalty_score_add_medium_gain = diarch_loyalty_score_add_medium_value
diarch_loyalty_score_add_major_gain = diarch_loyalty_score_add_major_value
diarch_loyalty_score_add_massive_gain = diarch_loyalty_score_add_massive_value
diarch_loyalty_score_add_omega_gain = diarch_loyalty_score_add_omega_value

diarch_loyalty_score_add_minor_loss = {
	value = diarch_loyalty_score_add_minor_value
	multiply = -1
}
diarch_loyalty_score_add_medium_loss = {
	value = diarch_loyalty_score_add_medium_value
	multiply = -1
}
diarch_loyalty_score_add_major_loss = {
	value = diarch_loyalty_score_add_major_value
	multiply = -1
}
diarch_loyalty_score_add_massive_loss = {
	value = diarch_loyalty_score_add_massive_value
	multiply = -1
}
diarch_loyalty_score_add_omega_loss = {
	value = diarch_loyalty_score_add_omega_value
	multiply = -1
}

diarch_loyalty_score_type_regency_value = {
	### PLEASE NOTE ####
	# It's deliberate design that we don't double up on lots of values between loyalty and succession score (e.g., familial bonuses).
	# If the two values become too synced, then you'll either always be fine or else always be screwed. Neither of these are fun or interesting.
	# The intention is that societal ties govern your succession score whilst loyalty is more about personal relations and outlook (which is why we pepper in some traits and cultural traditions to break the score up a bit).

	if = {
		# For performance reasons, you'll sometimes check this when you don't have a liege, so we need to check beforehand for error purposes.
		limit = { exists = liege }
		# Add raw opinion.
		## Except don't because this throws errors and is broken — commented out till we can figure out a fix.
		#save_opinion_value_as = {
			#name = liege_opinion
			#target = liege
		#}
		#add = scope:liege_opinion
		## Instead, we do some dump placeholder script.
		#TODO_CD_EP2; please, I'm begging you. Think of the children. Fix the above. The below is disgusting.
		add = {
			desc = diarch_loyalty_score.regency.opinion_of_you
			value = calc_rough_liege_opinion_value
		}
		# High-Tier Relationships.
		## We don't take the basic tier relationships into account because they affect opinion heavily, and we don't want to double dip too much unless it seems important.
		## Good.
		if = {
			limit = {
				has_any_best_good_relationship_with_character_trigger = { CHARACTER = liege }
			}
			add = {
				desc = diarch_loyalty_score.regency.your_positive_relation
				value = diarch_loyalty_score_add_massive_gain
			}
		}
		## Bad.
		if = {
			limit = {
				has_any_worst_bad_relationship_with_character_trigger = { CHARACTER = liege }
			}
			add = {
				desc = diarch_loyalty_score.regency.your_negative_relation
				value = diarch_loyalty_score_add_massive_loss
			}
		}
		# Traits.
		## + Lazy.
		if = {
			limit = { has_trait = lazy }
			add = {
				desc = diarch_loyalty_score.regency.lazy
				value = diarch_loyalty_score_add_minor_gain
			}
		}
		## ++/-- Diligent.
		### ++ If they like you...
		else_if = {
			limit = {
				has_trait = diligent
				opinion = {
					target = liege
					value >= 1
				}
			}
			add = {
				desc = diarch_loyalty_score.regency.diligent.positive
				value = diarch_loyalty_score_add_medium_gain
			}
		}
		### -- If they dislike you...
		else_if = {
			limit = {
				has_trait = diligent
				opinion = {
					target = liege
					value <= -1
				}
			}
			add = {
				desc = diarch_loyalty_score.regency.diligent.negative
				value = diarch_loyalty_score_add_medium_loss
			}
		}
		### ... and perfectly-neutral diligent characters do nothing extra about it. They are ambivalent.
		## ++ Craven.
		if = {
			limit = { has_trait = craven }
			add = {
				desc = diarch_loyalty_score.regency.craven
				value = diarch_loyalty_score_add_medium_gain
			}
		}
		## ++ Honest.
		if = {
			limit = { has_trait = honest }
			add = {
				desc = diarch_loyalty_score.regency.honest
				value = diarch_loyalty_score_add_medium_gain
			}
		}
		## -- Deceitful.
		else_if = {
			limit = { has_trait = deceitful }
			add = {
				desc = diarch_loyalty_score.regency.deceitful
				value = diarch_loyalty_score_add_medium_loss
			}
		}
		## +++ Content.
		if = {
			limit = { has_trait = content }
			add = {
				desc = diarch_loyalty_score.regency.content
				value = diarch_loyalty_score_add_major_gain
			}
		}
		## --- Ambitious.
		else_if = {
			limit = { has_trait = ambitious }
			add = {
				desc = diarch_loyalty_score.regency.ambitious
				value = diarch_loyalty_score_add_major_loss
			}
		}
		## -- Arbitrary.
		if = {
			limit = { has_trait = arbitrary }
			add = {
				desc = diarch_loyalty_score.regency.arbitrary
				value = diarch_loyalty_score_add_medium_loss
			}
		}
		## ++ Just.
		else_if = {
			limit = { has_trait = just }
			add = {
				desc = diarch_loyalty_score.regency.just
				value = diarch_loyalty_score_add_medium_gain
			}
		}
		## --- Disloyal.
		if = {
			limit = { has_trait = disloyal }
			add = {
				desc = diarch_loyalty_score.regency.disloyal
				value = diarch_loyalty_score_add_major_loss
			}
		}
		## +++ Loyal.
		else_if = {
			limit = { has_trait = loyal }
			add = {
				desc = diarch_loyalty_score.regency.loyal
				value = diarch_loyalty_score_add_major_gain
			}
		}
		# Court Positions.
		## ++ Chief Eunuch.
		if = {
			limit = { has_court_position = chief_eunuch_court_position }
			add = {
				desc = diarch_loyalty_score.regency.chief_eunuch
				value = diarch_loyalty_score_add_medium_gain
			}
		}
		## ++ Chief Qadi.
		#if = {
		#	limit = { has_court_position = chief_qadi_court_position }
		#	add = {
		#		desc = diarch_loyalty_score.regency.chief_qadi
		#		value = diarch_loyalty_score_add_medium_gain
		#	}
		#}
		# Cultural Traditions.
		culture = {
			# +++ Malleable Subjects.
			if = {
				limit = { has_cultural_tradition = tradition_fp2_malleable_subjects }
				add = {
					desc = diarch_loyalty_score.regency.tradition_fp2_malleable_subjects
					value = diarch_loyalty_score_add_major_gain
				}
			}
			# +++ Recognition of Talent & lowborn.
			if = {
				limit = {
					has_cultural_tradition = tradition_talent_acquisition
					root = { is_lowborn = yes }
				}
				add = {
					desc = diarch_loyalty_score.regency.tradition_talent_acquisition
					value = diarch_loyalty_score_add_major_gain
				}
			}
			# ++/-- Astute Diplomats & they like or dislike their liege.
			if = {
				limit = { has_cultural_tradition = tradition_astute_diplomats }
				# If they like you, they work loyally.
				if = {
					limit = {
						root = {
							opinion = {
								target = liege
								value >= 1
							}
						}
					}
					add = {
						desc = diarch_loyalty_score.regency.tradition_astute_diplomats.positive
						value = diarch_loyalty_score_add_medium_gain
					}
				}
				# If they don't, they work against you.
				else_if = {
					limit = {
						root = {
							opinion = {
								target = liege
								value <= -1
							}
						}
					}
					add = {
						desc = diarch_loyalty_score.regency.tradition_astute_diplomats.negative
						value = diarch_loyalty_score_add_medium_loss
					}
				}
				# Else neutral, so they're ambivalent.
			}
			# ++ Ruling Caste & is liege.
			if = {
				limit = {
					root.liege.culture = {
						has_cultural_tradition = tradition_ruling_caste
						# But only apply it to diff-cultured characters.
						NOT = { this = root.culture }
					}
				}
				add = {
					desc = diarch_loyalty_score.regency.tradition_ruling_caste
					value = diarch_loyalty_score_add_medium_gain
				}
			}
			# ++ Family Business & extended family.
			if = {
				limit = {
					has_cultural_tradition = tradition_family_entrepreneurship
					root = { is_close_or_extended_family_of = liege }
				}
				add = {
					desc = diarch_loyalty_score.regency.tradition_family_entrepreneurship
					value = diarch_loyalty_score_add_medium_gain
				}
			}
			# + Hereditary Hierarchy.
			if = {
				limit = { has_cultural_tradition = tradition_hereditary_hierarchy }
				add = {
					desc = diarch_loyalty_score.regency.tradition_hereditary_hierarchy
					value = diarch_loyalty_score_add_minor_gain
				}
			}
			# + Tribal Unity & same-house.
			if = {
				limit = {
					has_cultural_tradition = tradition_tribe_unity
					exists = root.liege.house
					root.house ?= root.liege.house
				}
				add = {
					desc = diarch_loyalty_score.regency.tradition_tribe_unity
					value = diarch_loyalty_score_add_minor_gain
				}
			}
			# + Strong Kinship & same-house.
			if = {
				limit = {
					has_cultural_tradition = tradition_strong_kinship
					exists = root.liege.house
					root.house ?= root.liege.house
				}
				add = {
					desc = diarch_loyalty_score.regency.tradition_strong_kinship
					value = diarch_loyalty_score_add_minor_gain
				}
			}
			# +/- Chivalry & variable depending on "honour".
			if = {
				limit = { has_cultural_tradition = tradition_chivalry }
				# If dishonourable...
				if = {
					limit = {
						root.liege = {
							OR = {
								tyranny >= 1
								prestige_level <= 0
								has_any_shunned_or_criminal_trait_in_faith_trigger = {
									CHARACTER = liege
									FAITH = root.faith
								}
								# We avoid the actual ai_honour stat because it's a bit less exposed to the player.
							}
						}
					}
					add = {
						desc = diarch_loyalty_score.regency.tradition_chivalry.loss
						value = diarch_loyalty_score_add_minor_loss
					}
				}
				# Else, honourable enough.
				else = {
					add = {
						desc = diarch_loyalty_score.regency.tradition_chivalry.gain
						value = diarch_loyalty_score_add_minor_gain
					}
				}
			}
			# + Philosopher Culture & learning education.
			if = {
				limit = {
					has_cultural_tradition = tradition_philosopher_culture
					root = { has_trait = education_learning }
				}
				add = {
					desc = diarch_loyalty_score.regency.tradition_philosopher_culture
					value = diarch_loyalty_score_add_minor_gain
				}
			}
			# -1 (and only 1) if Vegetarian & liege isn't also vegetarian.
			## This one goes out to our dear D.M. for everything he's ever said at lunch.
			if = {
				limit = {
					has_cultural_tradition = tradition_vegetarianism
					# ^We're deliberately only checking culture rather than faith here - not wanting to mock religious convictions.
					root.liege = { is_vegetarian_trigger = no }
				}
				add = {
					desc = diarch_loyalty_score.regency.tradition_vegetarianism
					value = -1
				}
			}
			# -- Eye for an Eye.
			if = {
				limit = { has_cultural_tradition = tradition_eye_for_an_eye }
				add = {
					desc = diarch_loyalty_score.regency.tradition_eye_for_an_eye
					value = diarch_loyalty_score_add_medium_loss
				}
			}
			# -- Byzantine Traditions.
			if = {
				limit = { has_cultural_tradition = tradition_byzantine_succession }
				add = {
					desc = diarch_loyalty_score.regency.tradition_byzantine_succession
					value = diarch_loyalty_score_add_medium_loss
				}
			}
			# -- Warrior Culture & non-martially educated lieges.
			if = {
				limit = {
					has_cultural_tradition = tradition_warrior_culture
					root.liege = {
						NOR = {
							has_trait = education_martial
							has_focus = education_martial
						}
					}
				}
				add = {
					desc = diarch_loyalty_score.regency.tradition_warrior_culture
					value = diarch_loyalty_score_add_medium_loss
				}
			}
			# --- Practiced Pirates.
			if = {
				limit = { has_cultural_tradition = tradition_practiced_pirates }
				add = {
					desc = diarch_loyalty_score.regency.tradition_practiced_pirates
					value = diarch_loyalty_score_add_major_loss
				}
			}
			# --- Bound by Faith & different faiths.
			if = {
				limit = {
					has_cultural_tradition = tradition_faith_bound
					NOT = { root.faith = root.liege.faith }
				}
				add = {
					desc = diarch_loyalty_score.regency.tradition_faith_bound
					value = diarch_loyalty_score_add_major_loss
				}
			}
		}
		# Compassion if liege is helpless.
		if = {
			limit = {
				liege = {
					OR = {
						is_incapable = yes
						is_adult = no
					}
				}
			}
			add = {
				desc = diarch_loyalty_score.regency.compassion_for_helpless
				value = root.ai_compassion
			}
		}
		# Tyranny.
		if = {
			limit = { liege.tyranny >= 1 }
			add = {
				desc = diarch_loyalty_score.regency.tyranny
				value = {
					value = liege.tyranny
					multiply = -1
				}
			}
		}
		# Dread factors in in temporary regencies.
		if = {
			limit = {
				liege = {
					dread >= 1
					has_diarchy_active_parameter = diarchy_type_is_temporary_regency
				}
				has_dread_level_towards = {
	  				target = liege
	  				level >= 1
	  			}
			}
			add = {
				desc = diarch_loyalty_score.regency.temporary_regency.dread
				value = {
					value = liege.dread
					# Weight up if they're a basic natural coward.
					if = {
						limit = {
							has_dread_level_towards = {
				  				target = liege
				  				level >= 2
				  			}
						}
						multiply = 2
					}
				}
			}
		}
		# Overrides.
		## Everyone has a breaking point, so if they categorically hate you, we reduce it down.
		if = {
			limit = {
				opinion = {
					target = liege
					value <= -100
				}
				OR = {
					has_hook_of_type = {
						target = root
						type = loyalty_hook
					}
					has_hook_of_type = {
						target = root
						type = predecessor_loyalty_hook
					}
					ai_honor >= max_positive_honor
				}
			}
			add = {
				desc = diarch_loyalty_score.regency.override_negated
				value = diarch_loyalty_score_add_major_gain
			}
		}
		## Loyalty hooks of any kind mean the diarch will always be unfailingly loyal in their duties.
		### Standard loyalty.
		else_if = {
			limit = {
				liege = {
					has_hook_of_type = {
						target = root
						type = loyalty_hook
					}
				}
			}
			add = {
				desc = diarch_loyalty_score.regency.loyalty_hook.self
				value = diarch_loyalty_score_add_omega_gain
			}
		}
		### Predecessor loyalty.
		else_if = {
			limit = {
				liege = {
					has_hook_of_type = {
						target = root
						type = predecessor_loyalty_hook
					}
				}
			}
			add = {
				desc = diarch_loyalty_score.regency.loyalty_hook.predecessor
				value = diarch_loyalty_score_add_omega_gain
			}
		}
		## And, per request, if the character is unfailingly honourable then they will also always be loyal.
		else_if = {
			limit = { ai_honor >= max_positive_honor }
			add = {
				desc = diarch_loyalty_score.regency.ai_honour
				value = diarch_loyalty_score_add_omega_gain
			}
		}
	}
}

regent_loyal_after_death_hook_duration_years_value = {
	value = 21
	subtract = root.primary_heir.age
}

historic_regent_loyal_after_death_hook_duration_years_value = {
	value = 21
	subtract = age
}

##################################################
# Diarchy Succession Candidate Values

# These need to be whole numbers or the UI'll get _weird_.
miniscule_diarch_candidate_value = 1
minor_diarch_candidate_value = 2
medium_diarch_candidate_value = 6
major_diarch_candidate_value = 14
massive_diarch_candidate_value = 22
monumental_diarch_candidate_value = 33

miniscule_diarch_candidate_gain = miniscule_diarch_candidate_value
minor_diarch_candidate_gain = minor_diarch_candidate_value
medium_diarch_candidate_gain = medium_diarch_candidate_value
major_diarch_candidate_gain = major_diarch_candidate_value
massive_diarch_candidate_gain = massive_diarch_candidate_value
monumental_diarch_candidate_gain = monumental_diarch_candidate_value

miniscule_diarch_candidate_loss = {
	value = miniscule_diarch_candidate_value
	multiply = -1
}
minor_diarch_candidate_loss = {
	value = minor_diarch_candidate_value
	multiply = -1
}
medium_diarch_candidate_loss = {
	value = medium_diarch_candidate_value
	multiply = -1
}
major_diarch_candidate_loss = {
	value = major_diarch_candidate_value
	multiply = -1
}
massive_diarch_candidate_loss = {
	value = massive_diarch_candidate_value
	multiply = -1
}
monumental_diarch_candidate_loss = {
	value = monumental_diarch_candidate_value
	multiply = -1
}

hard_disable_diarch_candidate_value = -1000

diarchy_succession_court_type_baseline_value = 10

diarchy_regent_succession_score_value = {
	if = {
		# For performance reasons, you'll sometimes check this when you don't have a liege, so we need to check beforehand for error purposes.
		limit = { exists = liege }
		# We increase the importance of family if the liege is underage or an imbecile.
		if = {
			limit = {
				liege = {
					OR = {
						is_adult = no
						is_incapable = yes
					}
				}
				any_close_or_extended_family_member = { this = liege }
			}
			# Ruling characters  get a bit less, as they have other duties.
			if = {
				limit = { is_ruler = yes }
				add = {
					value = massive_diarch_candidate_gain
					desc = diarch_succession_score.regency.close_or_extended_family_of_invalid.ruler
				}
			}
			# Whereas non-rulers get a mega-boost, as they can be there all the time
			else = {
				add = {
					value = monumental_diarch_candidate_gain
					desc = diarch_succession_score.regency.close_or_extended_family_of_invalid.non_ruler
				}
			}
		}
		# Familial ties.
		## If you engage in hyper-incest and break your own regency succession, don't come crying to the devs. You have done this to yourself.
		add = {
			desc = diarch_succession_score.category.familial_ties
			# ADD SCORE
			## Is parent of
			if = {
				limit = { is_parent_of = liege }
				add = {
					value = massive_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_parent
				}
			}
			## Is child of
			if = {
				limit = { is_child_of = liege }
				add = {
					value = major_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_child
				}
			}
			## Is sibling of
			if = {
				limit = { is_sibling_of = liege }
				add = {
					value = major_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_sibling
				}
			}
			## Is grandparent of
			if = {
				limit = { is_grandparent_of = liege }
				add = {
					value = medium_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_grandparent
				}
			}
			## Is grandchild of
			if = {
				limit = { is_grandchild_of = liege }
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_grandchild
				}
			}
			## Is uncle/aunt of
			if = {
				limit = { is_uncle_or_aunt_of = liege }
				add = {
					value = medium_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_auntuncle
				}
			}
			## Is nibling of
			if = {
				limit = { is_nibling_of = liege }
				add = {
					value = medium_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_nibling
				}
			}
			## Is cousin of
			if = {
				limit = { is_cousin_of = liege }
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_cousin
				}
			}
			## Is great grandparent of
			if = {
				limit = { is_great_grandparent_of = liege }
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_greatgrandparent
				}
			}
			## Is great grandchild of
			if = {
				limit = { is_great_grandchild_of = liege }
				add = {
					value = miniscule_diarch_candidate_gain
					desc = diarch_succession_score.regency.yourgreat_grandchild
				}
			}
		}
		# Personal ties.
		add = {
			desc = diarch_succession_score.category.personal_ties
			# ADD SCORE
			## Is your heir
			if = {
				limit = {
					exists = liege.primary_heir
					this = liege.primary_heir
				}
				add = {
					value = massive_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_heir
				}
			}
			## Is spouse of
			if = {
				limit = { is_spouse_of = liege }
				add = {
					value = massive_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_spouse
				}
			}
			## Is guardian of
			if = {
				limit = { has_relation_ward = liege }
				add = {
					value = massive_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_ward
				}
			}
			## Has a seat in your council
			if = {
				limit = { is_councillor_of = liege }
				add = {
					value = medium_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_councillor
				}
			}
			## Is powerful vassal of
			if = {
				limit = { is_powerful_vassal = yes }
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_powerful_vassal
				}
			}
			## Has positive opinion
			if = {
				limit = {
					opinion = {
						target = liege
						value >= medium_positive_opinion
					}
				}
				add = {
					value = miniscule_diarch_candidate_gain
					desc = diarch_succession_score.regency.likes_you
				}
			}
			## Has positive relationship
			if = {
				limit = {
					has_any_moderate_good_relationship_with_character_trigger = { CHARACTER = liege }
				}
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_positive_relation
				}
			}
			# REMOVE SCORE
			## Is your nemesis
			if = {
				limit = {
					has_any_worst_bad_relationship_with_character_trigger = { CHARACTER = liege }
				}
				add = {
					value = major_diarch_candidate_loss
					desc = diarch_succession_score.regency.your_nemesis
				}
			}
			## Has a moderate bad relationship
			if = {
				limit = {
					has_any_only_moderate_bad_relationship_with_character_trigger = { CHARACTER = liege }
				}
				add = {
					value = medium_diarch_candidate_loss
					desc = diarch_succession_score.regency.your_negative_relation
				}
			}
			## Has negative opinion
			if = {
				limit = {
					opinion = {
						target = liege
						value <= medium_negative_opinion
					}
				}
				add = {
					value = miniscule_diarch_candidate_loss
					desc = diarch_succession_score.regency.dislikes_you
				}
			}
		}
		# Societal bonds.
		add = {
			desc = diarch_succession_score.category.societal_bonds
			# ADD SCORE
			## Is in your house
			if = {
				limit = {
					exists = house
					house = liege.house
				}
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_house
				}
			}
			## Is in your dynasty
			if = {
				limit = {
					exists = house
					# Filter out same-house chars to avoid double-dipping.
					NOT = { house = liege.house }
					# So we _only_ want same dynasty chars.
					dynasty = liege.dynasty
				}
				add = {
					value = miniscule_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_dynasty
				}
			}
			## Has same faith
			if = {
				limit = { faith = liege.faith }
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_faith
				}
			}
			## Is of same culture
			if = {
				limit = { culture = liege.culture }
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.your_culture
				}
			}
		}
		# Royal court.
		if = {
			limit = {
				liege = { has_royal_court = yes }
			}
			add = {
				desc = diarch_succession_score.category.royal_court
				# ADD SCORE
				## Skill for court type.
				### Diplomacy.
				if = {
					limit = {
						liege = { has_court_type = court_diplomatic }
					}
					add = {
						value = diplomacy
						# Then we subtract the baseline so that your skill has to matter.
						subtract = diarchy_succession_court_type_baseline_value
						desc = diarch_succession_score.regency.court_type.diplomacy
					}
				}
				### Martial.
				if = {
					limit = {
						liege = { has_court_type = court_warlike }
					}
					add = {
						value = martial
						# Then we subtract the baseline so that your skill has to matter.
						subtract = diarchy_succession_court_type_baseline_value
						desc = diarch_succession_score.regency.court_type.martial
					}
				}
				### Stewardship.
				if = {
					limit = {
						liege = { has_court_type = court_administrative }
					}
					add = {
						value = stewardship
						# Then we subtract the baseline so that your skill has to matter.
						subtract = diarchy_succession_court_type_baseline_value
						desc = diarch_succession_score.regency.court_type.stewardship
					}
				}
				### Intrigue.
				if = {
					limit = {
						liege = { has_court_type = court_intrigue }
					}
					add = {
						value = intrigue
						# Then we subtract the baseline so that your skill has to matter.
						subtract = diarchy_succession_court_type_baseline_value
						desc = diarch_succession_score.regency.court_type.intrigue
					}
				}
				### Learning.
				if = {
					limit = {
						liege = { has_court_type = court_scholarly }
					}
					add = {
						value = learning
						# Then we subtract the baseline so that your skill has to matter.
						subtract = diarchy_succession_court_type_baseline_value
						desc = diarch_succession_score.regency.court_type.learning
					}
				}
				### Prowess.
				if = {
					limit = {
						liege = { has_court_type = court_tribal }
					}
					add = {
						value = prowess
						# Then we subtract the baseline so that your skill has to matter.
						subtract = diarchy_succession_court_type_baseline_value
						desc = diarch_succession_score.regency.court_type.prowess
					}
				}
				## Speaks court language.
				if = {
					limit = { knows_court_language_of = liege }
					add = {
						value = major_diarch_candidate_gain
						desc = diarch_succession_score.regency.speaks_court_language
					}
				}
			}
		}
		# Traits.
		add = {
			desc = diarch_succession_score.category.traits
			# ADD SCORE
			## Ambitious trait
			if = {
				limit = { has_trait = ambitious }
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.ambitious
				}
			}
			## Diligent trait
			if = {
				limit = { has_trait = diligent }
				add = {
					value = minor_diarch_candidate_gain
					desc = diarch_succession_score.regency.diligent
				}
			}
			# REMOVE SCORE
			## Lazy trait
			if = {
				limit = { has_trait = lazy }
				add = {
					value = minor_diarch_candidate_loss
					desc = diarch_succession_score.regency.lazy
				}
			}
			## Humble trait
			if = {
				limit = { has_trait = humble }
				add = {
					value = minor_diarch_candidate_loss
					desc = diarch_succession_score.regency.humble
				}
			}
			## Content trait
			if = {
				limit = { has_trait = content }
				add = {
					value = minor_diarch_candidate_loss
					desc = diarch_succession_score.regency.content
				}
			}
		}
		# Circumstances.
		add = {
			desc = diarch_succession_score.category.circumstances
			# REMOVE SCORE
			## Has a critical illness
			if = {
				limit = { has_serious_disease_trigger = yes }
				add = {
					value = major_diarch_candidate_loss
					desc = diarch_succession_score.regency.cripplingly_ill
				}
			}
			## Has severe wounds
			if = {
				limit = { has_trait = wounded_3 }
				add = {
					value = medium_diarch_candidate_loss
					desc = diarch_succession_score.regency.badly_wounded
				}
			}
			## Has a criminal reason.
			if = {
				limit = {
					liege = {
						OR = {
							has_imprisonment_reason = root
							has_banish_reason = root
							has_execute_reason = root
							has_revoke_title_reason = root
						}
					}
				}
				add = {
					value = medium_diarch_candidate_loss
					desc = diarch_succession_score.regency.known_criminal
				}
			}
			## Under the age of 25
			if = {
				limit = { age <= 25 }
				add = {
					value = minor_diarch_candidate_loss
					desc = diarch_succession_score.regency.very_young
				}
			}
			## High-stress characters
			if = {
				limit = { stress_level  >= 1 }
				add = {
					value = minor_diarch_candidate_loss
					desc = diarch_succession_score.regency.stressed_out
				}
			}
			## Bastard / Child of Concubine
			if = {
				limit = {
					OR = {
						has_trait = bastard
						has_trait = child_of_concubine
					}
				}
				add = {
					value = miniscule_diarch_candidate_loss
					desc = diarch_succession_score.regency.illegitimate
				}
			}
			## Has a minor illness
			if = {
				limit = { has_trait = ill }
				add = {
					value = miniscule_diarch_candidate_loss
					desc = diarch_succession_score.regency.mildly_ill
				}
			}
			## Has a minor wound
			if = {
				limit = {
					OR = {
						has_trait = wounded_1
						has_trait = wounded_2
					}
				}
				add = {
					value = minor_diarch_candidate_loss
					desc = diarch_succession_score.regency.mildly_wounded
				}
			}
			## Doesn't speak your main language
			### Due to technical constraints, we can currently only check if you speak your liege's culture's language, not if you have any shared languages.
			if = {
				limit = {
					NOR = {
						knows_language_of_culture = liege.culture
						# Exempt family members so that we don't screw wrong-gendered unlanded chars over.
						is_close_or_extended_family_of = liege
					}
				}
				add = {
					value = major_diarch_candidate_loss
					desc = diarch_succession_score.regency.not_speak_language
				}
			}
		}
		# REMOVE CANDIDATES
		## Must be a vassal or in your court
		if = {
			limit = {
				exists = liege
				NOR = {
					is_ruler = yes
					is_courtier_of = liege
					host = liege
				}
			}
			add = {
				value = hard_disable_diarch_candidate_value
				desc = diarch_succession_score.regency.neither_vassal_nor_courtier
			}
		}
		## Must be an adult
		if = {
			limit = { is_adult = no }
			add = {
				value = hard_disable_diarch_candidate_value
				desc = diarch_succession_score.regency.child
			}
		}
		## Must not NOT imprisoned
		if = {
			limit = { is_imprisoned = yes }
			add = {
				value = hard_disable_diarch_candidate_value
				desc = diarch_succession_score.regency.imprisoned
			}
		}
		## Is NOT incapable or infirm
		if = {
			limit = {
				OR = {
					is_incapable = yes
					has_trait = infirm
				}
			}
			add = {
				value = hard_disable_diarch_candidate_value
				desc = diarch_succession_score.regency.incapable_or_infirm
			}
		}
	}
}

courtly_offence_at_succession_threshold_low = 15
courtly_offence_at_succession_threshold_medium = 30
courtly_offence_at_succession_threshold_high = 45

courtly_offence_scandalise_value = -60
courtly_offence_greatly_offend_value = -50
courtly_offence_offend_value = -40
courtly_offence_somewhat_offend_value = -20
courtly_offence_lightly_offend_value = -10

##################################################
# Character Interactions

diarch_ai_desire_plus_3_value = 50
diarch_ai_desire_plus_2_value = 30
diarch_ai_desire_plus_1_value = 10
diarch_ai_desire_minus_1_value = -10
diarch_ai_desire_minus_2_value = -30
diarch_ai_desire_minus_3_value = -50

liege_trust_diarch_trilateral_interaction_default_value = {
	# Base for players.
	value = 25
	# But if we've got AI on either side of us, who're nicely weighted to be considerate to their liege, be a little more trusting.
	if = {
		limit = {
			scope:actor = { is_ai = yes }
			scope:recipient = { is_ai = yes }
		}
		add = 75
	}
}

liege_diarchy_veto_prestige_cost_high = -250
liege_diarchy_veto_prestige_cost_medium = -150
liege_diarchy_veto_prestige_cost_low = -75

# Overall control values for keeping some vague level of parity between prestige surcharges for lieges in powerful diarchies.
liege_diarchy_surcharge_interaction_miniscule_value = minor_prestige_value
liege_diarchy_surcharge_interaction_minor_value = medium_prestige_value
liege_diarchy_surcharge_interaction_medium_value = 250
liege_diarchy_surcharge_interaction_major_value = major_prestige_value
liege_diarchy_surcharge_interaction_massive_value = 450

liege_diarchy_surcharge_interaction_revoke_title_interaction_value = {
	# Base value of zero, since this is free by default.
	value = {
		value = 0
		desc = BASE
	}

	# But, inside diarchies, there's a cost attached to various simple political actions.
	scope:actor = {
		if = {
			limit = { has_active_diarchy = yes }
			# Mild costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_mild }
				add = {
					value = liege_diarchy_surcharge_interaction_miniscule_value
					desc = IS_IN_DIARCHY_MILD_COSTS
				}
			}
			# Medium costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_medium }
				add = {
					value = liege_diarchy_surcharge_interaction_minor_value
					desc = IS_IN_DIARCHY_MEDIUM_COSTS
				}
			}
			# Major costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_major }
				add = {
					value = liege_diarchy_surcharge_interaction_medium_value
					desc = IS_IN_DIARCHY_MAJOR_COSTS
				}
			}
			# Massive costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_massive }
				add = {
					value = liege_diarchy_surcharge_interaction_massive_value
					desc = IS_IN_DIARCHY_MASSIVE_COSTS
				}
			}
		}
	}
}

liege_diarchy_surcharge_interaction_retract_vassal_interaction_value = {
	# Base value of zero, since this is free by default.
	value = {
		value = 0
		desc = BASE
	}

	# But, inside diarchies, there's a cost attached to various simple political actions.
	scope:actor = {
		if = {
			limit = { has_active_diarchy = yes }
			# Mild costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_mild }
				add = {
					value = liege_diarchy_surcharge_interaction_miniscule_value
					desc = IS_IN_DIARCHY_MILD_COSTS
				}
			}
			# Medium costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_medium }
				add = {
					value = liege_diarchy_surcharge_interaction_minor_value
					desc = IS_IN_DIARCHY_MEDIUM_COSTS
				}
			}
			# Major costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_major }
				add = {
					value = liege_diarchy_surcharge_interaction_medium_value
					desc = IS_IN_DIARCHY_MAJOR_COSTS
				}
			}
			# Massive costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_massive }
				add = {
					value = liege_diarchy_surcharge_interaction_major_value
					desc = IS_IN_DIARCHY_MASSIVE_COSTS
				}
			}
		}
	}
}

liege_diarchy_surcharge_interaction_imprison_interaction_value = {
	# Base value of zero, since this is free by default.
	value = {
		value = 0
		desc = BASE
	}

	# But, inside diarchies, there's a cost attached to various simple political actions.
	scope:actor = {
		if = {
			limit = { has_active_diarchy = yes }
			# Mild costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_mild }
				add = {
					value = liege_diarchy_surcharge_interaction_miniscule_value
					desc = IS_IN_DIARCHY_MILD_COSTS
				}
			}
			# Medium costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_medium }
				add = {
					value = liege_diarchy_surcharge_interaction_minor_value
					desc = IS_IN_DIARCHY_MEDIUM_COSTS
				}
			}
			# Major costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_major }
				add = {
					value = liege_diarchy_surcharge_interaction_medium_value
					desc = IS_IN_DIARCHY_MAJOR_COSTS
				}
			}
			# Massive costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_massive }
				add = {
					value = liege_diarchy_surcharge_interaction_major_value
					desc = IS_IN_DIARCHY_MASSIVE_COSTS
				}
			}
		}
	}
}

liege_diarchy_surcharge_interaction_execute_prisoner_interaction_value = {
	# Base value of zero, since this is free by default.
	value = {
		value = 0
		desc = BASE
	}

	# But, inside diarchies, there's a cost attached to various simple political actions.
	scope:actor = {
		if = {
			limit = { has_active_diarchy = yes }
			# Mild costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_mild }
				add = {
					value = liege_diarchy_surcharge_interaction_miniscule_value
					desc = IS_IN_DIARCHY_MILD_COSTS
				}
			}
			# Medium costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_medium }
				add = {
					value = liege_diarchy_surcharge_interaction_minor_value
					desc = IS_IN_DIARCHY_MEDIUM_COSTS
				}
			}
			# Major costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_major }
				add = {
					value = liege_diarchy_surcharge_interaction_medium_value
					desc = IS_IN_DIARCHY_MAJOR_COSTS
				}
			}
			# Massive costs.
			if = {
				limit = { has_diarchy_active_parameter = liege_pays_currency_surcharge_for_mundane_interactions_massive }
				add = {
					value = liege_diarchy_surcharge_interaction_major_value
					desc = IS_IN_DIARCHY_MASSIVE_COSTS
				}
			}
		}
	}

	# If our faith believes in HumSac, then this is a religious action and never costs prestige.
	if = {
		limit = {
			scope:actor.faith = { has_doctrine_parameter = human_sacrifice_active }
		}
		multiply = 0
	}
}

subsidised_liege_authority_discount_value = 0.5

legal_meddling_interaction_title_cost_value = {
	value = 0

	# Boost the value for duchies.
	if = {
		limit = {
			exists = scope:target
			scope:target.tier = tier_duchy
		}
		add = major_prestige_loss
	}
	# Even more for kingdoms.
	else_if = {
		limit = {
			exists = scope:target
			scope:target.tier = tier_kingdom
		}
		add = massive_prestige_loss
	}
	# Or else default back to counties.
	else = { add = medium_prestige_loss }
}

legal_meddling_interaction_title_discounted_cost_value = {
	value = legal_meddling_interaction_title_cost_value
	multiply = 0.5
	# Now make it neat.
	divide = 10
	round = yes
	multiply = 10
}

syphon_treasury_duel_target_value = {
	# We generally want to duel vs. the liege's stewardship...
	value = liege.stewardship
	# ... but in the interests of fairness, we put a floor on it.
	min = low_skill_rating
}

syphon_treasury_stewardship_very_high = very_high_skill_rating
syphon_treasury_stewardship_high = decent_skill_rating
syphon_treasury_stewardship_medium = mediocre_skill_rating

syphon_treasury_gold_gain_low = {
	value = 0
	add = scope:recipient.minor_gold_value
}
syphon_treasury_gold_gain_medium = {
	value = 0
	add = scope:recipient.medium_gold_value
}
syphon_treasury_gold_gain_high = {
	value = 0
	add = scope:recipient.major_gold_value
}
syphon_treasury_gold_gain_very_high = {
	value = 0
	add = scope:recipient.monumental_gold_value
}

syphon_treasury_recipient_county_tally = {
	value = 0
	# This gets used in a trigger and was being fussy about having effects in it, so we do it the manual way. Le sigh.
	scope:recipient = {
		# If scope:recipient has at least five counties, we add 5.
		if = {
			limit = {
				any_held_county = { count >= 5 }
			}
			add = 5
		}
		# Else 4.
		else_if = {
			limit = {
				any_held_county = { count >= 4 }
			}
			add = 4
		}
		# Else 3.
		else_if = {
			limit = {
				any_held_county = { count >= 3 }
			}
			add = 3
		}
		# Else 2.
		else_if = {
			limit = {
				any_held_county = { count >= 2 }
			}
			add = 2
		}
		# Else 1.
		else = { add = 1 }
	}
}

syphon_treasury_county_attribute_loss_fraction = {
	value = scope:county_attribute_loss
	scope:recipient = {
		# If scope:recipient has at least five counties, we divide by 5.
		if = {
			limit = {
				any_held_county = { count >= 5 }
			}
			multiply = 0.2
		}
		# Else 4.
		else_if = {
			limit = {
				any_held_county = { count >= 4 }
			}
			multiply = 0.25
		}
		# Else 3.
		else_if = {
			limit = {
				any_held_county = { count >= 3 }
			}
			multiply = 0.33
		}
		# Else 2.
		else_if = {
			limit = {
				any_held_county = { count >= 2 }
			}
			multiply = 0.5
		}
		# Else 1, so we do nothing.
	}
}

shift_privileges_interaction_target_cost_value = {
	value = 0

	# It's cheaper to attack higher tiers than lower ones.
	## So kingdoms are cheapest.
	if = {
		limit = { scope:recipient.highest_held_title_tier = tier_kingdom }
		add = medium_prestige_loss
	}
	## Then duchies.
	else_if = {
		limit = { scope:recipient.highest_held_title_tier = tier_duchy }
		add = major_prestige_loss
	}
	## And otherwise we default back to the humble county.
	else = { add = massive_prestige_loss }
}

shift_privileges_interaction_target_discounted_cost_value = {
	value = shift_privileges_interaction_target_cost_value
	multiply = 0.5
	# Now make it neat.
	divide = 10
	round = yes
	multiply = 10
}

shift_privileges_modifier_duration_value = 8

swing_scales_discounts_multiplier_value = {
	# Landless characters pay a fraction.
	if = {
		limit = { is_landed = no }
		value = 0.75
	}
	# Otherwise we give the AI mate's rates to encourage them to use the system.
	else_if = {
		limit = { is_ai = yes }
		value = 0.5
	}
	# Otherwise no discounts.
	else = { value = 1 }
}

swing_scales_prestige_cost_value = {
	value = 0
	# Gate by liege tier.
	## Count.
	if = {
		limit = { liege.highest_held_title_tier <= tier_county }
		add = minor_prestige_value
	}
	## Duke.
	else_if = {
		limit = { liege.highest_held_title_tier <= tier_duchy }
		add = medium_prestige_value
	}
	## King or Emperor
	else = { add = major_prestige_value }
}

swing_scales_piety_cost_value = {
	# Various ways to be charged piety.
	## Pure route.
	if = {
		limit = {
			OR = {
				always = scope:swing_piety
				# And if we're in the important_action...
				NOT = { exists = scope:swing_piety }
			}
		}
		value = 0
		# Gate by liege tier.
		## Count.
		if = {
			limit = { liege.highest_held_title_tier <= tier_county }
			add = minor_piety_value
		}
		## Duke.
		else_if = {
			limit = { liege.highest_held_title_tier <= tier_duchy }
			add = medium_piety_value
		}
		## King or Emperor
		else = { add = major_piety_value }
	}
	## Hybrid HoF route.
	else_if = {
		limit = { always = scope:swing_hof }
		value = 0
		# Gate by liege tier.
		## Count.
		if = {
			limit = { liege.highest_held_title_tier <= tier_county }
			add = minor_piety_value
		}
		## Duke.
		else_if = {
			limit = { liege.highest_held_title_tier <= tier_duchy }
			add = medium_piety_value
		}
		## King or Emperor
		else = { add = major_piety_value }
	}
}

swing_scales_cash_cost_value = {
	# Various ways to be charged piety.
	## Pure route.
	if = {
		limit = {
			OR = {
				always = scope:swing_gold
				# And if we're in the important action...
				NOT = { exists = scope:swing_gold }
			}
		}
		value = 0
		# Gate by liege tier.
		## Count.
		if = {
			limit = { liege.highest_held_title_tier <= tier_county }
			add = medium_gold_value
		}
		## Duke.
		else_if = {
			limit = { liege.highest_held_title_tier <= tier_duchy }
			add = major_gold_value
		}
		## King or Emperor
		else = { add = massive_gold_value }
	}
	## Hybrid HoF route.
	else_if = {
		limit = { always = scope:swing_hof }
		value = 0
		# Gate by liege tier.
		## Count.
		if = {
			limit = { liege.highest_held_title_tier <= tier_county }
			add = minor_gold_value
		}
		## Duke.
		else_if = {
			limit = { liege.highest_held_title_tier <= tier_duchy }
			add = medium_gold_value
		}
		## King or Emperor
		else = { add = major_gold_value }
	}
}

swing_scales_hof_actor_opinion_min_value = high_positive_opinion

swing_scales_hof_recipient_opinion_max_value = medium_positive_opinion

liege_dismiss_temporary_regency_interaction_dynasty_prestige_value = { value = medium_dynasty_prestige_gain }

liege_dismiss_entrenched_regency_interaction_dynasty_prestige_value = { value = major_dynasty_prestige_gain }

diarch_should_educate_liege_value = 50

##################################################
# Activities

diarch_reduced_strife_for_inviting_powerful_covassals_value = {
	value = 0
	every_attending_character = {
		limit = {
			NOT = { this = scope:host }
			is_powerful_vassal_of = scope:host.liege
		}
		add = -4
	}
}

##################################################
# Mandate Events

diarchy_1731_minimum_county_opinion_value = high_negative_opinion

##################################################
# Decisions

pv_overthrow_threshold_value = {
	value = 0
	# Grab our sum total of powerful vassals.
	liege = {
		every_powerful_vassal = { add = 1 }
	}
	# Halve it.
	multiply = 0.5
	# Now round down to even us out.
	floor = yes
	# And add +1 to get a simple majority.
	add = 1
	# ... but then subtract one if we're a powerful vassal, since we _won't_ be in the list but, naturally, support the coup.
	if = {
		limit = { is_powerful_vassal = yes }
		add = -1
	}
}

pv_overthrow_tally_value = {
	value = 0
	every_in_list = {
		variable = coup_pv_supporters_list
		limit = {
			is_powerful_vassal_of = root.liege
			is_alive = yes
		}
		add = 1
	}
}

# Display versions of the values: these are one higher to adjust for root potentially being in them.
pv_overthrow_threshold_display_value = {
	value = pv_overthrow_threshold_value
	# ... but then add back the one if we're a powerful vassal, since we _won't_ be in the list but, naturally, support the coup.
	if = {
		limit = { is_powerful_vassal = yes }
		add = 1
	}
}

pv_overthrow_tally_display_value = {
	value = pv_overthrow_tally_value
	# ... and remember to add one if we're a powerful vassal, since we _won't_ be in the list but, naturally, support the coup.
	## We have to separate out the values like this, since the actual list checks powerful vassals and we're not actually in it.
	if = {
		limit = { is_powerful_vassal = yes }
		add = 1
	}
}
