create_pandaria_decision = { # Create the Empire of Pandaria
	# Name and Flavor changes depending on race (Pandaren Empire, Mogu Empire, etc)
	# By Juke (juketm on discord)
	title = {
		first_valid = {
			# Mogu Empire
			triggered_desc = {
				trigger = { culture = { has_cultural_pillar = heritage_mogu } }
				desc = create_pandaria_decision.t.mogu
			}
			# Pandaren Empire
			triggered_desc = {
				trigger = { culture = { has_cultural_pillar = heritage_pandaren } }
				desc = create_pandaria_decision.t.pandaren
			}
			# Neutral
			desc = create_pandaria_decision.t.neutral
		}
	}
	desc = {
		first_valid = {
			# Mogu Empire
			triggered_desc = {
				trigger = { culture = { has_cultural_pillar = heritage_mogu } }
				desc = create_pandaria_decision.desc.mogu
			}
			# Pandaren Empire
			triggered_desc = {
				trigger = { culture = { has_cultural_pillar = heritage_pandaren } }
				desc = create_pandaria_decision.desc.pandaren
			}
			# Neutral
			desc = create_pandaria_decision.desc.neutral
		}
	}
	
	ai_check_interval = 120
	decision_group_type = major
	picture = { reference = "gfx/interface/illustrations/decisions/pandaren_fortress.dds" }
	selection_tooltip = create_pandaria_decision_tt

	is_shown = {
		is_independent_ruler = yes
		any_held_title = { # Must be in Pandaria Area
			tier = tier_county
			title_province = { geographical_region = world_pandaria }
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:create_pandaria_decision
			}
		}
	}

	cost = {					
		gold = 300
		prestige = 500
	}
	
	is_valid = {
		prestige_level >= 4
		has_title = title:e_kun_lai
		has_title = title:e_yulin
		has_title = title:e_banshan
		trigger_if = {
			limit = {
				exists = title:e_pandaria_empire.holder
				title:e_pandaria_empire.holder ?= {
					NOT = { this = ROOT }
					has_trait = thunder_king
				}
			}
			custom_tooltip = {
				text = create_pandaria_decision_thunder_king_defeated_tt
				always = no
			}
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_capable_adult = yes
		is_at_war = no
	}

	effect = {
		create_pandaria_decision_effect = yes
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

revive_lei_shen_decision = { # Revive the Thunder King
	# Bring back Lei Shen the Thunder King, to lead the Mogu into battle once more
	# By Juke (juketm on discord)
	
	ai_check_interval = 120
	decision_group_type = major
	picture = { reference = "gfx/interface/illustrations/decisions/thunder_king.dds" }
	selection_tooltip = revive_lei_shen_decision_tooltip

	is_shown = {
		is_independent_ruler = yes
		culture = { has_cultural_pillar = heritage_mogu }
		NAND = { # AI cant make it on that gamerule
			is_ai = yes
			has_game_rule = wc_thunder_king_crisis_never
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:revive_lei_shen_decision
			}
		}
	}

	cost = {
		prestige = {
			value = 500
			if = { # Free for AI
				limit = {
					is_ai = yes
				}
				multiply = 0
			}
		}
		piety = {
			value = 1000
			if = { # Free for AI
				limit = {
					is_ai = yes
				}
				multiply = 0
			}
		}
	}
	
	is_valid = {
		faith = faith:thunder_king
		custom_tooltip = {
			text = revive_lei_shen_decision_isle_of_thunder_tt
			completely_controls = title:k_lei_dao
		}
		custom_tooltip = {
			text = revive_lei_shen_decision_valley_of_emperors_tt
			completely_controls = title:d_howlingwind
		}
		custom_tooltip = {
			text = revive_lei_shen_decision_isle_of_reckoning_tt
			completely_controls = title:c_shangoalor
		}
		trigger_if = { # Easier for AI
			limit = { is_ai = no }
			province:1229 = { has_building_or_higher = throne_of_thunder_03 }
			has_trait = scholar
			piety_level >= 4
			learning >= 15
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_capable_adult = yes
		is_at_war = no
	}

	effect = {
		custom_tooltip = revive_lei_shen_decision.tt
		custom_tooltip = you_can_play_lei_shen.tt
		save_scope_as = reviver
		if = {
			limit = {
				prestige_level < 5
			}
			add_prestige_level = 1
		}
		
		hidden_effect = {
			# Can only happen once
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:revive_lei_shen_decision
			}
			
			# Upgrade Throne of Thunder for AI
			if = {
				limit = {
					NOT = {
						province:1229 = { has_building_or_higher = throne_of_thunder_03 }
					}
					is_ai = yes
				}
				province:1229 = { add_special_building = throne_of_thunder_04 }
			}
		
			# Trigger the Event
			trigger_event = pandaria_unification.0100
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

zandalari_lei_shen_decision  = { # Revive the Thunder King - Zandalari Version
	# Bring back Lei Shen the Thunder King, to be your ally in the south
	# By Juke (juketm on discord)
	
	ai_check_interval = 120
	decision_group_type = major
	picture = { reference = "gfx/interface/illustrations/decisions/thunder_king.dds" }
	selection_tooltip = zandalari_lei_shen_decision_tooltip

	is_shown = {
		is_independent_ruler = yes
		AND = {	# Zandalari
			culture = { has_cultural_pillar = heritage_zulite }
			NOR = {
				has_religion = religion:deathbringer
				has_religion = religion:doombringer
				has_religion = religion:shathgral
			}
			OR = {
				has_title = title:e_zandalari
				AND = {
					has_title = title:e_empire_of_zul
					capital_county = {
						title_province = { geographical_region = world_south_seas_zandalar } 
					}
				}
			}
		}
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:revive_lei_shen_decision
			}
		}
		NAND = { # AI cant make it on that gamerule
			is_ai = yes
			has_game_rule = wc_thunder_king_crisis_never
		}
	}

	cost = {
		prestige = {
			value = 500
			if = { # Free for AI
				limit = {
					is_ai = yes
				}
				multiply = 0
			}
		}
		piety = {
			value = 1000
			if = { # Free for AI
				limit = {
					is_ai = yes
				}
				multiply = 0
			}
		}
	}
	
	is_valid = {
		has_title = title:e_zandalari
		custom_tooltip = {
			text = revive_lei_shen_decision_isle_of_thunder_tt
			completely_controls = title:k_lei_dao
		}
		custom_tooltip = {
			text = revive_lei_shen_decision_valley_of_emperors_tt
			completely_controls = title:d_howlingwind
		}
		custom_tooltip = {
			text = revive_lei_shen_decision_isle_of_reckoning_tt
			completely_controls = title:c_shangoalor
		}
		trigger_if = { # Easier for AI
			limit = { is_ai = no }
			piety_level >= 3
			learning >= 15
		}
	}

	is_valid_showing_failures_only = {
		is_imprisoned = no
		is_capable_adult = yes
		is_at_war = no
	}

	effect = {
		custom_tooltip = zandalari_lei_shen_decision.tt
		custom_tooltip = you_can_play_lei_shen.tt
		save_scope_as = reviver
		if = {
			limit = {
				prestige_level < 5
			}
			add_prestige_level = 1
		}
		
		hidden_effect = {
			# Can only happen once
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:revive_lei_shen_decision
			}
			
			# Upgrade Throne of Thunder for AI
			if = {
				limit = {
					NOT = {
						province:1229 = { has_building_or_higher = throne_of_thunder_03 }
					}
					is_ai = yes
				}
				province:1229 = { add_special_building = throne_of_thunder_04 }
			}
		}
		
		trigger_event = pandaria_unification.0300
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}