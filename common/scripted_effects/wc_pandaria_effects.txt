thunder_king_effect = {
	ROOT = { save_scope_as = reviver }
	
	# Set up Titles
	create_title_and_vassal_change = {
		type = returned
		save_scope_as = change
		#add_claim_on_loss = no
	}
	title:k_lei_dao = {
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	title:d_lei_shen = {
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	title:c_lei_gong = {
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	title:c_huangjia = {
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	title:c_suzao = {
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	title:c_duanzao = {
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	title:c_zhengfu_zin = {
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	title:c_zhanshi = {
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	title:b_shandian = {
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	#scope:reviver = {
	#	every_held_title = {
	#		limit = { 
	#			tier = tier_empire
	#		}
	#		change_title_holder = {
	#			holder = scope:lei_shen
	#			change = scope:change
	#		}
	#	}
	#	add_trait = beauty_good_1
	#}
	
	scope:reviver = {
		every_held_title = {
			if = {
				limit = {
					tier = tier_empire
				}
				change_title_holder = {
					holder = scope:lei_shen
					change = scope:change
				}
			}
			else_if = {
				limit = {
					OR = {
						NOT = { exists = scope:secondary_title }
						tier > scope:secondary_title.tier
					}
				}
				save_temporary_scope_as = secondary_title
			}
		}
	}
	
	scope:reviver = {
		if = {
			limit = {
				exists = scope:secondary_title
			}
			every_vassal = {
				limit = {
					primary_title.tier >= scope:secondary_title.tier
					NOT = {
						primary_title.tier = tier_barony
					}
				}
				change_liege = {
					liege = scope:lei_shen
					change = scope:change
				}
			}
		}
	}
	
	scope:reviver = {
		change_liege = {
			liege = scope:lei_shen
			change = scope:change
		}
	}
	# If Pandaria isn't his already, get it
	if = {
		limit = {
			NOT = { has_title = title:e_pandaria_empire }
		}
		title:e_pandaria_empire = {
			change_title_holder = {
				holder = scope:lei_shen
				change = scope:change
			}
		}
	}
	
	title:e_pandaria_empire = {
		set_capital_county = title:c_lei_gong
	}
	
	resolve_title_and_vassal_change = scope:change
	
	set_primary_title_to = title:e_pandaria_empire
	
	#Set max authority
	if = {
		limit = { has_realm_law_flag = uses_crown_authority }
		add_realm_law = crown_authority_3
	}
	if = {
		limit = { has_realm_law_flag = uses_tribal_authority }
		add_realm_law = tribal_authority_3
	}
	if = {
		limit = { realm_law_use_dark_frenzy_trigger = yes }
		change_dark_frenzy_effect = { VALUE = 50 }
	}
	
	#Control Counties
	every_held_county = { change_county_control = 100 }
	province:1229 = {
		set_county_culture = culture:mogu
		set_county_faith = faith:thunder_king
	}
	
	# Summon Lei Shens trusted lieutenants!
	
	# Add hooks to loyal servant
	lei_shen_add_loyalty_hook_effect = { TARGET = scope:reviver }
	scope:reviver = {
		add_opinion = {
			modifier = became_vassal
			target = scope:lei_shen
			opinion = 50
		}
		if = {
			limit = {
				is_landed = no
			}
			set_employer = scope:lei_shen
		}
	}
}

lei_shen_create_court_effect = {
	### Resurrect Lei Shen's most trusted courtiers
	# Warlord Kao
	create_character = {
		template = warlord_kao
		save_scope_as = warlord_kao
	}
	scope:	 = { set_employer = root }
	lei_shen_add_loyalty_hook_effect = { TARGET = scope:warlord_kao }
	
	# Jin'rokh the Breaker
	create_character = {
		template = jin_rokh_the_breaker
		save_scope_as = jin_rokh_the_breaker
	}
	scope:jin_rokh_the_breaker = { set_employer = root }
	lei_shen_add_loyalty_hook_effect = { TARGET = scope:jin_rokh_the_breaker }
	
	# Iron Qon
	create_character = {
		template = iron_qon
		save_scope_as = iron_qon
	}
	scope:iron_qon = { set_employer = root }
	lei_shen_add_loyalty_hook_effect = { TARGET = scope:iron_qon }
	
	### The Twin Empyreans
	# Twin Empyrean Suen
	create_character = {
		template = twin_constort_suen
		save_scope_as = twin_constort_suen
	}
	scope:twin_constort_suen = { set_employer = root }
	#IF = {
	#	limit = {
	#		allowed_more_concubines = yes
	#	}
	#	make_concubine = scope:twin_constort_suen
	#	set_relation_lover = scope:twin_constort_suen
	#}
	marry = scope:twin_constort_suen
	
	# Twin Empyrean Lu'lin
	create_character = {
		template = twin_constort_lu_lin
		save_scope_as = twin_constort_lu_lin
	}
	scope:twin_constort_lu_lin = { set_employer = root }
	#IF = {
	#	limit = {
	#		allowed_more_concubines = yes
	#	}
	#	make_concubine = scope:twin_constort_lu_lin
	#	set_relation_lover = scope:twin_constort_lu_lin
	#}
	marry = scope:twin_constort_lu_lin
	scope:twin_constort_lu_lin = {
		set_relation_friend = scope:twin_constort_suen
	}
}

lei_shen_add_loyalty_hook_effect = {
	if = {
		limit = {
			can_add_hook = {
				target = $TARGET$
				type = loyalty_hook
			}
		}
		add_hook = {
			target = $TARGET$
			type = loyalty_hook
		}
	}
}

lei_shen_death_effect = {
	if = {
		NOT = { exists = player_heir }
		save_scope_as = lei_shen
		
		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
		}
		every_vassal = {
			limit = {
				highest_held_title_tier >= tier_county
			}
			change_liege_or_become_independent = {
				CHANGE = scope:change
				VASSAL = this
			}
		}
		every_vassal = {
			limit = { is_ai = no }
			send_interface_toast = {
				type = event_generic_neutral
				title = liege_primary_title_dissolution
				desc = liege_primary_title_dissolution_desc
				left_icon = scope:lei_shen
			}
		}
		
		resolve_title_and_vassal_change = scope:change
		
		every_held_title = {
			limit = {
				tier >= tier_kingdom
			}
			add_to_temporary_list = titles_to_destroy
		}

		every_in_list = {
			list = titles_to_destroy
			root = {
				destroy_title = prev
			}
		}
		
		every_player = {
			trigger_event = pandaria_unification.0200
		}
	}
}