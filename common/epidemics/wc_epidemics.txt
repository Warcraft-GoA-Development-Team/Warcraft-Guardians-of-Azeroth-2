undead_plague = {
	trait = undead_plague
	color = black
	priority = 10

	shader_data = {
		strength = 0.8
		edge_fade = 0.4
		tile_multiplier = 0.005
		texture_index = 0
		channel = red
	}

	name = {
		desc = epidemic_undead_scourge
	}
	
	on_start = {
		set_global_variable = {
			name = undead_scourge
			value = root
		}
		if = {
			limit = {
				outbreak_province = {
					has_variable = plaguer
				}
			}
			set_variable = {
				name = plaguer
				value = outbreak_province.var:plaguer
			}
			outbreak_province = {
				remove_variable = plaguer
			}
		}
		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}

	on_end = {
		if = {
			limit = { has_global_variable = scourge_of_lordaeron }
			remove_global_variable = scourge_of_lordaeron
			set_global_variable = scourge_of_lordaeron_has_happened
		}
		remove_global_variable = undead_scourge
	}
	
	on_monthly = {
		trigger_event = {
			on_action = epidemic_ongoing_events
		}
		trigger_event = {
			on_action = ongoing_scourge_plague_events
			days = 10
		}
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
		multiply = 0.05
	}

	can_infect_character = {
		has_being_trait_trigger = no
		can_contract_disease_trigger = { DISEASE = undead_plague }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}

	on_character_infected = {
		contract_disease_notify_effect = { DISEASE = undead_plague }

		if = {
			limit = {
				scope:epidemic = {
					has_variable = plaguer
				}
			}
			set_variable = {
				name = plaguer
				value = scope:epidemic.var:plaguer
			}
		}
	}

	infection_levels = {
		5 = {
			province_modifier = {
				monthly_county_control_decline_add = -1.0
				development_decline = -5
				levy_reinforcement_rate = -0.3
				levy_size = -0.25
				supply_limit_mult = -0.2
				county_opinion_add = -10
				epidemic_travel_danger = 20
			}	
		}
		40 = {
			province_modifier = {
				monthly_county_control_decline_add = -2.5
				development_decline = -7
				levy_reinforcement_rate = -0.5
				levy_size = -0.4
				supply_limit_mult = -0.5
				county_opinion_add = -25
				epidemic_travel_danger = 35
			}	
		}
		70 = {
			province_modifier = {
				monthly_county_control_decline_add = -3.5
				development_decline = -10
				levy_reinforcement_rate = -1
				levy_size = -0.5
				supply_limit_mult = -1
				county_opinion_add = -25
				epidemic_travel_danger = 55
			}
		}
	}

	outbreak_intensities = {
		apocalyptic = {
			notification = {
				global = yes
				holder_event = ""
				liege_event = ""
				realm_event = ""
			}
			
			outbreak_chance = {
				value = 0
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
				
				if = {
					limit = {
						has_global_variable = scourge_of_lordaeron
						NOT = {
							county.duchy = title:d_silverpine
							county.duchy = title:d_brill
							county.duchy = title:d_balnir
							county.duchy = title:d_deathknell
							county.duchy = title:d_hearthglen
							county.duchy = title:d_tyrs_hand
							county.duchy = title:d_andorhal
							county.duchy = title:d_darrowshire
							county.duchy = title:d_blackwood
							county.duchy = title:d_caer_darrow
							county.duchy = title:d_thondroril
						}
					}
					multiply = 0
				}
			}
			max_provinces = { 200 250 }

			infection_duration = {
				months = { 24 48 }
			}
			
			infection_progress_duration = {
				days = { 5 9 }
			}

			infection_recovery_duration = {
				days = { 80 120 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 10 }
			if = {
				limit = {
                    NOT = {
                        has_variable = active_infection_check
                    }
					NAND = {
						faith = scope:epidemic.var:plaguer.faith
						culture = scope:epidemic.var:plaguer.culture
					}
				}
				set_variable = active_infection_check
				trigger_event = { on_action = on_province_infected_by_undead }
			}
		}
		
		every_player = {
			if = {
				limit = {
					NOR = {
						any_owned_story = {
							story_type = story_cycle_scourge_plague
						}
						has_character_flag = scourge_plague_splash #zombies are in your realm
					}
				}
				create_story = story_cycle_scourge_plague
				trigger_event = {
					id = wc_scourge_plague.1001
					years = { 4 6 }
				}
			}
		}
	}
	
	on_province_recovered = {
		county = {
			remove_isolated_capital_modifiers_effect = yes
		}
	}
}