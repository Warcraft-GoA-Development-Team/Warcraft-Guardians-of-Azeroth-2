wc_recalculate_MAGIC_experience_effect = {
	if = {
		limit = { has_variable = wc_$MAGIC$_magic_experience_variable }

		if = {
			limit = {
				has_trait = user_of_$MAGIC$_magic_4
				var:wc_$MAGIC$_magic_experience_variable >= wc_magic_user_5_trait_exp_threshold_value
			}
			change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 }
			remove_variable = wc_$MAGIC$_magic_experience_variable # Don't need it anymore
		}
		else_if = {
			limit = {
				has_trait = user_of_$MAGIC$_magic_3
				var:wc_$MAGIC$_magic_experience_variable >= wc_magic_user_4_trait_exp_threshold_value
			}
			change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 }
		}
		else_if = {
			limit = {
				has_trait = user_of_$MAGIC$_magic_2
				var:wc_$MAGIC$_magic_experience_variable >= wc_magic_user_3_trait_exp_threshold_value
			}
			change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 }
		}
		else_if = {
			limit = {
				has_trait = user_of_$MAGIC$_magic_1
				var:wc_$MAGIC$_magic_experience_variable >= wc_magic_user_2_trait_exp_threshold_value
			}
			change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 }
		}
		else_if = {
			limit = {
				NOT = { has_trait = wc_lifestyle_$MAGIC$_magic }
				var:wc_$MAGIC$_magic_experience_variable >= wc_magic_user_1_trait_exp_threshold_value
			}
			add_trait = user_of_$MAGIC$_magic_1
		}
	}
	else = {
	# else_if = { # Recalculate exp for spawned or historical characters that have traits but don't have exp
		# limit = {
			# NOT = { has_trait = user_of_$MAGIC$_magic_5 } # Max level
		# }

		if = {
			limit = { has_trait = user_of_$MAGIC$_magic_1 }
			set_variable = { name = wc_$MAGIC$_magic_experience_variable value = wc_magic_user_1_trait_exp_threshold_value }
		}
		else_if = {
			limit = { has_trait = user_of_$MAGIC$_magic_2 }
			set_variable = { name = wc_$MAGIC$_magic_experience_variable value = wc_magic_user_2_trait_exp_threshold_value }
		}
		else_if = {
			limit = { has_trait = user_of_$MAGIC$_magic_3 }
			set_variable = { name = wc_$MAGIC$_magic_experience_variable value = wc_magic_user_3_trait_exp_threshold_value }
		}
		else_if = {
			limit = { has_trait = user_of_$MAGIC$_magic_4 }
			set_variable = { name = wc_$MAGIC$_magic_experience_variable value = wc_magic_user_4_trait_exp_threshold_value }
		}
	}
}

wc_add_MAGIC_experience_effect = {
	if = {
		limit = {
			NOT = { has_trait = user_of_$MAGIC$_magic_5 } # Max level
		}

		if = {
			limit = { NOT = { has_variable = wc_$MAGIC$_magic_experience_variable } }

			wc_recalculate_MAGIC_experience_effect = { MAGIC = $MAGIC$ }
		}

		change_variable = { name = wc_$MAGIC$_magic_experience_variable add = $EXP$ }
		wc_recalculate_MAGIC_experience_effect = { MAGIC = $MAGIC$ }
	}
}