
# can openly learn magic triggers
can_openly_learn_magic_type_trigger = {
	OR = { 
		AND = { 
			flag:$MAGICTYPE$ = flag:light
			faith = { has_doctrine_parameter = elunic_light_magic_female_only }
			is_male = yes
			has_trait_with_flag = children_of_cenarius_family
		}
		AND =  {
			flag:$MAGICTYPE$ = flag:order
			faith = { has_doctrine_parameter = $MAGICTYPE$_magic_shunned }
			culture = { has_innovation = innovation_archmagi }
		}
		faith = { 
			has_doctrine_parameter = $MAGICTYPE$_magic_openly_learnable 
		}
	}
}

# magic is shunned /criminal triggers
is_magic_type_shunned_trigger = {
	faith = { has_doctrine_parameter = $MAGICTYPE$_magic_shunned }
}

# magic is criminal triggers
is_magic_type_criminal_trigger = {
	faith = { has_doctrine_parameter = $MAGICTYPE$_magic_illegal }
}

# magic secrets triggers
is_secret_elemental_magic_type_user = { 
	#add additional stuff here if necessary
	any_secret = { secret_type = secret_$MAGICTYPE$_magic_user }
}

is_secret_nonelemental_magic_type_user = { 
	#add additional stuff here if necessary
	any_secret = { secret_type = secret_$MAGICTYPE$_magic_user }
}

has_magic_secret_associated_trait =  { #scope from SECRET
	switch = { 
		trigger = secret_type 
		secret_light_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_light_magic } }
		secret_shadow_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_shadow_magic } }
		secret_order_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_order_magic } }
		secret_disorder_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_disorder_magic } }
		secret_life_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_life_magic } }
		secret_death_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_death_magic } }

		secret_elemental_fire_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_fire_magic } }
		#secret_elemental_fire_spirit_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_fire_spirit_magic } }
		#secret_elemental_fire_decay_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_fire_decay_magic } }
		secret_elemental_water_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_water_magic } }
		#secret_elemental_water_spirit_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_water_spirit_magic } }
		#secret_elemental_water_decay_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_water_decay_magic } }
		secret_elemental_air_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_air_magic } }
		#secret_elemental_air_spirit_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_air_spirit_magic } }
		#secret_elemental_air_decay_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_air_decay_magic } }
		secret_elemental_earth_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_earth_magic } }
		#secret_elemental_earth_spirit_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_earth_spirit_magic } }
		#secret_elemental_earth_decay_magic_user = { scope:$CHARACTER$ = { has_trait = wc_lifestyle_elemental_earth_decay_magic } }
	}
}

# this was incompatible with magic secrecy. it will be kept for now in case some other requirements are needed
magic_lifestyle_is_valid_trigger = {
	trigger_if = { 
		limit = { NOT = { flag:$MAGIC$ = flag:poop } }
		always = yes
	}
	# trigger_if = {
	# 	limit = { NOT = { can_openly_learn_magic_type_trigger = { MAGICTYPE = $MAGIC$ } } }

	# 	OR = {
	# 		has_trait = wc_lifestyle_$MAGIC$_magic
	# 		$MAGIC$_magic_lifestyle_xp > 0
	# 	}
	# }
}

# this was incompatible with magic secrecy, however it may be needed based on how spirit/decay ends up being planned
magic_elemental_lifestyle_spirit_or_decay_is_valid_trigger = {
	trigger_if = { 
		limit = { NOT = { flag:$MAGIC$ = flag:poop } }
		always = yes
	}
	# trigger_if = {
	# 	limit = { NOT = { can_openly_learn_magic_type_trigger = { MAGICTYPE = $MAGIC$ } } } 

	# 	has_trait = wc_lifestyle_$MAGIC$_magic
	# }
}

has_focus_light_magic_trigger = {
	OR = {
		has_focus = light_magic_focus_1
		has_focus = light_magic_focus_2
		has_focus = light_magic_focus_3
	}
}
has_focus_shadow_magic_trigger = {
	OR = {
		has_focus = shadow_magic_focus_1
		has_focus = shadow_magic_focus_2
		has_focus = shadow_magic_focus_3
	}
}
has_focus_disorder_magic_trigger = {
	OR = {
		has_focus = disorder_magic_focus_1
		has_focus = disorder_magic_focus_2
		has_focus = disorder_magic_focus_3
	}
}
has_focus_order_magic_trigger = {
	OR = {
		has_focus = order_magic_focus_1
		has_focus = order_magic_focus_2
		has_focus = order_magic_focus_3
	}
}
has_focus_life_magic_trigger = {
	OR = {
		has_focus = life_magic_focus_1
		has_focus = life_magic_focus_2
		has_focus = life_magic_focus_3
	}
}
has_focus_death_magic_trigger = {
	OR = {
		has_focus = death_magic_focus_1
		has_focus = death_magic_focus_2
		has_focus = death_magic_focus_3
	}
}
has_focus_elemental_fire_magic_trigger = {
	OR = {
		has_focus = elemental_fire_magic_focus_1
		has_focus = elemental_fire_magic_focus_2
		has_focus = elemental_fire_magic_focus_3
	}
}
has_focus_elemental_water_magic_trigger = {
	OR = {
		has_focus = elemental_water_magic_focus_1
		has_focus = elemental_water_magic_focus_2
		has_focus = elemental_water_magic_focus_3
	}
}
has_focus_elemental_air_magic_trigger = {
	OR = {
		has_focus = elemental_air_magic_focus_1
		has_focus = elemental_air_magic_focus_2
		has_focus = elemental_air_magic_focus_3
	}
}
has_focus_elemental_earth_magic_trigger = {
	OR = {
		has_focus = elemental_earth_magic_focus_1
		has_focus = elemental_earth_magic_focus_2
		has_focus = elemental_earth_magic_focus_3
	}
}

has_focus_elemental_spirit_magic_trigger = {
	OR = {
		has_focus = elemental_fire_magic_focus_1
		has_focus = elemental_water_magic_focus_1
		has_focus = elemental_air_magic_focus_1
		has_focus = elemental_earth_magic_focus_1
	}
}
has_focus_elemental_decay_magic_trigger = {
	OR = {
		has_focus = elemental_fire_magic_focus_3
		has_focus = elemental_water_magic_focus_3
		has_focus = elemental_air_magic_focus_3
		has_focus = elemental_earth_magic_focus_3
	}
}
has_focus_elemental_neither_spirit_nor_decay_magic_trigger = {
	OR = {
		has_focus = elemental_fire_magic_focus_2
		has_focus = elemental_water_magic_focus_2
		has_focus = elemental_air_magic_focus_2
		has_focus = elemental_earth_magic_focus_2
	}
}
has_focus_elemental_magic_trigger = {
	OR = {
		has_focus_elemental_fire_magic_trigger = yes
		has_focus_elemental_water_magic_trigger = yes
		has_focus_elemental_air_magic_trigger = yes
		has_focus_elemental_earth_magic_trigger = yes
	}
}
can_take_elemental_conjuration_trigger = { 
	has_focus = order_magic_focus_1
	has_perk = order_magic_tree_1_perk_1
	has_perk = order_magic_tree_1_perk_2
}

# magic_lifestyle_is_valid_trigger = {
# 	trigger_if = {
# 		limit = { can_openly_learn_$MAGIC$_magic_trigger = no }
# 		#TODO: insert class traits here
# 		OR = {
# 			has_trait = wc_lifestyle_$MAGIC$_magic
# 			$MAGIC$_magic_lifestyle_xp > 0
# 		}
# 	}
# 	trigger_else = { # Testing
# 		debug_only = yes
# 		is_alive = yes
# 	}
# }
# magic_elemental_lifestyle_spirit_or_decay_is_valid_trigger = {
# 	trigger_if = {
# 		limit = { can_openly_learn_$MAGIC$_magic_trigger = no }

# 		has_trait = wc_lifestyle_$MAGIC$_magic
# 	}
# }

has_any_wc_lifestyle_magical_trait_trigger = {
	OR = {
		has_trait = wc_lifestyle_light_magic
		has_trait = wc_lifestyle_shadow_magic
		has_trait = wc_lifestyle_disorder_magic
		has_trait = wc_lifestyle_order_magic
		has_trait = wc_lifestyle_life_magic
		has_trait = wc_lifestyle_death_magic
		has_trait = wc_lifestyle_elemental_fire_magic
		has_trait = wc_lifestyle_elemental_water_magic
		has_trait = wc_lifestyle_elemental_air_magic
		has_trait = wc_lifestyle_elemental_earth_magic
		has_trait_with_flag = wc_lifestyle_elemental_fire_magic_flag
		has_trait_with_flag = wc_lifestyle_elemental_water_magic_flag
		has_trait_with_flag = wc_lifestyle_elemental_air_magic_flag
		has_trait_with_flag = wc_lifestyle_elemental_earth_magic_flag
	}
}

# Triggers for vanilla lifestyles
diplomacy_lifestyle_tree_1_finished_or_not_started_trigger = { # Foreign Affairs
	OR = {
		NOT = { has_perk = thoughtful_perk }
		has_perk = diplomat_perk
	}
}
diplomacy_lifestyle_tree_2_finished_or_not_started_trigger = { # Majesty
	OR = {
		NOR = {
			has_perk = benevolent_intent_perk
			has_perk = firm_hand_perk
		}
		has_perk = august_perk
	}
}
diplomacy_lifestyle_tree_3_finished_or_not_started_trigger = { # Family
	OR = {
		NOR = {
			has_perk = befriend_perk
			has_perk = groomed_to_rule_perk
		}
		has_perk = family_man_perk
	}
}
intrigue_lifestyle_tree_1_finished_or_not_started_trigger = { # Skulduggery
	OR = {
		NOT = { has_perk = truth_is_relative_perk }
		has_perk = schemer_perk
	}
}
intrigue_lifestyle_tree_2_finished_or_not_started_trigger = { # Temptation
	OR = {
		NOR = {
			has_perk = like_weed_in_a_garden_perk
			has_perk = enticing_opportunity_perk
		}
		has_perk = seducer_perk
	}
}
intrigue_lifestyle_tree_3_finished_or_not_started_trigger = { # Intimidation
	OR = {
		NOR = {
			has_perk = dark_insights_perk
			has_perk = dreadful_perk
		}
		has_perk = torturer_perk
	}
}
learning_lifestyle_tree_1_finished_or_not_started_trigger = { # Medicine
	OR = {
		NOT = { has_perk = anatomical_studies_perk }
		has_perk = whole_of_body_perk
	}
}
learning_lifestyle_tree_2_finished_or_not_started_trigger = { # Scholarship
	OR = {
		NOR = {
			has_perk = pedagogy_perk
			has_perk = scientific_perk
		}
		has_perk = scholar_perk
	}
}
learning_lifestyle_tree_3_finished_or_not_started_trigger = { # Theology
	OR = {
		NOT = { has_perk = faithful_perk }
		has_perk = theologian_perk
	}
}
martial_lifestyle_tree_1_finished_or_not_started_trigger = { # Strategy
	OR = {
		NOT = { has_perk = bellum_justum_perk }
		has_perk = strategist_perk
	}
}
martial_lifestyle_tree_2_finished_or_not_started_trigger = { # Authority
	OR = {
		NOT = { has_perk = serve_the_crown_perk }
		has_perk = overseer_perk
	}
}
martial_lifestyle_tree_3_finished_or_not_started_trigger = { # Chivalry
	OR = {
		NOT = { has_perk = stalwart_leader_perk }
		has_perk = gallant_perk
	}
}
stewardship_lifestyle_tree_1_finished_or_not_started_trigger = { # Wealth
	OR = {
		NOT = { has_perk = golden_obligations_perk }
		has_perk = avaricious_perk
	}
}
stewardship_lifestyle_tree_2_finished_or_not_started_trigger = { # Domain
	OR = {
		NOR = {
			has_perk = tax_man_perk
			has_perk = cutting_corners_perk
		}
		has_perk = architect_perk
	}
}
stewardship_lifestyle_tree_3_finished_or_not_started_trigger = { # Duty
	OR = {
		NOT = { has_perk = meritocracy_perk }
		has_perk = administrator_perk
	}
}

# Triggers for wc lifestyles
light_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = light_magic_tree_1_perk_1 }
		has_perk = light_magic_tree_1_perk_9
	}
}
light_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = light_magic_tree_2_perk_1 }
		has_perk = light_magic_tree_2_perk_9
	}
}
light_magic_lifestyle_tree_3_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = light_magic_tree_3_perk_1 }
		has_perk = light_magic_tree_3_perk_9
	}
}
shadow_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = shadow_magic_tree_1_perk_1 }
		has_perk = shadow_magic_tree_1_perk_9
	}
}
shadow_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = shadow_magic_tree_2_perk_1
			has_perk = shadow_magic_tree_2_perk_2
		}
		has_perk = shadow_magic_tree_2_perk_9
	}
}
shadow_magic_lifestyle_tree_3_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = shadow_magic_tree_3_perk_1
			has_perk = shadow_magic_tree_3_perk_2
		}
		has_perk = shadow_magic_tree_3_perk_9
	}
}
disorder_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = disorder_magic_tree_1_perk_1
			has_perk = disorder_magic_tree_1_perk_2
			has_perk = disorder_magic_tree_1_perk_5
			has_perk = disorder_magic_tree_1_perk_6
		}
		has_perk = disorder_magic_tree_1_perk_9
	}
}
disorder_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = disorder_magic_tree_2_perk_1
			has_perk = disorder_magic_tree_2_perk_2
			has_perk = disorder_magic_tree_2_perk_3
			has_perk = disorder_magic_tree_2_perk_4
		}
		has_perk = disorder_magic_tree_2_perk_9
	}
}
disorder_magic_lifestyle_tree_3_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = disorder_magic_tree_3_perk_1 }
		has_perk = disorder_magic_tree_3_perk_9
	}
}
order_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = order_magic_tree_1_perk_1 }
		has_perk = order_magic_tree_1_perk_9
	}
}
order_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = order_magic_tree_2_perk_1 }
		has_perk = order_magic_tree_2_perk_9
	}
}
order_magic_lifestyle_tree_3_finished_or_not_started_trigger = {
	OR = {
		NOT = {has_perk = order_magic_tree_3_perk_1}
		has_perk = order_magic_tree_3_perk_9
	}
}
order_magic_lifestyle_tree_4_finished_or_not_started_trigger = {
	OR = {
		NOT = {
			has_perk = order_magic_tree_4_perk_1
			has_perk = order_magic_tree_4_perk_2
			has_perk = order_magic_tree_4_perk_3
		}
		has_perk = order_magic_tree_4_perk_9
	}
}
order_magic_lifestyle_tree_5_finished_or_not_started_trigger = {
	OR = {
		NOT = {
			has_perk = order_magic_tree_5_perk_1
			has_perk = order_magic_tree_5_perk_2
			has_perk = order_magic_tree_5_perk_3
		}
		has_perk = order_magic_tree_4_perk_9
	}
}
life_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = life_magic_tree_1_perk_1
			has_perk = life_magic_tree_1_perk_2
		}
		has_perk = life_magic_tree_1_perk_9
	}
}
life_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = life_magic_tree_2_perk_1
			has_perk = life_magic_tree_2_perk_2
			has_perk = life_magic_tree_2_perk_3
			has_perk = life_magic_tree_2_perk_4
			has_perk = life_magic_tree_2_perk_5
		}
		has_perk = life_magic_tree_2_perk_9
	}
}
life_magic_lifestyle_tree_3_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = life_magic_tree_3_perk_1
			has_perk = life_magic_tree_3_perk_2
			has_perk = life_magic_tree_3_perk_3
		}
		has_perk = life_magic_tree_3_perk_9
	}
}
death_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = death_magic_tree_1_perk_1
			has_perk = death_magic_tree_1_perk_2
			has_perk = death_magic_tree_1_perk_3
			has_perk = death_magic_tree_1_perk_4
			has_perk = death_magic_tree_1_perk_5
		}
		has_perk = death_magic_tree_1_perk_9
	}
}
death_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = death_magic_tree_2_perk_1
			has_perk = death_magic_tree_2_perk_2
		}
		has_perk = death_magic_tree_2_perk_9
	}
}
death_magic_lifestyle_tree_3_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = death_magic_tree_3_perk_1 }
		has_perk = death_magic_tree_3_perk_9
	}
}
elemental_fire_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = elemental_fire_magic_tree_1_perk_1 }
		has_perk = elemental_fire_magic_tree_1_perk_9
	}
}
elemental_fire_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = elemental_fire_magic_tree_2_perk_1
			has_perk = elemental_fire_magic_tree_2_perk_2
		}
		has_perk = elemental_fire_magic_tree_2_perk_9
	}
}
elemental_water_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = elemental_water_magic_tree_1_perk_1 }
		has_perk = elemental_water_magic_tree_1_perk_9
	}
}
elemental_water_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOR = {
			has_perk = elemental_water_magic_tree_2_perk_1
			has_perk = elemental_water_magic_tree_2_perk_2
		}
		has_perk = elemental_water_magic_tree_2_perk_9
	}
}
elemental_air_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOT = {has_perk = elemental_air_magic_tree_1_perk_1}
		has_perk = elemental_air_magic_tree_1_perk_9
	}
}
elemental_air_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = elemental_air_magic_tree_2_perk_1 }
		has_perk = elemental_air_magic_tree_2_perk_9
	}
}
elemental_air_magic_lifestyle_tree_3_finished_or_not_started_trigger = { always = yes }
elemental_earth_magic_lifestyle_tree_1_finished_or_not_started_trigger = {
	OR = {
		NOT = { has_perk = elemental_earth_magic_tree_1_perk_1 }
		has_perk = elemental_earth_magic_tree_1_perk_9
	}
}
elemental_earth_magic_lifestyle_tree_2_finished_or_not_started_trigger = {
	OR = {
		NOT = {has_perk = elemental_earth_magic_tree_2_perk_1}
		has_perk = elemental_earth_magic_tree_2_perk_9
	}
}
elemental_earth_magic_lifestyle_tree_3_finished_or_not_started_trigger = { always = yes }

can_spend_perks_in_nonelemental_TYPE_lifestyle_tree_TREE_trigger = {
	OR = {
		can_start_new_lifestyle_tree_trigger = yes # AI can allocate perks in a tree if they finished all their previous trees
		$TYPE$_lifestyle_tree_$TREE$_finished_or_not_started_trigger = no # Or if it's a tree they have already invested in

		trigger_if = { # Or they have recieved a perk in the game process by focus or event
			limit = { $TYPE$_lifestyle_perk_points > 0 }

			$TYPE$_lifestyle_tree_1_finished_or_not_started_trigger = yes
			$TYPE$_lifestyle_tree_2_finished_or_not_started_trigger = yes
			$TYPE$_lifestyle_tree_3_finished_or_not_started_trigger = yes
		}
	}
}

can_spend_perks_in_elemental_MAGIC_magic_lifestyle_tree_TREE_trigger = { # Created in order for the game to not trow an error because third elemental tree does not exist
	OR = {
		can_start_new_lifestyle_tree_trigger = yes
		$MAGIC$_magic_lifestyle_tree_$TREE$_finished_or_not_started_trigger = no

		trigger_if = {
			limit = { $MAGIC$_magic_lifestyle_perk_points > 0 }

			$MAGIC$_magic_lifestyle_tree_1_finished_or_not_started_trigger = yes
			$MAGIC$_magic_lifestyle_tree_2_finished_or_not_started_trigger = yes
		}
	}
}

# Triggers for elemental goodwill mechanic
wc_ELEMENT_favour_TENSE_disposition_is_neutral_trigger = {
	wc_$ELEMENT$_favour_$TENSE$_value < wc_spirit_elemental_favour_threshold_value
	wc_$ELEMENT$_favour_$TENSE$_value > wc_decay_elemental_favour_threshold_value
}
wc_ELEMENT_favour_TENSE_disposition_is_spirit_trigger = {
	wc_$ELEMENT$_favour_$TENSE$_value >= wc_spirit_elemental_favour_threshold_value
}
wc_ELEMENT_favour_TENSE_disposition_is_decay_trigger = {
	wc_$ELEMENT$_favour_$TENSE$_value <= wc_decay_elemental_favour_threshold_value
}