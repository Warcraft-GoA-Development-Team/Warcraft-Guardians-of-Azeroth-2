init_death_spells_effect = {
    # add_to_global_variable_list = { name = death_spells target = flag:raise_dead } # Casted through other means
}

init_raise_undead_types_effect = {
    add_to_global_variable_list = { name = raise_dead_types target = flag:undead }
    add_to_global_variable_list = { name = raise_dead_types target = flag:ghoul }
    add_to_global_variable_list = { name = raise_dead_types target = flag:abomination }
    add_to_global_variable_list = { name = raise_dead_types target = flag:banshee }
}

cast_raise_dead_effect = {
    if = {
        limit = { exists = var:raise_dead_recipient }
        var:raise_dead_recipient = {
            save_temporary_scope_as = first_recipient
        }

        save_scope_value_as = {
            name = raise_dead_type
            value = var:raise_dead_type
        }

        var:raise_dead_type = {
            save_scope_as = raise_dead_type
        }
    }
    else_if = {
        limit = {
            exists = var:current_spell_name
            var:current_spell_name = flag:raise_dead
            exists = var:spellbook_open
            exists = var:spell_recipient
        }
        var:spell_recipient = {
            save_temporary_scope_as = first_recipient
        }

        var:current_raise_dead_type = {
            save_scope_as = raise_dead_type
        }
    }

    scope:first_recipient ?= {
        show_as_tooltip = {
            switch = {
                trigger = scope:raise_dead_type

                flag:undead = { add_trait = being_undead }
                flag:abomination = { set_trait_rank = { trait = race rank = 21 } }
                flag:banshee = { set_trait_rank = { trait = race rank = 84 } }
                flag:ghoul = { set_trait_rank = { trait = race rank = 85 } }
            }
        }

        custom_tooltip = {
            text = raise_dead_tt
            wc_resurrect_CHARACTER_with_STATUS_effect = { CHARACTER = scope:first_recipient STATUS = undead }
            scope:resurrected_character = {
                root = { add_courtier = prev }
                switch = {
                    trigger = scope:raise_dead_type

                    flag:undead = { add_trait = being_undead }
                    flag:abomination = { set_trait_rank = { trait = race rank = 21 } }
                    flag:banshee = { set_trait_rank = { trait = race rank = 84 } }
                    flag:ghoul = { set_trait_rank = { trait = race rank = 85 } }
                }
            }
        }
    }
}