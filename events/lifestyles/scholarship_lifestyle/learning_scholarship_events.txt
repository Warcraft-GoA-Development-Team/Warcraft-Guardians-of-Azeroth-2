namespace = learning_scholarship

namespace = learning_scholarship_special

##################################################

# Learning Scholarship Lifestyle events

	# 1101			- Learn to Read
	# 1201			- Automaton
	# 1401			- Reading Stone
	# 3001			- Brass Orb Experiments
	# 4000			- Dear God, go outside

#Special Learning Scholarship Lifestyle events

	# 2001 			- Translate Great Work
	# 3001  		- Lead to Gold

##################################################

##################################################
# Learn to read
# by Linnéa Thimrén
##################################################
learning_scholarship.1101 = {
	type = character_event
	title = learning_scholarship.1101.t
	desc = learning_scholarship.1101.desc
	theme = learning_scholarship_focus
	left_portrait = scope:bishop
	
	trigger = {
		NOT = {
			has_character_flag = had_event_learning_scholarship_1101
		}
		learning < mediocre_skill_rating #triggers if you need a boost
		exists = cp:councillor_court_chaplain
		cp:councillor_court_chaplain = {
			is_ai = yes
		}
	}

	weight_multiplier = {
		base = 1
		upweight_for_focus_modifier = { FOCUS = learning_scholarship_focus }
	}

	immediate = {
		add_character_flag = {
			flag = had_event_learning_scholarship_1101
			years = 5
		}
		if = {
			limit = {
				exists = cp:councillor_court_chaplain
			}
			cp:councillor_court_chaplain = {
				save_scope_as = bishop
			}
		}
	}

	option = { #Accept help
		name = learning_scholarship.1101.a
		add_learning_skill = 1
		add_stress = minor_stress_gain
		add_learning_lifestyle_xp = miniscule_lifestyle_xp
		if = {
			limit = {
				exists = scope:bishop
			}
			add_opinion = {
				target = scope:bishop
				modifier = grateful_opinion
				opinion = 20
			}
		}
		ai_chance = {
			base = 25
			ai_value_modifier = {
				ai_compassion = 0.5
				ai_rationality = 0.25
			}
		}
	}

	option = { #nah
		name = learning_scholarship.1101.b
		add_prestige = medium_prestige_gain
		add_stress = minor_stress_loss
		ai_chance = {
			base = 25
			modifier = {
				add = 25
				has_trait = arrogant
			}
		}
	}
}


##################################################
# Automaton
# by Linnéa Thimrén & Mathilda Bjarnehed
##################################################
scripted_trigger learning_scholarship_1201_friendly_ruler_trigger = {
	is_adult = yes
	basic_is_available_ai = yes
	NOR = {
		is_at_war_with = root
		has_government = tribal_government
	}
	is_landed = yes
	exists = capital_province
	capital_province.culture = { has_innovation = innovation_guilds } #Highly Advanced mechanical bird should not come from an underdeveloped tribe.
	OR = {
		highest_held_title_tier >= tier_kingdom
		AND = {
			learning >= high_skill_rating
			highest_held_title_tier >= tier_duchy
		}
	}
	opinion = {
		target = root
		value >= neutral_opinion
	}
}

learning_scholarship.1201 = {
	type = character_event
	title = learning_scholarship.1201.t
	desc = learning_scholarship.1201.desc
	
	theme = learning_scholarship_focus
	left_portrait = scope:bird_sender
	
	trigger = {
		NOT = {
			has_character_flag = had_event_learning_scholarship_1201
		}
		OR = {
			any_neighboring_and_across_water_top_liege_realm_owner = {
				learning_scholarship_1201_friendly_ruler_trigger = yes
			}
			any_vassal = {
				learning_scholarship_1201_friendly_ruler_trigger = yes
			}
			AND = {
				exists = liege
				NOT = { liege = root }
				liege = { learning_scholarship_1201_friendly_ruler_trigger = yes }
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 1
			any_neighboring_and_across_water_top_liege_realm_owner = {
				learning_scholarship_1201_friendly_ruler_trigger = yes
				opinion = {
					target = root
					value >= medium_positive_opinion
				}
			}
		}
		upweight_for_focus_modifier = { FOCUS = learning_scholarship_focus }
	}

	immediate = {
		add_character_flag = {
			flag = had_event_learning_scholarship_1201
			years = 5
		}
		#Pick someone who sent the bird
		every_neighboring_and_across_water_top_liege_realm_owner = {
			limit = { learning_scholarship_1201_friendly_ruler_trigger = yes }
			add_to_list = bird_senders
		}
		if = {
			limit = {
				NOT = {
					any_neighboring_and_across_water_top_liege_realm_owner = {
						learning_scholarship_1201_friendly_ruler_trigger = yes
					}
				}
			}
			every_vassal = {
				limit = { learning_scholarship_1201_friendly_ruler_trigger = yes }
				add_to_list = bird_senders
			}
			if = {
				limit = {
					exists = liege
					NOT = { liege = root }
					liege = { learning_scholarship_1201_friendly_ruler_trigger = yes }
				}
				liege = { add_to_list = bird_senders }

			}
		}
		random_in_list = {
			list = bird_senders
			weight = {
				base = 0
				opinion_modifier = {
					opinion_target = root
				}
			}
			save_scope_as = bird_sender
		}
	}

	option = { #have it sing in your halls
		name = learning_scholarship.1201.b

		add_character_modifier = {
			modifier = scholarship_bird_automaton_modifier
			years = 15
		}
		reverse_add_opinion = {
			target = scope:bird_sender
			modifier = pleased_opinion
			opinion = 20
		}

		ai_chance = {
			base = 25
			ai_value_modifier = {
				ai_greed = 0.5
				ai_energy = 0.25
			}
		}
	}

	option = { #sell
		name = learning_scholarship.1201.a
		add_gold = medium_gold_value

		reverse_add_opinion = {
			target = scope:bird_sender
			modifier = angry_opinion
			opinion = -20
		}
		ai_chance = {
			base = 25
			ai_value_modifier = {
				ai_greed = 0.75
			}
		}
	}


	option = { #take apart and study!
	name = learning_scholarship.1201.c
		add_character_modifier = {
			modifier = scholarship_bird_dissection_modifier
			years = 15
		}
		add_learning_lifestyle_xp = medium_lifestyle_xp

		random_list = {
			20 = { #They like your inquisitiveness
				modifier = {
					#At decent learning, x6 (60% chance)
					#At high learning, x15 (~80% chance)
					scope:bird_sender.learning >= medium_skill_rating
					factor = {
						value = scope:bird_sender.learning
						subtract = medium_skill_rating
						multiply = 3
					}
				}
				show_chance = no
				desc = learning_scholarship.1201.c.success
				send_interface_toast = {
					left_icon = scope:bird_sender
					title = learning_scholarship.1201.c.success
					reverse_add_opinion = {
						target = scope:bird_sender
						modifier = respect_opinion
						opinion = 20
					}
				}
				hidden_effect = {
					progress_towards_friend_effect = {
						CHARACTER = scope:bird_sender
						OPINION = no
					}
				}
			}
			80 = { #They are offended
				desc = learning_scholarship.1201.c.failure
				show_chance = no
				send_interface_toast = {
					left_icon = scope:bird_sender
					title = learning_scholarship.1201.c.failure
					reverse_add_opinion = {
						target = scope:bird_sender
						modifier = angry_opinion
						opinion = -20
					}
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

##################################################
# Acquire a reading stone
# by Linnéa Thimrén
##################################################
learning_scholarship.1401 = {
	type = character_event
	title = learning_scholarship.1401.t
	desc = learning_scholarship.1401.desc
	
	theme = learning_scholarship_focus
	left_portrait = root
	right_portrait = scope:bishop
	
	trigger = {
		NOT = {
			has_character_flag = had_event_learning_scholarship_1401
		}
		OR = {
			is_ai = no
			short_term_gold >= minor_gold_value
		}
	}

	weight_multiplier = {
		base = 0.25
		modifier = {
			# Becomes increasingly common as characters get older.
			# Additional 1.75 weight at 35 years of age (x2 as likely as normal event)
			# Average age for people needing reading glasses is 40-45 in real life.
			add = {
				# Warcraft
				value = {
					value = age
					divide = racial_age_multiplier_value
				}
				
				multiply = 0.05
			}
		}
		upweight_for_focus_modifier = { FOCUS = learning_scholarship_focus }
	}

	immediate = {
		add_character_flag = {
			flag = had_event_learning_scholarship_1401
			years = 10
		}
		if = {
			limit = {
				exists = cp:councillor_court_chaplain
				cp:councillor_court_chaplain = {
					NOT = {
						has_hook_of_type = {
							target = root
							type = favor_hook
						}
					}
				}
			}
			cp:councillor_court_chaplain = {
				save_scope_as = bishop
			}
		}
	}

	option = { #Ask Chaplain for help
		name = learning_scholarship.1401.c
		trigger = {
			exists = scope:bishop
		}
		add_learning_lifestyle_xp = major_lifestyle_xp
		scope:bishop = {
			add_hook = {
				type = favor_hook
				target = root
			}
		}
		ai_chance = {
			base = 75
		}
	}

	option = { #Get a reading stone
		name = learning_scholarship.1401.a
		remove_short_term_gold = medium_gold_value
		add_learning_lifestyle_xp = major_lifestyle_xp
		ai_chance = {
			base = 75
		}
	}

	option = { #Sell all writing that's too small
		name = learning_scholarship.1401.b
		add_gold = medium_gold_value
		add_stress = minor_stress_loss
		ai_chance = {
			base = 25
			ai_value_modifier = {
				ai_greed = 0.75
			}
		}
	}
}


##################################################
# Scientific Experiments
# by Petter Vilberg
##################################################
#Brass orbs and candles
learning_scholarship.3001 = {
	type = character_event
	title = learning_scholarship.3001.t
	desc = learning_scholarship.3001.desc
	
	theme = learning_scholarship_focus
	left_portrait = scope:chaplain
	
	trigger = {
		NOT = { has_character_flag = had_event_learning_scholarship_3001 }
		religion_has_angels_trigger = yes
		exists = cp:councillor_court_chaplain
	}

	weight_multiplier = {
		base = 1
		downweight_for_focus_modifier = { FOCUS = learning_medicine_focus }
	}

	immediate = {
		add_character_flag = {
			flag = had_event_learning_scholarship_3001
			years = 5
		}
		cp:councillor_court_chaplain = {
			save_scope_as = chaplain
		}
	}

	option = {
		name = learning_scholarship.3001.c
		duel = {
			skill = learning
			target = scope:chaplain
			15 = {		
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = -14
				}
				desc = learning_scholarship.3001.c.tt1
				send_interface_toast = {
					title = learning_scholarship.3001.c.toast.tt1
					add_learning_lifestyle_xp = medium_lifestyle_xp
				}
			}
			15 = {		
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = -14
				}
				desc = learning_scholarship.3001.c.tt2
				send_interface_toast = {
					title = learning_scholarship.3001.c.toast.tt2
					scope:chaplain = {
						add_opinion = {
							target = root
							modifier = impious_opinion
							opinion = -5
						}
					}
				}
			}
		}
	}

	option = {
		name = learning_scholarship.3001.a
		add_learning_lifestyle_xp = minor_lifestyle_xp
		scope:chaplain = {
			add_opinion = {
				target = root
				modifier = impious_opinion
				opinion = -25
			}
		}
		cynical_progression_effect = yes
	}

	option = {
		name = learning_scholarship.3001.b
		add_learning_lifestyle_xp = miniscule_lifestyle_xp
		scope:chaplain = {
			add_opinion = {
				target = root
				modifier = pious_opinion
				opinion = 20
			}
		}
		zealous_progression_effect = yes
	}
}

################################################################################################################################
################################################################################################################################

##################################################
# Translate a Great Work
# by Petter Vilberg
##################################################
learning_scholarship_special.2001 = {
	type = character_event
	title = learning_scholarship_special.2001.t
	desc = learning_scholarship_special.2001.desc
	
	left_portrait = root
	theme = learning_scholarship_focus
	
	trigger = {
		is_ai = no #Limit the amount of story cycles for AI
		has_focus = learning_scholarship_focus
		NOT = { has_character_flag = had_learning_scholarship_special_2001_this_lifetime }
		NOT = {	has_character_flag = had_book_translation_story }
	}

	weight_multiplier = {
		base = 1
	}

	immediate = {
		add_character_flag = {
			flag = is_in_learning_special_event
			days = 365
		}
		add_character_flag = had_learning_scholarship_special_2001_this_lifetime

		pick_translation_book_effect = {
			OPTION = option_1
		}
		pick_translation_book_effect = {
			OPTION = option_2
		}
	}

	# Warcraft
	option = {
		name = learning_scholarship_special.2001.book_of_ur
		trigger = {
			OR = {
				scope:option_1 = flag:book_of_ur
				scope:option_2 = flag:book_of_ur
			}
		}
		set_up_translation_story_effect = {
			BOOK = book_of_ur
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}
	option = {
		name = learning_scholarship_special.2001.book_of_the_dead
		trigger = {
			OR = {
				scope:option_1 = flag:book_of_the_dead
				scope:option_2 = flag:book_of_the_dead
			}
		}
		set_up_translation_story_effect = {
			BOOK = book_of_the_dead
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}
	option = {
		name = learning_scholarship_special.2001.fear_and_flesh
		trigger = {
			OR = {
				scope:option_1 = flag:fear_and_flesh
				scope:option_2 = flag:fear_and_flesh
			}
		}
		set_up_translation_story_effect = {
			BOOK = fear_and_flesh
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}
	option = {
		name = learning_scholarship_special.2001.curse_of_stone
		trigger = {
			OR = {
				scope:option_1 = flag:curse_of_stone
				scope:option_2 = flag:curse_of_stone
			}
		}
		set_up_translation_story_effect = {
			BOOK = curse_of_stone
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}
	option = {
		name = learning_scholarship_special.2001.song_of_aegwynn
		trigger = {
			OR = {
				scope:option_1 = flag:song_of_aegwynn
				scope:option_2 = flag:song_of_aegwynn
			}
		}
		set_up_translation_story_effect = {
			BOOK = song_of_aegwynn
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}
	option = {
		name = learning_scholarship_special.2001.burdens_of_shaohao
		trigger = {
			OR = {
				scope:option_1 = flag:burdens_of_shaohao
				scope:option_2 = flag:burdens_of_shaohao
			}
		}
		set_up_translation_story_effect = {
			BOOK = burdens_of_shaohao
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}
	option = {
		name = learning_scholarship_special.2001.purity_of_essence
		trigger = {
			OR = {
				scope:option_1 = flag:purity_of_essence
				scope:option_2 = flag:purity_of_essence
			}
		}
		set_up_translation_story_effect = {
			BOOK = purity_of_essence
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}
	option = {
		name = learning_scholarship_special.2001.will_of_stone
		trigger = {
			OR = {
				scope:option_1 = flag:will_of_stone
				scope:option_2 = flag:will_of_stone
			}
		}
		set_up_translation_story_effect = {
			BOOK = will_of_stone
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}

	option = {
		name = learning_scholarship_special.2001.family_history
		trigger = {
			OR = {
				scope:option_1 = flag:family_history
				scope:option_2 = flag:family_history
			}
		}
		set_up_translation_story_effect = {
			BOOK = family_history
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}

	option = {
		name = learning_scholarship_special.2001.ancient_myths
		trigger = {
			OR = {
				scope:option_1 = flag:ancient_myths
				scope:option_2 = flag:ancient_myths
			}
		}
		set_up_translation_story_effect = {
			BOOK = ancient_myths
		}
		custom_tooltip = learning_lifestyle_rank_up_indication
	}
	
	option = {
		name = learning_scholarship_special.2001.decline
		stress_impact = {
			base = minor_stress_loss
		}
		remove_character_flag = is_in_learning_special_event
	}
}

#Confusing passage
learning_scholarship_special.2011 = {
	type = character_event
	title = learning_scholarship_special.2001.t
	desc = learning_scholarship_special.2011.desc
	
	left_portrait = root
	theme = learning_scholarship_focus
	
	trigger = {
		NOR = {
			exists = scope:story.var:had_learning_scholarship_special_2011
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}

	immediate = {
		scope:story = {
			set_variable = {
				name = had_learning_scholarship_special_2011
				value = yes
			}
		}
	}

	option = { #My interpretation is better
		name = learning_scholarship_special.2011.a
		duel = {
			skill = learning
			value = average_skill_rating

			20 = {
				desc = learning_scholarship_special.2011.a.success
				compare_modifier = {
					value = scope:duel_value
				}
				learning_scholarship_special_2011_significantly_improve_translation_effect = yes
				send_interface_toast = {
					title = book_translation_toast.more_good
					left_icon = root
					add_prestige = medium_prestige_gain
				}
			}
			20 = {
				desc = learning_scholarship_special.2011.a.failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
				}
				custom_tooltip = book_translation_tooltip.unchanged
				send_interface_toast = {
					title = book_translation_toast.unchanged
					left_icon = root
					add_prestige = minor_prestige_gain
				}
			}
		}
		cynical_progression_effect = yes
	}

	option = { #Let's stay true to the text
		name = learning_scholarship_special.2011.b
		add_piety = medium_piety_gain
		learning_scholarship_special_2011_somewhat_improve_translation_effect = yes
		zealous_progression_effect = yes
	}

	option = { #Oh, the meaning is obvious
		name = learning_scholarship_special.2011.c
		trigger = {
			has_trait = scholar
		}
		trait = scholar	
		add_prestige = minor_prestige_gain
		learning_scholarship_special_2011_significantly_improve_translation_effect = yes
	}

	option = { #Oh, the meaning is obvious
		name = learning_scholarship_special.2011.c
		trigger = {
			NOT = {	has_trait = scholar }
			learning >= very_high_skill_rating
		}
		skill = learning
		add_prestige = minor_prestige_gain
		learning_scholarship_special_2011_significantly_improve_translation_effect = yes
	}
}

#Realm Priest offers help
learning_scholarship_special.2012 = {
	type = character_event
	title = learning_scholarship_special.2001.t
	desc = learning_scholarship_special.2012.desc
	
	theme = learning_scholarship_focus
	left_portrait = scope:realm_priest
	
	trigger = {
		exists = cp:councillor_court_chaplain
		cp:councillor_court_chaplain = {
			is_ai = yes
		}
		NOR = {
			exists = scope:story.var:had_learning_scholarship_special_2012
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			add = 1
			cp:councillor_court_chaplain = {
				opinion = {
					target = root
					value < 30
				}
			}
		}
	}

	immediate = {
		scope:story = {
			set_variable = {
				name = had_learning_scholarship_special_2012
				value = yes
			}
		}
		cp:councillor_court_chaplain = {
			save_scope_as = realm_priest
		}
	}

	option = {
		name = learning_scholarship_special.2012.a
		scope:realm_priest = {
			duel = {
				skill = learning
				value = average_skill_rating
				20 = {
					desc = learning_scholarship_special.2012.a.success
					compare_modifier = {
						value = scope:duel_value
					}
					learning_scholarship_special_2011_significantly_improve_translation_effect = yes
					send_interface_toast = {
						title = book_translation_toast.more_good
						left_icon = scope:realm_priest
						add_learning_lifestyle_xp = minor_lifestyle_xp
					}
				}
				20 = {
					desc = learning_scholarship_special.2012.a.failure
					compare_modifier = {
						value = scope:duel_value
					}
					learning_scholarship_special_2011_somewhat_improve_translation_effect = yes
					send_interface_toast = {
						title = book_translation_toast.less_good
						left_icon = scope:realm_priest
					}
				}
			}
		}
	}

	option = {
		name = learning_scholarship_special.2012.b
		scope:realm_priest = {
			add_opinion = {
				target = root
				modifier = pleased_opinion
				opinion = 30
			}
		}
		add_prestige = minor_prestige_loss
		learning_scholarship_special_2011_somewhat_improve_translation_effect = yes
	}

	option = {
		name = learning_scholarship_special.2012.c
		trigger = {
			has_relation_friend = scope:realm_priest
		}
		custom_tooltip = learning_scholarship_special.2012.c.friendship_tooltip
		learning_scholarship_special_2011_significantly_improve_translation_effect = yes
		scope:realm_priest = {
			add_opinion = {
				target = root
				modifier = friendliness_opinion
				opinion = low_positive_opinion
			}
		}
	}
}

#Sudden Insight
learning_scholarship_special.2013 = {
	type = character_event
	title = learning_scholarship_special.2001.t
	desc = learning_scholarship_special.2013.desc
	theme = learning_scholarship_focus
	left_portrait = root
	
	trigger = {
		NOR = {
			exists = scope:story.var:had_learning_scholarship_special_translation_quality_event
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}

	immediate = {
		scope:story = {
			set_variable = {
				name = had_learning_scholarship_special_translation_quality_event
				value = yes
			}
		}
		learning_scholarship_special_2011_significantly_improve_translation_effect = yes
		add_learning_lifestyle_xp = minor_lifestyle_xp
	}

	option = { #Unlike ReligiousText...
		name = learning_scholarship_special.2013.a
		cynical_progression_effect = yes
		add_prestige = medium_prestige_gain
		
	}

	option = { #As evident from the will of HighGod...
		name = learning_scholarship_special.2013.b
		zealous_progression_effect = yes
		add_piety = medium_piety_gain
	}
}

#The Book is Boring
learning_scholarship_special.2014 = {
	type = character_event
	title = learning_scholarship_special.2001.t
	desc = learning_scholarship_special.2014.desc
	theme = learning_scholarship_focus
	left_portrait = root
		
	trigger = {
		NOR = {
			exists = scope:story.var:had_learning_scholarship_special_translation_quality_event
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}

	immediate = {
		scope:story = {
			set_variable = {
				name = had_learning_scholarship_special_translation_quality_event
				value = yes
			}
		}
	}

	option = { #I'll still get it done!
		name = learning_scholarship_special.2014.a
		add_stress = medium_stress_gain
		learning_scholarship_special_2011_significantly_improve_translation_effect = yes
	}

	option = { #My scribes can work overtime
		name = learning_scholarship_special.2014.b
		remove_short_term_gold = 2
		learning_scholarship_special_2011_somewhat_improve_translation_effect = yes
	}
	
	option = { #Take a break
		name = learning_scholarship_special.2014.c
		add_stress = medium_stress_loss
		custom_tooltip = book_translation_tooltip.unchanged
	}
}

#Working long into the night
learning_scholarship_special.2015 = {
	type = character_event
	title = learning_scholarship_special.2001.t
	desc = learning_scholarship_special.2015.desc
	theme = learning_scholarship_focus
	left_portrait = root
	right_portrait = scope:realm_priest
	
	trigger = {
		NOR = {
			exists = scope:story.var:had_learning_scholarship_special_2015
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}

	immediate = {
		scope:story = {
			set_variable = {
				name = had_learning_scholarship_special_2015
				value = yes
			}
		}
	}

	option = { # Let's keep going
		name = learning_scholarship_special.2015.a
		# Note: This option is intentionally worse in almost all situations
		learning_scholarship_special_2011_somewhat_improve_translation_effect = yes
		speed_up_translation_effect = yes
		add_learning_lifestyle_xp = minor_lifestyle_xp
		add_stress = minor_stress_gain
	}

	option = { # Get some rest
		name = learning_scholarship_special.2015.b
		add_learning_lifestyle_xp = miniscule_lifestyle_xp
		learning_scholarship_special_2011_significantly_improve_translation_effect = yes
	}
	
	option = { # Scribes can work while I sleep
		name = learning_scholarship_special.2015.c
		custom_tooltip = book_translation_tooltip.unchanged
		add_stress = medium_stress_loss
	}
}

# Scribe makes unapproved changes
learning_scholarship_special.2016 = {
	type = character_event
	title = learning_scholarship_special.2001.t
	desc = learning_scholarship_special.2016.desc
	theme = learning_scholarship_focus
	left_portrait = root
	
	trigger = {
		NOR = {
			exists = scope:story.var:had_learning_scholarship_special_2016
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}

	immediate = {
		scope:story = {
			set_variable = {
				name = had_learning_scholarship_special_2016
				value = yes
			}
		}
	}

	option = { # Get out of here!
		name = learning_scholarship_special.2016.a
		learning_scholarship_special_2011_somewhat_improve_translation_effect = yes
		add_prestige = minor_prestige_loss
	}

	option = { # The rest of you better learn from this
		name = learning_scholarship_special.2016.b
		flavor = learning_scholarship_special.2016.b.flavor
		learning_scholarship_special_2011_significantly_improve_translation_effect = yes
		add_character_modifier = {
			modifier = terrified_courtiers_modifier
			years = 5
		}
	}
	
	option = { # These are pretty good, actually
		name = learning_scholarship_special.2016.c
		learning_scholarship_special_2011_somewhat_improve_translation_effect = yes
		speed_up_translation_effect = yes
	}
}

# Tired from constant work
learning_scholarship_special.2017 = {
	type = character_event
	title = learning_scholarship_special.2001.t
	desc = learning_scholarship_special.2017.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = root
		animation = sadness
	}
		
	trigger = {
		NOR = {
			exists = scope:story.var:had_learning_scholarship_special_2017
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}

	immediate = {
		scope:story = {
			set_variable = {
				name = had_learning_scholarship_special_2017
				value = yes
			}
		}
	}

	option = { # I can do a few more events- I mean pages, at least
		name = learning_scholarship_special.2017.a
		add_stress = medium_stress_gain
		learning_scholarship_special_2011_significantly_improve_translation_effect = yes
	}

	option = { # I will seclude myself with prayer and focus
		name = learning_scholarship_special.2017.b
		add_prestige = medium_prestige_gain
		learning_scholarship_special_2011_somewhat_improve_translation_effect = yes
	}
	
	option = { # I'd rather do something else
		name = learning_scholarship_special.2017.c
		add_stress = minor_stress_loss
		custom_tooltip = book_translation_tooltip.unchanged
	}
}


# Good outcome of the translation
learning_scholarship_special.2097 = {
	type = character_event
	title = learning_scholarship_special.2097.t
	desc = {
		desc = learning_scholarship_special.2097.opening
		desc = learning_scholarship_special.2097.conclusion
	}
	theme = learning_scholarship_focus
	left_portrait = {
		character = root
		animation = happiness
	}

	option = {
		name = learning_scholarship_special.2097.a
		add_character_modifier = {
			modifier = book_translation_excellent_modifier
			years = 10
		}
		add_learning_lifestyle_perk_points = 1
	}

	after = {
		remove_character_modifier = book_translation_ongoing_modifier
		hidden_effect = {
			scope:story = {
				end_story = yes
			}
		}
	}
}


# Bad outcome of the translation
learning_scholarship_special.2098 = {
	type = character_event
	title = learning_scholarship_special.2098.t
	desc = {
		desc = learning_scholarship_special.2098.opening
		desc = learning_scholarship_special.2098.conclusion
	}
	theme = learning_scholarship_focus
	left_portrait = root

	option = {
		name = learning_scholarship_special.2098.a
		add_character_modifier = {
			modifier = book_translation_mediocre_modifier
			years = 10
		}
		add_learning_lifestyle_perk_points = 1
	}

	after = {
		remove_character_modifier = book_translation_ongoing_modifier
		hidden_effect = {
			scope:story = {
				end_story = yes
			}
		}
	}
}

learning_scholarship_special.2099 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				is_imprisoned = yes
			}
			send_interface_toast = {
				title = learning_scholarship_special.2099.termination.toast
				custom_tooltip = learning_scholarship_special.2099.termination.desc.prison
			}
		}
		else = {
			send_interface_toast = {
				title = learning_scholarship_special.2099.termination.toast
				custom_tooltip = learning_scholarship_special.2099.termination.desc.incapable
			}
		}
	}

	after = {
		scope:story = {
			end_story = yes
		}
	}
}

### Great Work Translation - END

##################################################
# Lead to Gold									#
# by Sean Hughes								#
# 3001-3005										#
##################################################

# Could these scribbles in this book actually be useful information?
learning_scholarship_special.3001 = {
	type = character_event
	title = learning_scholarship_special.3001.t
	desc = learning_scholarship_special.3001.desc
	theme = learning_scholarship_focus
	left_portrait = root
	
	trigger = {
		has_focus = learning_scholarship_focus
		NOT = {	has_character_flag = had_learning_scholarship_special_3001_this_lifetime }
	}

	immediate = {
		add_character_flag = {
			flag = is_in_learning_special_event
			days = 200
		}
		add_character_flag = had_learning_scholarship_special_3001_this_lifetime
	}

	# Option A: Attempt the experiment!
	option = {
		name = learning_scholarship_special.3001.a
		custom_tooltip = learning_lifestyle_rank_up_indication
		trigger_event = {
			id = learning_scholarship_special.3002
			days = { 5 9 }
		}

		if = {
			limit = {
				faith = {
					OR = {
						NOT = { has_doctrine = doctrine_witchcraft_accepted }
						trait_is_sin = greedy
					}
				}
			}
			stress_impact = {
				# Non-trusting characters find this notion to be absurd.
				cynical = minor_stress_impact_gain
				paranoid = minor_stress_impact_gain

				# If greed is a sin, this path is also stressful for zealous characters.
				zealous = minor_stress_impact_gain
			}
		}
		else = {
			stress_impact = {
				# Non-trusting characters find this notion to be absurd.
				cynical = minor_stress_impact_gain
				paranoid = minor_stress_impact_gain
			}
		}
		ai_chance = {
			base = 33

			ai_value_modifier = {
				ai_greed = 500
				ai_zeal = -200
				ai_rationality = -100
			}
		}
	}

	# Option B: Cynical Opt-Out (it really is a silly idea, even if it technically works)
	option = {
		name = learning_scholarship_special.3001.b
		add_character_modifier = {
			modifier = logical_thinking_modifier
			years = 5
		}
		cynical_progression_effect = yes


		stress_impact = {
			greedy = medium_stress_impact_gain
			ambitious = minor_stress_impact_gain
			humble = minor_stress_impact_gain
		}
		ai_chance = {
			base = 33

			ai_value_modifier = {
				ai_zeal = -100
				ai_rationality = 200
			}
		}
	}

	# Option C-1: Zealous Opt-Out (requires Greedy to be a sin)
	option = {
		trigger = {
			faith = {
				trait_is_sin = greedy
			}
		}
		name = learning_scholarship_special.3001.c

		add_piety = medium_piety_gain
		zealous_progression_effect = yes

		stress_impact = {
			cynical = medium_stress_impact_gain
			greedy = medium_stress_impact_gain
		}
		ai_chance = {
			base = 33

			ai_value_modifier = {
				ai_zeal = 200
			}
		}		
	}	

	# Option C-2: Zealous Opt-Out (requires Witchcraft to be shunned or criminal)
	option = {
		trigger = {
			faith = {
				NOR = {
					has_doctrine = doctrine_witchcraft_accepted
					trait_is_sin = greedy
				}
			}
		}
		name = learning_scholarship_special.3001.d
		
		add_piety = medium_piety_gain
		zealous_progression_effect = yes

		stress_impact = {
			cynical = medium_stress_impact_gain
			greedy = medium_stress_impact_gain
			ambitious = minor_stress_impact_gain
		}
		ai_chance = {
			base = 33

			ai_value_modifier = {
				ai_zeal = 200
			}
		}			
	}
}

# Okay, so how do we get our lead?
learning_scholarship_special.3002 = {
	type = character_event
	title = learning_scholarship_special.3001.t
	desc = learning_scholarship_special.3002.desc
	theme = learning_scholarship_focus
	left_portrait = root

	trigger = {
		NOR = {
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}
	on_trigger_fail = {
		trigger_event = learning_scholarship_special.3099
	}

	# Option A: Buy it! The safer choice.
	option = {
		trigger = {
			OR = {
				is_ai = no
				short_term_gold > medium_gold_value
			}
		}
		name = learning_scholarship_special.3002.a
		remove_short_term_gold = medium_gold_value
		custom_tooltip = learning_scholarship_special.3002.tt
		trigger_event = {
			id = learning_scholarship_special.3003
			days = { 11 17 }
		}

		stress_impact = {
			greedy = minor_stress_impact_gain
		}
		ai_chance = {
			base = 50

			ai_value_modifier = {
				ai_greed = -200
				ai_rationality = 200
			}
		}			
	}

	# Option B: Make it ourselves! Risk of gaining long-term lead poisoning, but low-Learning characters will earn a base Learning increase.
	option = {
		name = learning_scholarship_special.3002.b

		stress_impact = {
			lazy = minor_stress_impact_gain
			craven = minor_stress_impact_gain
		}

		if = {
			limit = {
				learning < high_skill_rating
			}
			add_learning_skill = 1
		}

		# Since the learning skill might be different if they get +1, we don't/can't want to reveal the exact event outcomes & their probabilities to the player
		show_as_tooltip = {
			duel = {
				skill = learning
				value = 0
				1 = {
					desc = learning_scholarship_special.3002.a.success
					show_chance = no
					add_learning_lifestyle_xp = medium_lifestyle_xp
				}
				1 = {
					desc = learning_scholarship_special.3002.a.failure
					show_chance = no
					add_character_modifier = {
						modifier = chronic_headaches_modifier
						years = 20
					}
					add_learning_lifestyle_xp = miniscule_lifestyle_xp
				}
			}
		}

		# Real dueal logic here
		hidden_effect = {
			duel = {
				skill = learning
				value = medium_skill_rating
				50 = {
					desc = learning_scholarship_special.3002.a.success
					send_interface_toast = {
						title = learning_scholarship_special.3002.a.success
						left_icon = root
						custom_tooltip = learning_scholarship_special.3002.tt
						add_learning_lifestyle_xp = medium_lifestyle_xp
					}
				}
				50 = {
					compare_modifier = {
						value = scope:duel_value
	  					multiplier = -10
	  					min = -49
	  				}
					desc = learning_scholarship_special.3002.a.failure
					send_interface_toast = {
						title = learning_scholarship_special.3002.a.failure
						left_icon = root
						add_character_modifier = {
							modifier = chronic_headaches_modifier
							years = 20
						}
						custom_tooltip = learning_scholarship_special.3002.tt
						add_learning_lifestyle_xp = miniscule_lifestyle_xp
					}
				}
			}
			trigger_event = {
				id = learning_scholarship_special.3003
				days = { 7 11 }
			}
		}

		ai_chance = {
			base = 50

			ai_value_modifier = {
				ai_energy = -100
				ai_boldness = 100
				ai_greed = 200
			}
		}		
	}
	
	# Option C: On second thought maybe experimenting with lead is a bad idea?
	option = {
		name = learning_scholarship_special.3002.c
		add_learning_lifestyle_xp = minor_lifestyle_xp
		ai_chance = {
			base = 0
		}	
	}	
}

# Lead obtained, now we need to get some seaweed...
learning_scholarship_special.3003 = {
	type = character_event
	title = learning_scholarship_special.3001.t
	desc = learning_scholarship_special.3003.desc
	
	theme = learning_scholarship_focus
	left_portrait = root

	trigger = {
		NOR = {
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}
	on_trigger_fail = {
		trigger_event = learning_scholarship_special.3099
	}

	# Option A: Buy it! Again!
	option = {
		trigger = {
			OR = {
				is_ai = no
				short_term_gold > medium_gold_value
			}
		}
		name = learning_scholarship_special.3003.a
		remove_short_term_gold = medium_gold_value
		custom_tooltip = learning_scholarship_special.3003.tt
		trigger_event = {
			id = learning_scholarship_special.3004
			days = { 11 17 }
		}

		stress_impact = {
			greedy = minor_stress_impact_gain
		}
		ai_chance = {
			base = 50

			ai_value_modifier = {
				ai_greed = -200
				ai_rationality = 100
			}
		}			
	}

	# Option B: Demand it from your vassals. They will do it, but think you a bit daft...
	option = {
		name = learning_scholarship_special.3003.b
		add_prestige = medium_prestige_loss
		custom_tooltip = learning_scholarship_special.3003.tt
		trigger_event = {
			id = learning_scholarship_special.3004
			days = { 21 28 }
		}

		stress_impact = {
			humble = minor_stress_impact_gain
			just = minor_stress_impact_gain
			gregarious = minor_stress_impact_gain
		}
		ai_chance = {
			base = 50

			ai_value_modifier = {
				ai_boldness = 200
				ai_rationality = -100
			}
		}		
	}
	
	# Option C: Opt-Out. Just use the lead you acquired in the previous event to make sweetened wine.
	option = {
		name = learning_scholarship_special.3003.c
		add_gold = minor_gold_value
		add_prestige = minor_prestige_gain
		add_learning_lifestyle_xp = minor_lifestyle_xp
		ai_chance = {
			base = 0
		}
	}
}

# Reagents obtained, time to experiment!
learning_scholarship_special.3004 = {
	type = character_event
	title = learning_scholarship_special.3001.t
	desc = learning_scholarship_special.3004.desc
	
	theme = learning_scholarship_focus
	left_portrait = root

	trigger = {
		NOR = {
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}
	on_trigger_fail = {
		trigger_event = learning_scholarship_special.3099
	}
	
	# Option A: Begin the experiment!
	option = {
		name = learning_scholarship_special.3004.a

		# We don't want to reveal the exact event outcomes & their probabilities to the player, so we will show this fake duel to them instead.
		show_as_tooltip = {
			duel = {
				skill = learning
				value = 0
				desc = outcome_in_a_few_days
				1 = {
					desc = learning_scholarship_special.3004.a.success
					show_chance = no
					custom_tooltip = learning_scholarship_special.3004.a.success.tt
					add_learning_lifestyle_perk_points = 1
				}
				1 = {
					desc = learning_scholarship_special.3004.a.failure
					show_chance = no
					custom_tooltip = learning_scholarship_special.3004.a.failure.tt
					add_learning_lifestyle_xp = minor_lifestyle_xp
				}
			}
		}

		# The real event outcome logic happens here.
		hidden_effect = {
			duel = {
				skill = learning
				value = medium_skill_rating
				# Low chance of getting a critical success, growing to ~50% at 15 skill.
				01 = {
					compare_modifier = {
						value = scope:duel_value
	  					multiplier = 20
	  				}
					trigger_event = {
						id = learning_scholarship_special.3005
						days = { 3 5 }
					}
				}
				# Above average chance of getting a success, which very slowly shrinks to ~45% at 15 skill.
				59 = {
					desc = learning_scholarship_special.3005.success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 5
					}
					trigger_event = {
						id = learning_scholarship_special.3006
						days = { 3 5 }
					}
				}
				# Below average chance of failing, which rapidly shrinks to 0% at 18 skill.
				40 = {
					desc = learning_scholarship_special.3005.failure
					compare_modifier = {
						value = scope:duel_value
						multiplier = -5
					}
					trigger_event = {
						id = learning_scholarship_special.3007
						days = { 3 5 }
					}
				}
			}
		}

		ai_chance = {
			base = 100
		}			
	}

	# Option B: Final chance for opt-out.
	option = {
		name = learning_scholarship_special.3004.b
		add_learning_lifestyle_xp = medium_lifestyle_xp
		add_character_modifier = {
			modifier = logical_thinking_modifier
			years = 10
		}

		ai_chance = {
			base = 0
		}	
	}
}

# Critical Success! Knowledge, Wealth, Glory... all mine!
learning_scholarship_special.3005 = {
	type = character_event
	title = learning_scholarship_special.3001.t
	desc = learning_scholarship_special.3005.desc
	theme = learning_scholarship_focus
	left_portrait = root

	trigger = {
		NOR = {
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}
	on_trigger_fail = {
		trigger_event = learning_scholarship_special.3099
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
	}

	option = {
		name = learning_scholarship_special.3005.a		
		add_learning_lifestyle_perk_points = 1
		add_gold = medium_gold_value
		add_prestige = major_prestige_gain
	}
}

# Success. Rank up + some gold gain.
learning_scholarship_special.3006 = {
	type = character_event
	title = learning_scholarship_special.3001.t
	desc = learning_scholarship_special.3006.desc
	theme = learning_scholarship_focus
	left_portrait = root

	trigger = {
		NOR = {
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}
	on_trigger_fail = {
		trigger_event = learning_scholarship_special.3099
	}

	option = {
		name = learning_scholarship_special.3006.a
		add_learning_lifestyle_perk_points = 1
		add_gold = minor_gold_value
	}
}

# Failure. No rank-up, but character is compensated with small province tax boost.
learning_scholarship_special.3007 = {
	type = character_event
	title = learning_scholarship_special.3001.t
	desc = learning_scholarship_special.3007.desc
	theme = learning_scholarship_focus
	left_portrait = root

	trigger = {
		NOR = {
			is_imprisoned = yes
			is_incapable_trigger = yes
		}
	}
	on_trigger_fail = {
		trigger_event = learning_scholarship_special.3099
	}
	
	option = {
		name = learning_scholarship_special.3007.a
		add_learning_lifestyle_xp = medium_lifestyle_xp
		if = {
			limit = {
				exists = capital_province
			}
			capital_province = {
				county = {
					add_county_modifier = {
						modifier = rich_fertilizer_modifier
						years = 3
					}
				}
			}
		}
	}
}

learning_scholarship_special.3099 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				is_imprisoned = yes
			}
			send_interface_toast = {
				title = learning_scholarship_special.3099.termination.toast
				custom_tooltip = learning_scholarship_special.3099.termination.desc.prison
			}
		}
		else = {
			send_interface_toast = {
				title = learning_scholarship_special.3099.termination.toast
				custom_tooltip = learning_scholarship_special.3099.termination.desc.incapable
			}
		}
	}
}

##################
# 4000 - Dear God, go outside. By Isabella Welch
##################

learning_scholarship.4000 = {
	type = character_event
	title = learning_scholarship.4000.t
	desc = learning_scholarship.4000.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = root
		animation = personality_callous
	}
	right_portrait = {
		character = scope:spouse_uninterested_in_study
		animation = boredom
	}
	lower_left_portrait = {
		character = scope:child_educated
	}
	override_background = {
		event_background = corridor_night
	}
	
	trigger = {
		NOT = { has_character_flag = has_had_learning_scholarship_4000 }
		has_focus = learning_scholarship_focus
		is_married = yes
		any_spouse = {
			NOR = {
				has_trait_rank = {
					trait = education_learning
					rank >= 1
				}			
				has_trait = intellect_good
			}
		}
	}
		
	

	weight_multiplier = {
		base = 1
	}

	immediate = {
		add_character_flag = {
			flag = has_had_learning_scholarship_4000 
			years = 5
		}
		if = {
			limit = {
				any_child = {
					has_focus = education_learning
					has_relation_guardian = root
					is_child_of = root
				}
			}
			random_child = {
				limit = {
					has_focus = education_learning
					has_relation_guardian = root
					is_child_of = root
				}
				save_scope_as = child_educated
			}
		}
		random_spouse = {
			weight = {
				base = 1
				compare_modifier = {
   					value = learning
   					multiplier = -0.5
   				}
			}
			save_scope_as = spouse_uninterested_in_study
		}
		if = {
			limit = {
				any_courtier_or_guest = {
					can_set_relation_lover_trigger = {
						CHARACTER = scope:spouse_uninterested_in_study
					}
				}
			}
			random_courtier_or_guest = {
				limit = {
					can_set_relation_lover_trigger = {
						CHARACTER = scope:spouse_uninterested_in_study
					}
				}
				save_scope_as = potential_new_spouse_lover
			}
		}
	}

	option = {
		name = learning_scholarship.4000.a
		add_character_modifier = {
			modifier = alluring_confidence
			years = 1
		}
		scope:spouse_uninterested_in_study = {
			add_opinion = {
				target = root
				opinion = 20
				modifier = grateful_opinion
			}
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = -0.5
			}
		}
  	}

	option = {
		name = learning_scholarship.4000.b
		trigger = {
			NOT = { exists = scope:child_educated }
		}
		scope:spouse_uninterested_in_study = {
			add_learning_skill = 2
			add_opinion = {
				target = root
				opinion = -20
				modifier = insulted_opinion
			}
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 0.5
			}
		}
	}
	
	option = {
		name = learning_scholarship.4000.c
		trigger = {
			exists = scope:child_educated
		}
		scope:child_educated = {
			add_learning_skill = 2
			add_opinion = {
				target = root
				opinion = 20
				modifier = supportive_parent
			}
		}
		if = {
			limit = {
				scope:spouse_uninterested_in_study = { 
					NOT = { is_parent_of = scope:child_educated }
				}
			}
			custom_tooltip = learning_scholarship.4000.c.tt
			scope:spouse_uninterested_in_study = {
				add_opinion = {
					target = root
					opinion = -15
					modifier = weak_opinion
				}
			}
		}
		add_character_modifier = {
			modifier = busy_tutoring_modifier
			years = 5
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_honor = 2
			}
		}
	}

	option = {
		name = learning_scholarship.4000.d
		add_character_modifier = {
			modifier = focused_reading_modifier
			years = 5
		}
		add_learning_lifestyle_xp = medium_lifestyle_xp
		scope:spouse_uninterested_in_study = {
			add_opinion = {
				target = root
				opinion = -40
				modifier = weak_opinion
			}
			hidden_effect = {
				if = {
					limit = { exists = scope:potential_new_spouse_lover }
					set_relation_lover = scope:potential_new_spouse_lover
				}
			}
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_rationality = 2
			}
		}
	}
}
