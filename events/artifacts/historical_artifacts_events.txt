namespace = historical_artifacts
# Generation of historical artifacts #

#Historical artifacts generator at game start
historical_artifacts.0023 = {
	type = empty
	hidden = yes

	immediate = {
		# Seeded Court Artifacts
		if = {
			limit = { has_dlc_feature = royal_court }
			# All starting courts will have a dynasty banner
			every_character_with_royal_court = {
				#Warcraft
				limit = { is_lowborn = no }
				save_scope_as = banner_ruler
				# House Banner
				set_variable = banner_from_house
				set_variable = startup_banner
				create_artifact_wall_banner_effect = {
					OWNER = scope:banner_ruler
					CREATOR = scope:banner_ruler
					TARGET = scope:banner_ruler.house
				}
				# Dynasty Banner
				If = {
					limit = {
						OR = {
							this = dynasty.dynast # Dynasty Head
							any_parent = { # Parent landless Dynasty Head
								employer = prev
								dynasty = prev.dynasty
								this = dynasty.dynast
							}
						}
					}
					set_variable = banner_from_dynasty
					set_variable = startup_banner
					create_artifact_wall_banner_effect = {
						OWNER = scope:banner_ruler
						CREATOR = scope:banner_ruler
						TARGET = scope:banner_ruler.dynasty
					}
				}
			}
			#Warcraft
			# Court Artifacts: Christianity
			#while = {
			#	count = 6
			#	random_character_with_royal_court = {
			#		limit = {
			#			like_christianity_religion_trigger = yes
			#			NOT = { has_character_flag = seeded_relic }
			#		}
			#		create_artifact_pedestal_christian_relic_effect_hist = { OWNER = this }
			#		add_character_flag = {
			#			flag = seeded_relic
			#			days = 1
			#		}
			#	}
			#}
			## Court Artifacts: Islam
			#while = {
			#	count = 6
			#	random_character_with_royal_court = {
			#		limit = {
			#			like_islam_religion_trigger = yes
			#			NOT = { has_character_flag = seeded_relic }
			#		}
			#		create_artifact_pedestal_islamic_relic_effect_hist = { OWNER = this }
			#		add_character_flag = {
			#			flag = seeded_relic
			#			days = 1
			#		}
			#	}
			#}
			## Court Artifacts: Buddhism
			#while = {
			#	count = 6
			#	random_character_with_royal_court = {
			#		limit = {
			#			like_buddhism_religion_trigger = yes
			#			NOT = { has_character_flag = seeded_relic }
			#		}
			#		create_artifact_pedestal_buddhism_relic_effect_hist = { OWNER = this }
			#		add_character_flag = {
			#			flag = seeded_relic
			#			days = 1
			#		}
			#	}
			#}
		}
		#Warcraft
		#if = {
		#	limit = { has_dlc_feature = royal_court } #Court Artifacts
		#	while = {
		#		count = 2
		#		random_ruler = {
		#			limit = {
		#				like_germanic_religion_trigger = yes
		#				NOT = { has_character_flag = seeded_relic }
		#				has_royal_court = yes
		#			}
		#			create_artifact_pedestal_branch_relic_germanic_effect = { OWNER = this }
		#			add_character_flag = {
		#				flag = seeded_relic
		#				days = 1
		#			}
		#		}
		#	}
		#}
		#if = {
		#	limit = { has_dlc_feature = royal_court } #Court Artifacts
		#	while = {
		#		count = 5
		#		random_in_list = {
		#			list = potential_votive_crown_holders_list
		#			limit = {
		#				like_hinduism_religion_trigger = yes
		#				NOT = { has_character_flag = seeded_relic }
		#			}
		#			create_artifact_pedestal_branch_relic_hinduism_effect = { OWNER = this }
		#			add_character_flag = {
		#				flag = seeded_relic
		#				days = 1
		#			}
		#		}
		#	}
		#}

		#if = {
		#	limit = { has_dlc_feature = royal_court } #Court Artifacts
		#	random_ruler = {
		#		limit = {
		#			like_west_african_roog_religion_trigger = yes
		#		}
		#		create_artifact_pedestal_branch_relic_boog_effect = { OWNER = this }
		#	}
		#}

		#if = {
		#	limit = { has_dlc_feature = royal_court } #Court Artifacts
		#	random_ruler = {
		#		limit = {
		#			like_slavic_religion_trigger = yes
		#		}
		#		create_artifact_pedestal_branch_relic_slavic_effect = { OWNER = this }
		#	}
		#}
		#Warcraft

		#Historical Artifacts
		random_ruler = {
			limit = { has_title = title:k_lordaeron }
			create_artifact_terenas_crown_effect = { OWNER = this }
		}
		# Warcraft

		# Frostmourne
		if = {
			limit = {
				exists = character:60003 # Arthas
				character:60003 = { is_alive = yes }
				game_start_date >= 603.4.1
			}
			character:60003 = { create_artifact_frostmourne_effect = { OWNER = this } }
		}
		# Light's Vengeance
		if = {
			limit = {
				exists = character:60003 # Arthas
				character:60003 = { is_alive = yes }
				game_start_date <= 603.3.30
			}
			character:60003 = { create_artifact_lights_vengeance_effect = { OWNER = this } }
		}
		# Bite of the Bleeding Hollow
		if = {
			limit = {
				exists = character:10005 # Kilrogg
				character:10005 = { is_alive = yes }
			}
			character:10005 = { create_artifact_bite_of_the_bleeding_hollow_effect = { OWNER = this } }
		}
		# testing
		if = {
			limit = {
				exists = character:48080 # Daelin
				character:48080 = { is_alive = yes }
			}
			character:48080 = { create_artifact_daelins_saber_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:10000 # Blackhand
				character:10000 = { is_alive = yes }
			}
			character:10000 = { create_artifact_the_black_hand_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:2 # Llane
				character:2 = { is_alive = yes }
			}
			character:2 = { create_artifact_lions_fang_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:80038 # Malakk
				character:80038 = { is_alive = yes }
			}
			character:80038 = { create_artifact_zerat_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:330003 # Lady Vashj
				character:330003 = { is_alive = yes }
			}
			character:330003 = { create_artifact_frostfathom_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:17002 # Muradin
				character:17002 = { is_alive = yes }
			}
			character:17002 = { create_artifact_mithros_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:17002 # Muradin
				character:17002 = { is_alive = yes }
			}
			character:17002 = { create_artifact_troggbane_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:42002 # Anasterian Sunstrider
				character:42002 = { is_alive = yes }
			}
			character:42002 = { create_artifact_felomelorn_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:42003 # Kael'thas Sunstrider
				character:42003 = { is_alive = yes }
				game_start_date >= 605.6.6
			}
			character:42003 = { create_artifact_felomelorn_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:340009 # Illidan
				character:340009 = { is_alive = yes }
			}
			character:340009 = { create_artifact_twin_blades_of_azzinoth_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:38001 # Thoras Trollbane
				character:38001 = { is_alive = yes }
			}
			character:38001 = { create_artifact_trolkalar_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:17001 # Magni
				character:17001 = { is_alive = yes }
			}
			character:17001 = { create_artifact_fearbreaker_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:12002 # Thaurissan
				character:12002 = { is_alive = yes }
			}
			character:12002 = { create_artifact_ironfoe_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:10002 # Dal'rend
				character:10002 = { is_alive = yes }
			}
			character:10002 = { create_artifact_doomsaw_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:68001 # Vol'jin
				character:68001 = { is_alive = yes }
			}
			character:68001 = { create_artifact_nekana_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:57000 # Zul'jin
				character:57000 = { is_alive = yes }
			}
			character:57000 = { create_artifact_blade_of_zuljin_effect = { OWNER = this } }
		}
		if = {
			limit = {
				exists = character:60693# Luc Valenforth
				character:60693 = { is_alive = yes }
			}
			character:60693 = { create_artifact_might_of_menethil_effect = { OWNER = this } }
		}
	}
}


#Save a memorable battle as potential topic for artifacts
historical_artifacts.0100 = {
	hidden = yes
	scope = combat_side

	trigger = {
		# Check to ensure all needed scopes are valid
		exists = combat.location
		exists = side_primary_participant
		exists = enemy_side.side_primary_participant

		# Check if this battle was important enough to be memorialized
		calc_true_if = {
			amount >= 2
			any_in_list = {
				list = slain_combatants
				OR = {
					this = root.enemy_side.side_primary_participant
					is_heir_of = root.enemy_side.side_primary_participant
				}
			}
			any_in_list = {
				list = prisoners_of_war
				OR = {
					this = root.enemy_side.side_primary_participant
					is_heir_of = root.enemy_side.side_primary_participant
				}
			}
			troops_ratio <= 0.5
			num_enemies_killed >= 10000
			AND = {
				percent_enemies_killed >= 75
				combat = {
					num_total_troops >= 20000
				}
			}
			combat = {
				OR = {
					num_total_troops >= 30000
					warscore_value >= 25
				}
			}
		}
	}

	immediate = {
		side_primary_participant = {
			if = {
				limit = {
					exists = var:epic_battle_location
				}
				remove_variable = epic_battle_location
			}
			if = {
				limit = {
					exists = var:epic_loser
				}
				remove_variable = epic_loser
			}
			set_variable = {
				name = epic_battle_location
				value = root.combat.location
				years = 5
			}
			set_variable = {
				name = epic_loser
				value = root.enemy_side.side_primary_participant
				years = 5
			}
		}
	}
}
