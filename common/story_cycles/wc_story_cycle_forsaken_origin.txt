story_cycle_forsaken_origins = { 
	on_setup = {
		#possibly make it so that only one person can ever get this story cycle
		story_owner = { 
			if = { 
				limit = { 
					is_independent_ruler = no
				}
				top_liege = {
					trigger_event = { 
						id = forsaken.1000
						days = 7 
					}
				}
			} 
			set_global_variable = { name = sylvanas_character value = this }
		}
	}

	on_end = {
		#possibly make it so that no one can ever get this story cycle again
	}

	on_owner_death = {
		if = { 
			limit = { exists = story_owner }
			try_to_set_forsaken_origin_story_owner = { NEW_OWNER = story_owner.primary_heir }
		}
		else = {
			end_story = yes
		}
	}

	#events that can happen during construction of undercity
	effect_group = { #Effect Group A
		days = 7
		
		trigger = { 
			title:b_lordaeron = { 
				has_variable = develop_the_undercity
				OR = { 
					var:develop_the_undercity ?= flag:construction
					var:develop_the_undercity ?= flag:ready
				}
			}
		}

		#check for ownership of lordaeron
		triggered_effect = { 
			trigger = { 
				title:b_lordaeron.holder = { 	
					self_or_liege_is_of_forsaken_like_culture = no	
				}
			}
			effect = { 
				story_owner = { 
					trigger_event = { 
						id = forsaken.1002
						days = 7
						delayed = yes
					}
				}
			}
		}

		# TODO: Figure out a way to get this to work!
		# chance to delay construction if control is low
		# triggered_effect = { 
		# 	trigger = { 
		# 		title:c_lordaeron = { 
		# 			county_control < 25
		# 			NOT = { is_target_of_council_task = task_increase_control }
		# 		}
		# 	}
		# 	effect = { 
		# 		story_owner = { 
		# 			send_interface_toast = {
		# 				title = build_the_undercity_setback.tt
		# 				left_icon = scope:host
		# 				custom_tooltip = build_the_undercity_setback.details.tt
		# 				hidden_effect = {
							
		# 				}
		# 			}
		# 		}
		# 	}
		# }
	}


	#undercity ready events
	#TODO: different event/description for owner of the city if different from story owner
	#TODO: different event/description for owner of the city if story owner is not their liege but they are forsaken-like
	effect_group = { #Effect Group B
		days = 30

		trigger = { 
			title:b_lordaeron = { 
				has_variable = develop_the_undercity
				var:develop_the_undercity ?= flag:ready
			}
		}

		triggered_effect = { 
			trigger = { 
				title:b_lordaeron.holder = { 
					self_or_liege_is_of_forsaken_like_culture = yes
				}
			}
			effect = { 
				debug_log = "SS - story_cycle_forsaken_origins"
				story_owner = { 
					trigger_event = { 
						id = forsaken.1001
						days = 7
					}
				}
				if = { limit = { NOT = {title:b_lordaeron.holder = story_owner} }
					title:b_lordaeron.holder = { 
						trigger_event = { 
							id = forsaken.1004
							days = 7
						}
					}
				}
			}
		}
	}
}