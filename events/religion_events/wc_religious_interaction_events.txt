namespace = wc_religious_interaction

#################################
# Surrender to the Inquisition	#
# by ElMariuso and Dione	    #
# 1010-1012						#
#################################

#Ask for Surrender
wc_religious_interaction.1010 = {
	type = letter_event

	opening = {
		desc = religious_interaction.1.opening
	}

	desc = wc_religious_interaction.1010

	sender = {
		character = scope:actor
		animation = shame
	}
	
	option = {
		name = wc_religious_interaction.1010.accept

		scope:actor = {
			trigger_event = {
				id = wc_religious_interaction.1011
				days = 5
			}
		}

		add_piety = massive_piety_loss
		add_character_modifier = {
			modifier = heresy_allowed_repentance_modifier
			days = 90
		}
		
		ai_chance = {
			base = 90
			# Inquisitor has a good opinion of the marked 
			modifier = {
				add = 25
				opinion = {
					value > 0
					target = scope:actor
				}
			}
			modifier = { # Inquisitor is a nice person
				add = 15
				OR = {
					has_trait = forgiving
					has_trait = compassionate
				}
			}
			modifier = {
				add = 15 # Marked is zealous/pilgrim, meaning they are more likely to repent
				OR = {
					scope:actor = { has_trait = zealous }
					scope:actor = { has_trait = pilgrim }
				}
			}
		}
	}

	option = {
		name = wc_religious_interaction.1010.refuse

		scope:actor = {
			trigger_event = {
				id = wc_religious_interaction.1012
				days = 5
			}
		}
		
		add_piety = massive_piety_gain
		add_character_modifier = {
			modifier = heresy_denied_repentance_modifier
			days = 90
		}

		ai_chance = {
			base = 10
			# Inquisitor has a bad opinion of the marked 
			modifier = {
				add = 10
				opinion = {
					value < 0
					target = scope:actor
				}
			}
			modifier = { # Marked has some sinful traits
				add = {
					add = 15
					multiply = scope:actor.num_sinful_traits
				}
				scope:actor.num_sinful_traits > 0
			}
			modifier = { # Marked is not really religious
				add = 15
				scope:actor = { has_trait = cynical }
			}
			modifier = { # Had the scarlet mark for over a year 
				add = 15
				scope:actor = { NOT = { has_character_modifier = recent_scarlet_mark_modifier } }
			}
			modifier = { # Inquisitor's persona
				add = 20
				OR = {
					has_trait = callous
					has_trait = arrogant
				}
			}
			modifier = { # Inquisitor doesn't believe they can repent
				add = 10
				has_trait = cynical 
			}
		}
	}
}

#Surrender Accepted
wc_religious_interaction.1011 = {
	type = letter_event
	opening = {
		desc = religious_interaction.1.opening
	}
	desc = wc_religious_interaction.1011
	
	sender = {
		character = scope:inquisitor
		animation = scheme
	}
	
	
	option = {
		name = {
			text = { 
				first_valid = {
					triggered_desc = {
						trigger = { 
							OR = {
								has_trait = zealous
								has_trait = brave
							}
						}
						desc = wc_religious_interaction.1011.zealous
					}
					triggered_desc = {
						trigger = { 
							OR = {
								has_trait = cynical
								has_trait = impatient
							}
						}
						desc = wc_religious_interaction.1011.cynical
					}
					triggered_desc = {
						trigger = { has_trait = deceitful }
						desc = wc_religious_interaction.1011.deceitful
					}
					triggered_desc = {
						trigger = { has_trait = arrogant }
						desc = wc_religious_interaction.1011.arrogant
					}
					triggered_desc = {
						desc = wc_religious_interaction.1011.normal
					}
				} 
			}
		}

		ai_chance = {
			base = 10
		}
	}

	after = {
		hidden_effect = { surrender_to_inquistion_effect = yes }
	}
}

#Surrender Refused
wc_religious_interaction.1012 = {
	type = letter_event
	opening = {
		desc = religious_interaction.1.opening
	}
	desc = wc_religious_interaction.1012
	sender = {
		character = scope:inquisitor
		animation = scheme
	}
	
	immediate = {}
	
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { has_trait = deceitful }
						desc = wc_religious_interaction.1012.deceitful
					}
					triggered_desc = {
						trigger = { has_trait = paranoid }
						desc = wc_religious_interaction.1012.paranoid
					}
					triggered_desc = {
						trigger = { has_trait = zealous }
						desc = wc_religious_interaction.1012.zealous
					}
					triggered_desc = {
						trigger = { has_trait = cynical }
						desc = wc_religious_interaction.1012.cynical
					}
					triggered_desc = {
						trigger = { has_trait = arrogant }
						desc = wc_religious_interaction.1012.arrogant
					}
					triggered_desc = {
						desc = wc_religious_interaction.1012.normal
					}
				}
			}
		}

		ai_chance = {
			base = 10
		}
	}
	
}

#####################
# Scarlet Mark 		#
# by ElMariuso		#
# 1020-1025			#
#####################

#Scarlet Marked (Requested by another Ruler)
wc_religious_interaction.1020 = {
	type = letter_event
	opening = {
		desc = religious_interaction.1.opening
	}
	desc = {
		desc = wc_religious_interaction.1020
		desc = wc_religious_interaction.1021
	}
	sender = {
		character = scope:recipient
		animation = schadenfreude
	}

	immediate = { add_scarlet_mark_tooltip_only_effect = yes }

	option = {
		name = religious_interaction.1000.strong_negative
	}
}

#Scarlet Mark (Priest's own initiative)
wc_religious_interaction.1021 = {
	type = letter_event
	orphan = yes
	opening = {
		desc = religious_interaction.1.opening
	}
	desc = wc_religious_interaction.1021
	sender = {
		character = scope:recipient
		animation = anger
	}

	immediate = { add_scarlet_mark_tooltip_only_effect = yes }

	option = {
		name = religious_interaction.1000.strong_negative
	}
}

#Scarlet Requester informed the Inquisitor accepted their request.
wc_religious_interaction.1022 = {
	type = letter_event
	opening = {
		desc = religious_interaction.1.opening
	}
	desc = wc_religious_interaction.1022
	sender = scope:recipient
	
	immediate = {
		scope:secondary_recipient = { add_scarlet_mark_tooltip_only_effect = yes }
	}
	option = {
		name = religious_interaction.1000.positive
	}
}

#Scarlet Mark Requester informed the Inquisitor denied their request.
wc_religious_interaction.1023 = {
	type = letter_event
	opening = {
		desc = religious_interaction.1.opening
	}
	desc = wc_religious_interaction.1023
	sender = {
		character = scope:recipient
		animation = dismissal
	}

	option = {
		name = religious_interaction.1000.negative
	}
}

#Priest lifts Scarlet Mark.
wc_religious_interaction.1024 = {
	type = letter_event
	opening = {
		desc = religious_interaction.1.opening
	}
	desc = wc_religious_interaction.1024
	sender = {
		character = scope:recipient
		animation = personality_zealous
	}
	
	#immediate = {
	#	show_as_tooltip = {
	#		declaration_of_repentance_interaction_effect = yes
	#	}
	#}

	option = {
		name = religious_interaction.1024.positive
	}
}

#Inquisitor refuses to lift Scarlet Mark.
wc_religious_interaction.1025 = {
	type = letter_event

	opening = {
		desc = religious_interaction.1.opening
	}
	desc = wc_religious_interaction.1025

	sender = {
		character = scope:recipient
		animation = dismissal
	}

	option = {
		name = religious_interaction.1000.strong_negative
	}
}

#################################
# Sent to the Inquisiton		#
# by Dione		                #
# 1110-  			            #
#################################

# Letter informing the sender that the prisoner has arrived
wc_religious_interaction.1110 = {
	type = letter_event

	opening = {
		desc = religious_interaction.1.opening
	}

	desc = wc_religious_interaction.1110
	sender = {
		character = scope:inquisitor
		animation = personality_zealous
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { has_trait = zealous }
						desc = wc_religious_interaction.1110.zealous
					}
					triggered_desc = {
						trigger = { has_trait = vengeful }
						desc = wc_religious_interaction.1110.vengeful
					}
					triggered_desc = {
						desc = wc_religious_interaction.1110.normal
					}
				}
			}
		}

		add_short_term_gold = 75
		add_piety = 150
		
		scope:inquisitor = {
			add_opinion = {
				modifier = sent_a_heretic_opinion
				target = scope:actor
			}
			add_short_term_gold = -75
			add_piety = -150
		}
	}
}

# Letter for prisoner stating that they were sent to the inquisition
wc_religious_interaction.1115 = {
	type = letter_event

	opening = {
		desc = religious_interaction.1.opening
	}

	desc = wc_religious_interaction.1115

	sender = {
		character = scope:actor
		animation = dismissal
	}

	option = {
		name = religious_interaction.1000.strong_negative

		imprison_character_effect = {
			TARGET = scope:recipient
			IMPRISONER = scope:inquisitor
		}
	}
}