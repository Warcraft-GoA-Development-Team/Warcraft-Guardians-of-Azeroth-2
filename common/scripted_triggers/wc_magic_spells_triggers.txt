is_known_spell_trigger = {
	custom_description = {
		text = is_known_spell_trigger
		AND = {
			has_variable_list = known_spells
			is_target_in_variable_list = { name = known_spells target = $SPELL$ }
		}
	}
}

spell_on_cooldown_trigger = {
	custom_description = {
		text = spell_on_cooldown_trigger
		AND = {
			has_variable_list = spells_cd
			is_target_in_variable_list = { name = spells_cd target = $SPELL$ }
		}
	}
}

has_unlocked_spell_rank_trigger = {
	trigger_if = {
		limit = { # You know all ranks of the spell if you know the spell and it has no ranks
			NOT = { spell_has_ranks_trigger = { SPELL = $SPELL$ } } 
		}
		is_known_spell_trigger = { SPELL = $SPELL$ }
	}
	trigger_else_if = {
		limit = {
			$SPELL_RANK$ = flag:rank_1
		}
		has_variable_list = known_spells
		is_target_in_variable_list = {
			name = known_spells
			target = $SPELL$
		}
	}
	trigger_else_if = {
		limit = {
			$SPELL_RANK$ = flag:rank_2
		}
		has_variable_list = known_rank_2_spells
		is_target_in_variable_list = {
			name = known_rank_2_spells
			target = $SPELL$
		}
	}
	trigger_else_if = {
		limit = {
			$SPELL_RANK$ = flag:rank_3
		}
		has_variable_list = known_rank_3_spells
		is_target_in_variable_list = {
			name = known_rank_3_spells
			target = $SPELL$
		}
	}
}

can_cast_another_spell_trigger = {
	custom_description = {
		text = can_cast_another_spell_trigger
		# Only up to 5 spells casting at once, and you cant cast the same spell at once
		OR = {
			AND = {
				has_variable_list = current_spells_casting
				variable_list_size = { name = current_spells_casting value < 5 }
			}
			NOT = { has_variable_list = current_spells_casting }
		}
	}
}

is_casting_spell_trigger = {
	custom_description = {
		text = is_casting_spell_trigger
		has_variable_list = current_spells_casting
		is_target_in_variable_list = { name = current_spells_casting target = $SPELL$ }
	}
}

has_sufficient_mana_trigger = {
	custom_description = {
		text = has_sufficient_mana_trigger
		trigger_if = {
			limit = {
				has_variable = current_spell_mana_cost
			}
			var:current_spell_mana_cost <= var:wc_current_mana_variable
		}
	}
}

all_requirements_for_casting_satisfied_trigger = {
	has_spell_selected_trigger = yes
	has_sufficient_mana_trigger = yes
	has_selected_spell_rank_trigger = yes
	has_selected_elemental_type_trigger = yes
	has_spell_target_selected_trigger = yes
	NOR = {
		AND = {
			has_variable_list = spell_targets_list
			any_in_list = {
				variable = spell_targets_list
				root = {
					target_has_max_stacks_trigger = {
						SPELL = var:current_spell_name
						TARGET = prev
						RANK = var:current_spell_rank
					}
				}
			}
		}
		AND = {
			exists = var:spell_recipient
			target_has_max_stacks_trigger = {
				SPELL = var:current_spell_name
				TARGET = var:spell_recipient
				RANK = var:current_spell_rank
			}
		}
		custom_tooltip =  {
			text = wc_spell_no_knights
			#OR = {
				var:current_spell_name = flag:flame_shock
			#}
			var:spell_recipient = { any_knight = { count = 0 }}
		}
		custom_tooltip =  {
			text = wc_spell_is_magic_user
			#OR = {
				var:current_spell_name = flag:burnout
			#}
			var:spell_recipient = { is_magic_user_trigger = no }
		}
	}
}

has_spell_selected_trigger = {
	custom_description = {
		text = has_spell_selected_trigger
		exists = var:current_spell_name
	}
}

has_spell_target_selected_trigger = {
	custom_description = {
		text = has_spell_target_selected_trigger
		OR = {
			exists = var:spell_recipient
			has_variable_list = spell_targets_list
		}
	}
}

has_spell_selected_targets_trigger = {
	custom_description = {
		text = has_spell_selected_targets_trigger
		OR = {
			exists = var:spell_recipient
			has_variable_list = spell_targets_list
		}
	}
}

has_selected_spell_rank_trigger = {
	custom_description = {
		text = has_selected_spell_rank_trigger
		OR = {
			AND = {
				exists = var:current_spell_rank
				NOT = { var:current_spell_rank = 0 }
				spell_has_ranks_trigger = {
					SPELL = var:current_spell_name
				}
			}
			NOT = {
				spell_has_ranks_trigger = {
					SPELL = var:current_spell_name
				}
			}
		}
	}
}

has_selected_elemental_type_trigger  = {
	custom_description = {
		text = has_selected_elemental_type_trigger
		AND = {
			exists = var:elemental_type
			spell_is_elemental_trigger = {
				SPELL = var:current_spell_name
			}
		}
	}
}

has_max_targets_trigger = {
	custom_description = {
		text = has_max_targets_trigger
		AND = {
			has_variable_list = spell_targets_list 
			variable_list_size = {
				name = spell_targets_list
				value >= 3
			}
		}
	}
}

# ### IF YOUR SPELL CAN BE CHANNELED # REMOVING THIS FOR NOW
# can_channel_spell_trigger = {
# 	# spell names here 
# }

### SPELL TARGET TRIGGERS ###
## ONLY ONE CAN BE TRUE PER RANK ###
## THESE DON'T NEED LOCALIZATION, FOR NOW ##
### IF THE SPELL HAS NO RANKS, PUT RANK_VALUE AS 0 ###
### IF THE SPELL HAS RANKS, ONLY ONE CAN BE TRUE FOR EACH RANK. ###

target_has_max_stacks_trigger = {
	custom_description = {
		text = target_has_max_stacks_trigger
		trigger_if = {
			limit = {
				$SPELL$ = flag:summon_fire_elemental
				$RANK$ = 1
			} # Max 1 stack
			$TARGET$ = { has_character_modifier = wc_summon_fire_elemental_modifier }
		}
		trigger_else_if = {
			limit = {
				$SPELL$ = flag:summon_fire_elemental
				$RANK$ >= 2
			} # Max 1 stack
			OR = {
				$TARGET$.holder ?= { has_character_flag = has_fire_elemental_maa }
				$TARGET$.liege ?= { has_character_flag = has_fire_elemental_maa }
			}
		}
		trigger_else_if = {
			limit = {
				$SPELL$ = flag:lava_lash
			} # 3 stacks
			$TARGET$.title_province = { has_variable = lava_lash_3 }
		}
		trigger_else_if = {
			limit = {
				$SPELL$ = flag:backdraft
				$RANK$ <= 2
			} # Max 1 stack
			$TARGET$.title_province = { has_variable = backdraft_monitor }
		}
		trigger_else_if = {
			limit = {
				$SPELL$ = flag:backdraft
				$RANK$ = 3
			} # Max 1 stack
			$TARGET$ = { has_variable = backdraft_monitor }
		}
		trigger_else_if = {
			limit = {
				$SPELL$ = flag:flame_wall
			} # Max 1 stack
			OR = {
				$TARGET$ = { has_variable = flame_wall_remainder }
				$TARGET$.army_commander = { has_character_modifier = wc_flame_wall_good_modifier }
				$TARGET$.army_commander = { has_character_modifier = wc_flame_wall_bad_modifier }
			}
		}
		trigger_else_if = {
			limit = {
				$SPELL$ = flag:flame_shock
			} # worst trait
			$TARGET$ = { has_trait = burned_3 }
		}
		trigger_else_if = {
			limit = {
				$SPELL$ = flag:burnout
			} # Max 1 stack
			OR = {
				has_character_modifier = wc_burnout_modifier 
				has_character_modifier = wc_burnout_good_modifier 
				$TARGET$ = { has_character_modifier = wc_burnout_modifier }
				$TARGET$ = { has_character_modifier = wc_burnout_good_modifier }
			}
		}
	}
}

spell_target_is_character_list_trigger = { # Multiple characters
	#OR = {
		AND = { $SPELL$ = flag:placeholder $RANK_VALUE$ = 1 }
	#}
}

spell_target_is_province_or_title_trigger = { # One title
	OR = {							# Works for ranks 2 AND 3
		AND = { $SPELL$ = flag:summon_fire_elemental $RANK_VALUE$ >= 2  }
		AND = { $SPELL$ = flag:lava_lash $RANK_VALUE$ = 0 }
		AND = { $SPELL$ = flag:backdraft $RANK_VALUE$ = 1 }
	}	
}

spell_target_is_province_or_title_list_trigger = { # Multiple titles
	#OR = {
		AND = { $SPELL$ = flag:backdraft $RANK_VALUE$ >= 2 }
	#}
}

spell_target_is_character_trigger = { # One character
	OR = {
		AND = { $SPELL$ = flag:flame_shock $RANK_VALUE$ = 0 }
		AND = { $SPELL$ = flag:burnout $RANK_VALUE$ = 0 }
		AND = { $SPELL$ = flag:planar_fire $RANK_VALUE$ = 0 }
		AND = { $SPELL$ = flag:summon_fire_elemental $RANK_VALUE$ = 1 }
	}
}

### for spells that target title, must specify which kind of title and rak.
spell_target_title_subtype_province_trigger = {
	OR = {
		AND = { $SPELL$ = flag:summon_fire_elemental $RANK_VALUE$ >= 2  }
		AND = { $SPELL$ = flag:lava_lash $RANK_VALUE$ = 0 }
		AND = { $SPELL$ = flag:backdraft $RANK_VALUE$ <= 2 }
	}
}

spell_target_title_subtype_county_trigger = {
	#OR = {
		AND = { $SPELL$ = flag:backdraft $RANK_VALUE$ = 3 }
	#}
}

spell_target_title_subtype_duchy_trigger = {
	#OR = {
		AND = { $SPELL$ = flag:placeholder $RANK_VALUE$ = 1 }
	#}
}

spell_target_is_only_self_trigger = { # only on yourself, this doesnt use rank_value atm
	OR = {
		$SPELL$ = flag:flame_wall 
		$SPELL$ = flag:planar_fire
	}
}

## can be both friendly and enemy army but if they are in both triggers, they both must have different effects
spell_target_is_friendly_army_trigger = {
	#OR = {
		AND = { $SPELL$ = flag:flame_wall $RANK_VALUE$ = 0 }
	#}
}

spell_target_is_enemy_army_trigger = {
	#OR = {
		AND = { $SPELL$ = flag:flame_wall $RANK_VALUE$ = 0 }
	#}
}

## ELEMENTAL SPELLS GO HERE
spell_is_elemental_trigger = {
	OR = {
		$SPELL$ = flag:summon_fire_elemental
		$SPELL$ = flag:lava_lash
		$SPELL$ = flag:backdraft
		$SPELL$ = flag:flame_wall
		$SPELL$ = flag:flame_shock
		$SPELL$ = flag:burnout
		$SPELL$ = flag:planar_fire
	}
}

## if it's not either or both, you don't need to put. just wont get opinion modifier/add opinion modifier manually in spell
spell_is_harmful_trigger = { # To the recipient(s)
	OR = {
		$SPELL$ = flag:lava_lash
		$SPELL$ = flag:flame_shock
		$SPELL$ = flag:burnout
	}
}

spell_is_helpful_trigger = { # To the recipient(s)
	#OR = {
		$SPELL$ = flag:summon_fire_elemental
	#}
}

## IF YOUR SPELL HAS RANKS IT GOES HERE
spell_has_ranks_trigger = {
	OR = {
		$SPELL$ = flag:summon_fire_elemental
		$SPELL$ = flag:backdraft
	}
}

spell_is_ritual_trigger = { # RITUALS GO HERE
#	OR = {
		$SPELL$ = flag:planar_fire
#	}
}

## SPECIAL SPELL TRIGGERS. IF YOUR SPELL HAS NO SPECIAL TRIGGERS TO CAST, JUST DO ALWAYS = YES ##
## ADD A CUSTOM DESCRIPTION FOR THE PLAYER IF NEEDED. ##
## CAN ALSO USE all_requirements_for_casting_satisfied_trigger IF YOU WANT IT TO CALL AFTER THE TARGET & SPELL IS SELECTED ##
satisfy_spell_triggers = {
	trigger_if = { # For spells that have no special triggers
		limit = {
			OR = {
				$SPELL$ = flag:summon_fire_elemental
				$SPELL$ = flag:lava_lash
				$SPELL$ = flag:backdraft
				$SPELL$ = flag:flame_shock
				$SPELL$ = flag:planar_fire
			}
		}
		always = yes 
	}
	trigger_else_if = { # You need to be at war to cast this spell
		limit = {
			#OR = {
				$SPELL$ = flag:flame_wall
			#}
		}
		is_at_war = yes
	} 
	trigger_else_if = { # The target must be landed
		limit = {
			#OR = {
				$SPELL$ = flag:flame_shock
			#}
		}
		OR = {
			var:spell_recipient ?= {
				is_landed = yes
			}
			var:original_recipient ?= {
				is_landed = yes
			}
		}
	}
	trigger_else_if = { # You can't cast on yourself
		limit = {
			#OR = {
				$SPELL$ = flag:burnout
			#}
		}
		custom_tooltip = {
			text = wc_spell_is_self
			NOR = {
				var:spell_recipient ?= root
				var:original_recipient ?= root
			}
		}
	}
}