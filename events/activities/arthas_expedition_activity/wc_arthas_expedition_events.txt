namespace = wc_arthas_story

# Delays
@travel_delay = 7
@long_travel_delay = 14
@sail_delay = 30
@stratholme_delay = 4

### Arthas gets several knights for expedition
wc_arthas_story.9 = {
	scope = none
	hidden = yes
	
	immediate = {
		i_need_a_knight_effect = yes
		i_need_a_knight_effect = yes
		i_need_a_knight_effect = yes
		i_need_a_knight_effect = yes
	}
}
### Arthas gather a group to investigate the Plague. Uther (or trusted knight), Jaina (or trusted mage), Falric, Marwyn (or other trusted knights join)
wc_arthas_story.10 = {
	type = activity_event
	title = wc_arthas_story_10_TITLE
	desc = {
		desc = wc_arthas_story_10_DESC_beggining
		triggered_desc = {
			trigger = {
				root = scope:host
			}
			desc = wc_arthas_story_10_DESC_arthas
		}
		desc = wc_arthas_story_10_DESC_ending
	}
	theme = plague
	override_background = {
		reference = farmland
	}
	right_portrait = {
		character = scope:host
		animation = personality_bold
	}
	lower_right_portrait = {
		character = scope:uther
		animation = marshal
	}
	lower_center_portrait = {
		character = scope:jaina
		animation = worry
	}
	
	trigger = {
		exists = scope:activity
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }

			find_uther_effect = yes
			find_jaina_effect = yes
			scope:uther = {
				if = {
					limit = { is_commanding_army = yes }
					commanding_army ?= { remove_commander = yes }
				}
				else_if = {
					limit = {
						is_in_army = yes
					}
					set_knight_status = forbid
				}
				set_location = global_var:andorhal_province
				custom_description = {
					text = join_draenor_expedition_tooltip
					
					object = scope:activity
					
					add_to_activity_without_travel = scope:activity
				}
				trigger_event = wc_arthas_story.10
			}

			scope:jaina = {
				if = {
					limit = { is_commanding_army = yes }
					commanding_army ?= { remove_commander = yes }
				}
				else_if = {
					limit = {
						is_in_army = yes
					}
					set_knight_status = forbid
				}
				set_location = global_var:andorhal_province
				custom_description = {
					text = join_draenor_expedition_tooltip
					
					object = scope:activity
					
					add_to_activity_without_travel = scope:activity
				}
				trigger_event = wc_arthas_story.10
			}
			hidden_effect = {
				scope:host.current_travel_plan = {
					add_companion = scope:uther
					add_companion = scope:jaina
				}
			}
			
			#every_knight = {
			#	limit = {
			#		is_ai = yes	#Players decide themselves
			#		
			#		can_be_invited_in_arthas_expedition_trigger = { INVITER = scope:host }
			#	}
			#	join_arthas_expedition_effect = yes
			#}
		}
	}
	
	option = {
		name = wc_arthas_story_10_OPT_arthas
	}
}
# Everything around looks dead, you find an abandoned farm, is attacked by undead inside, briefly see Kel'Thuzad
wc_arthas_story.15 = {
	type = activity_event
	title = wc_arthas_story_10_TITLE
	desc = wc_arthas_story_15_DESC
	theme = plague
	override_background = {
		reference = wc_androhal_by_dlikt
	}
	right_portrait = {
		character = scope:host
		animation = disgust
	}
	left_portrait = {
		character = scope:activity.var:kelthuzad
		animation = personality_dishonorable
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			
			find_kelthuzad_effect = yes
			
			share_event_with_group_effect = { ID = wc_arthas_story.15 }
		}
		arthas_solo_battle_roll_effect = { RISK = 2 }
	}
	
	option = {
		name = wc_arthas_story_15_OPT_A
	}

	after = {
		if = {
			limit = { root = scope:host }
			trigger_event = { id = wc_arthas_story.20 days = @travel_delay }
		}
	}
}
# You meet Kel'Thuzad in Andorhal (or another plague center)
wc_arthas_story.20 = {
	type = activity_event
	title = wc_arthas_story_10_TITLE
	desc = wc_arthas_story_20_DESC
	theme = plague
	override_background = {
		reference = wc_cauldron_by_dlikt
	}
	right_portrait = {
		character = scope:host
		animation = rage
	}
	left_portrait = {
		character = scope:activity.var:kelthuzad
		animation = personality_dishonorable
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			
			find_kelthuzad_effect = yes
			#find_stratholme_effect = yes
			find_malganis_effect = yes
			set_global_variable = { name = malganis value = scope:activity.var:malganis }
			if = { limit = { has_global_variable = malganis } } #remove error.log
			global_var:andorhal_province.county = { save_scope_as = andorhal }
			#scope:activity = { set_variable = { name = andorhal value = scope:andorhal } }
			
			share_event_with_group_effect = { ID = wc_arthas_story.20 }
		}
	}
	
	option = {
		name = wc_arthas_story_20_OPT_A
		
		stress_impact = {
			vengeful = medium_stress_impact_loss
			wrathful = minor_stress_impact_loss
		}
		
		arthas_solo_battle_roll_effect = { RISK = 3 }
		
		if = {
			limit = { root = scope:host }
			scope:activity.var:kelthuzad = { override_death_killer_effect = { death_reason = death_battle killer = root } }
		}
	}
	
}
# You chase Mal'Ganis, rest in Heartglen (or any other city), find out the Plague turns undead, instead of killing, is attacked by a huge undead army
wc_arthas_story.25 = {
	type = activity_event
	title = wc_arthas_story_10_TITLE
	desc = wc_arthas_story_25_DESC
	theme = plague
	override_background = {
		reference = farmland
	}
	right_portrait = {
		character = scope:host
		animation = shock
	}
	
	
	trigger = {
		OR = {
			can_find_hearthglen_trigger = yes
			NOT = { root = scope:host }
		}
	}
	
	on_trigger_fail = {
		if = {
			limit = { root = scope:host }
			trigger_event = { id = wc_arthas_story.30 days = @travel_delay }
		}
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			global_var:hearthglen = { save_scope_as = hearthglen }
			#find_hearthglen_effect = yes
			share_event_with_group_effect = { ID = wc_arthas_story.25 }
		}
	}
	
	option = {
		name = wc_arthas_story_25_OPT_A
		
		arthas_solo_battle_roll_effect = { RISK = 5 }
	}
	
}
# You reach Stratholme (or any other big city), find out you're too late
wc_arthas_story.30 = {
	type = activity_event
	title = wc_arthas_story_10_TITLE
	desc = {
		desc = wc_arthas_story_30_DESC_beggining
		first_valid = {
			triggered_desc = {
				trigger = {
					global_var:stratholme = title:c_stratholme
					game_start_date = 603.1.1
				}
				desc = wc_arthas_story_30_DESC_port_city
			}
			desc = wc_arthas_story_30_DESC_city
		}
		desc = wc_arthas_story_30_DESC_ending
	}
	theme = plague
	override_background = {
		reference = wc_stratholme
	}
	right_portrait = {
		character = scope:host
		animation = rage
	}
	left_portrait = {
		character = scope:activity.var:malganis
		animation = personality_dishonorable
	}
	
	trigger = {
		exists = scope:activity
		OR = {
			can_find_stratholme_trigger = yes
			NOT = { root = scope:host }
		}
	}
	on_trigger_fail = {
		# Stops the event chain
		if = {
			limit = { root = scope:host }
			complete_arthas_expedition_effect = yes
		}
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			
			find_malganis_effect = yes
			#find_stratholme_effect = yes
			global_var:andorhal_province.county = { save_scope_as = plague_center }
			scope:activity = { set_variable = { name = plague_center value = scope:plague_center } }
			
			share_event_with_group_effect = { ID = wc_arthas_story.30 }
		}
	}
	
	# Purge
	option = {
		trigger = {
			root = scope:host
			scope:activity = {
				has_activity_option = {
					category = special_type
					option = ae_destroy_your_enemies
				}
			}
		}
		name = wc_arthas_story_30_OPT_A
		
		show_as_tooltip = { purge_event_effect = yes }
		save_scope_value_as = { name = stratholme_action value = flag:purge }
		
		custom_tooltip = some_characters_may_abandom_you
		
		ai_chance = {
			base = 5
			
			#purge_event_modifier = yes
		}
	}
	# Quarantine
	option = {
		trigger = {
			root = scope:host
			scope:activity = {
				has_activity_option = {
					category = special_type
					option = ae_save_your_country
				}
			}
		}
		name = wc_arthas_story_30_OPT_C
		
		show_as_tooltip = { quarantine_event_effect = yes }
		save_scope_value_as = { name = stratholme_action value = flag:quarantine }
		
		ai_chance = {
			base = 5
			
			#quarantine_event_modifier = yes
		}
	}
	# Evacuate
	option = {
		trigger = {
			root = scope:host
			scope:activity = {
				has_activity_option = {
					category = special_type
					option = ae_save_your_people
				}
			}
		}
		name = wc_arthas_story_30_OPT_B
		
		show_as_tooltip = { evacuate_event_effect = yes }
		save_scope_value_as = { name = stratholme_action value = flag:evacuate }
		set_global_variable = theramore_started
		
		ai_chance = {
			base = 5
			
			#evacuate_event_modifier = yes
		}
	}
	
	option = {
		trigger = { NOT = { root = scope:host } }
		name = wc_arthas_story_30_OPT_A_reaction
	}
	
	after = {
		if = {
			limit = { root = scope:host }
			share_event_with_group_delay_effect = { ID = wc_arthas_story.35 DAYS = 1 }
			trigger_event = { id = wc_arthas_story.40 days = @stratholme_delay }
		}
	}
}
# Arthas tells you about his decision (it depends on Arthas' decision above)
wc_arthas_story.35 = {
	type = activity_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:purge }
				desc = wc_arthas_story_35_TITLE_purge
			}
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:evacuate }
				desc = wc_arthas_story_35_TITLE_evacuate
			}
			desc = wc_arthas_story_35_TITLE_quarantine
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:purge }
				desc = {
					desc = wc_arthas_story_35_DESC_purge_beggining
					first_valid = {
						triggered_desc = {
							trigger = { game_start_date = 603.1.1 }
							desc = wc_arthas_story_35_DESC_purge_silver_hand
						}
						desc = wc_arthas_story_35_DESC_purge_no_silver_hand
					}
					desc = wc_arthas_story_35_DESC_purge_ending
				}
			}
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:evacuate }
				desc = wc_arthas_story_35_DESC_evacuate
			}
			desc = wc_arthas_story_35_DESC_quarantine
		}
	}
	theme = plague
	override_background = {
		reference = wc_stratholme
	}
	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:host
		animation = personality_bold
	}

	immediate = {
		if = {
			limit = {
				scope:activity = { has_variable = jaina }
				scope:activity.var:jaina = { is_alive = yes }
			}
			# Then nothing
		}
		else = {
			# If jaina rip we find the most skillful lordaeronian/dalaranian/tirassian to sail and found Theramore
			find_nonhistorical_theramore_ruler = yes
		}
	}

	# Stay (purge)
	option = {
		trigger = { scope:stratholme_action = flag:purge }
		name = wc_arthas_story_35_OPT_A_purge
		
		show_as_tooltip = { purge_event_effect = yes }
		
		ai_chance = {
			base = 100
			
			purge_event_modifier = yes
		}
	}
	# Stay (evacuate)
	option = {
		trigger = { scope:stratholme_action = flag:evacuate }
		name = wc_arthas_story_35_OPT_A_evacuate
		
		show_as_tooltip = { evacuate_event_effect = yes }
		
		ai_chance = {
			base = 50
			
			evacuate_event_modifier = yes
		}
	}
	# Stay (quarantine)
	option = {
		trigger = { scope:stratholme_action = flag:quarantine }
		name = wc_arthas_story_35_OPT_A_evacuate
		
		show_as_tooltip = { quarantine_event_effect = yes }
		
		ai_chance = {
			base = 25
			
			quarantine_event_modifier = yes
		}
	}
	# Leave
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { scope:stratholme_action = flag:purge }
						desc = wc_arthas_story_35_OPT_B_purge
					}
					desc = wc_arthas_story_35_OPT_B_evacuate
				}
			}
		}
		trigger = {
			NAND = {
				scope:activity = { has_variable = jaina }
				scope:activity.var:jaina = { is_alive = yes }
				root = scope:activity.var:jaina
			}
		}

		leave_arthas_expedition_event_effect = yes
		
		ai_chance = {
			base = 15
			
			leave_event_modifier = yes
			modifier = {
				scope:activity.var:jaina ?= root
				add = 5
			}
		}
	}
	# Leave - Jaina
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { scope:stratholme_action = flag:purge }
						desc = wc_arthas_story_35_OPT_B_purge
					}
					desc = wc_arthas_story_35_OPT_B_evacuate
				}
			}
		}
		trigger = {
			scope:activity = { has_variable = jaina }
			scope:activity.var:jaina = { is_alive = yes }
			root = scope:activity.var:jaina
		}

		leave_arthas_expedition_event_effect = yes
		
		if = {
			limit = {
				NOT = { has_global_variable = theramore_started }
			}
			trigger_event = { id = theramore_events.001 days = 10 }
			set_global_variable = theramore_started
		}
		
		
		ai_chance = {
			base = 15
			
			leave_event_modifier = yes
			modifier = {
				scope:activity.var:jaina ?= root
				add = 5
			}
		}
	}
}
# Arthas does what he wanted with the city (it depends on Arthas' decision above)
wc_arthas_story.40 = {
	type = activity_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:purge }
				desc = wc_arthas_story_35_TITLE_purge
			}
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:evacuate }
				desc = wc_arthas_story_35_TITLE_evacuate
			}
			desc = wc_arthas_story_35_TITLE_quarantine
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:purge }
				desc = {
					first_valid = {
						triggered_desc = {
							trigger = { is_in_arthas_expedition_trigger = yes }
							desc = wc_arthas_story_40_DESC_purge_group
						}
						desc = wc_arthas_story_40_DESC_purge_world
					}
				}
			}
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:evacuate }
				desc = {
					first_valid = {
						triggered_desc = {
							trigger = { is_in_arthas_expedition_trigger = yes }
							desc = wc_arthas_story_40_DESC_evacuate_group
						}
						desc = wc_arthas_story_40_DESC_evacuate_world
					}
				}
			}
			triggered_desc = {
				trigger = { is_in_arthas_expedition_trigger = yes }
				desc = wc_arthas_story_40_DESC_quarantine_group
			}
			desc = wc_arthas_story_40_DESC_quarantine_world
		}
	}
	theme = plague
	override_background = {
		reference = wc_stratholme
	}
	right_portrait = {
		character = scope:host
		animation = worry
	}
	
	trigger = {
		exists = scope:activity
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			
			arthas_find_terenas_effect = yes
			
			scope:activity = {
				every_attending_character = {
					limit = {
						NOT = { this = scope:host }
						is_in_arthas_expedition_trigger = yes
					}
					add_to_temporary_list = stratholme_notified
				}
			}
			every_player = {
				limit = {
					NOT = { this = scope:host }
					get_news_from_region_trigger = { REGION = world_eastern_kingdoms }
				}
				add_to_temporary_list = stratholme_notified
			}
			every_in_list = {
				list = stratholme_notified
				trigger_event = wc_arthas_story.40
			}
			if = {
				limit = { NOT = { scope:stratholme_action = flag:evacuate } }
				hidden_effect = {
					remove_trait = cannot_mary_historical
				}
			}
		}
		
		if = {
			limit = { scope:stratholme_action = flag:purge }
			purge_event_effect = yes
		}
		else_if = {
			limit = { scope:stratholme_action = flag:evacuate }
			evacuate_event_effect = yes
		}
		else = {
			quarantine_event_effect = yes
		}
	}
	
	# Sail Northrend
	option = {
		trigger = {
			root = scope:host
			scope:stratholme_action = flag:purge
		}
		name = wc_arthas_story_40_OPT_D
		
		sail_northrend_event_effect = yes

		share_event_with_group_delay_effect = { ID = wc_arthas_story.45 DAYS = 1 }
		arthas_find_terenas_effect = yes
		global_var:terenas_character = {
			trigger_event = { id = wc_arthas_story.50 days = 1 }
		}
		
		ai_chance = {
			base = 100
			sail_northrend_event_modifier = yes
		}
	}
	# Not sail
	option = {
		trigger = {
			root = scope:host
			OR = {
				scope:stratholme_action = flag:quarantine
				scope:stratholme_action = flag:evacuate
			}
		}
		name = wc_arthas_story_40_OPT_A_evacuate
		
		if = {
			limit = { scope:stratholme_action = flag:quarantine }
			# Kalimdor event chain without arthas
			if = {
				limit = {
					scope:activity.var:jaina ?= { is_alive = yes }
					# if she didnt leave yet, to not have double theramore event
					scope:activity.var:jaina = { is_participant_in_activity = scope:activity }
					NOT = { has_global_variable = theramore_started }
				}
				scope:activity.var:jaina = { trigger_event = { id = theramore_events.001 days = 14 } }
				set_global_variable = theramore_started
			}
		}
		else_if = {
			limit = { scope:stratholme_action = flag:evacuate }
			# Kalimdor event chain with arthas
			set_variable = { name = my_second_half value = scope:activity.var:jaina }
			trigger_event = { id = theramore_events.101 days = 14 }
		}
		#leave_arthas_expedition_event_effect = yes
		
		ai_chance = {
			base = 50
			not_sail_northrend_event_modifier = yes
		}
	}
	
	# Reaction for group
	option = {
		trigger = {
			NOT = {
				root = scope:host
			}
			is_in_arthas_expedition_trigger = yes
		}
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { scope:stratholme_action = flag:purge }
						desc = wc_arthas_story_40_OPT_A_purge
					}
					desc = wc_arthas_story_40_OPT_A_evacuate
				}
			}
		}
	}
	
	# Reaction for world
	option = {
		trigger = { is_in_arthas_expedition_trigger = no }
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							OR = {
								has_trait_or_trait_is_virtue_trigger = { TRAIT = compassionate }
								AND = {
									root.culture = { has_same_culture_heritage = global_var:stratholme.culture }
									root.religion = global_var:stratholme.religion
								}
							}
						}
						desc = wc_arthas_story_40_OPT_B_negative
					}
					triggered_desc = {
						trigger = {
							OR = {
								has_trait_or_trait_is_virtue_trigger = { TRAIT = sadistic }
								has_trait_or_trait_is_virtue_trigger = { TRAIT = callous }
							}
						}
						desc = wc_arthas_story_40_OPT_B_positive
					}
					desc = wc_arthas_story_40_OPT_B_neutral
				}
			}
		}
	}
}
# Arthas tells you about his plan to sail Northrend to chase Mal'ganis
wc_arthas_story.45 = {
	type = activity_event
	title = wc_arthas_story_45_TITLE
	desc = wc_arthas_story_45_DESC
	theme = plague
	override_background = {
		reference = docks
	}
	left_portrait = {
		character = scope:activity.var:malganis
		animation = personality_bold
	}
	right_portrait = {
		character = scope:host
		animation = rage
	}

	# Sail with Arthas
	option = {
		name = wc_arthas_story_45_OPT_A

		sail_northrend_event_effect = yes
		
		if = {
			limit = {
				scope:activity.var:jaina ?= root
			}
			find_nonhistorical_theramore_ruler = yes
			hidden_effect = {
				remove_trait = cannot_mary_historical
			}
		}
		ai_chance = {
			base = 100
			
			sail_northrend_event_modifier = yes
			
			modifier = { #So she will certainly be historical, other possible jainas will act on their personality
				exists = character:48081
				this = character:48081
				factor = 0
			}
		}
	}
	# Leave
	option = {
		name = wc_arthas_story_45_OPT_B
		trigger = {
			NAND = {
				scope:activity = { has_variable = jaina }
				scope:activity.var:jaina = { is_alive = yes }
				root = scope:activity.var:jaina
			}
		}

		not_sail_northrend_event_effect = yes
		
		ai_chance = {
			base = 50
			
			not_sail_northrend_event_modifier = yes
		}
	}
	# Leave - Jaina
	option = {
		name = wc_arthas_story_45_OPT_B
		trigger = {
			scope:activity = { has_variable = jaina }
			scope:activity.var:jaina = { is_alive = yes }
			root = scope:activity.var:jaina
		}

		not_sail_northrend_event_effect = yes
		
		if = {
			limit = { NOT = { has_global_variable = theramore_started } }
			trigger_event = { id = theramore_events.001 days = 7 }
			set_global_variable = theramore_started
		}
		
		ai_chance = {
			base = 50
			
			not_sail_northrend_event_modifier = yes
			modifier = {
				scope:activity.var:jaina ?= root
				add = 5
			}
		}
	}
}
# Terenas finds out Arthas sailed Northrend with an army
wc_arthas_story.50 = {
	type = character_event
	title = wc_arthas_story_45_TITLE
	desc = {
		desc = wc_arthas_story_50_DESC_beggining
		first_valid = {
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:purge }
				desc = wc_arthas_story_50_DESC_purge
			}
			desc = wc_arthas_story_50_DESC_evacuation
		}
		desc = wc_arthas_story_50_DESC_ending
	}
	theme = plague
	override_background = {
		reference = docks
	}
	right_portrait = {
		character = scope:host
		animation = rage
	}
	
	trigger = {
		exists = scope:activity
		is_valid_terenas_to_kill_trigger = yes
	}
	
	# Bring him back
	option = {
		name = wc_arthas_story_50_OPT_A
		
		custom_tooltip = wc_arthas_story_50_OPT_A_tooltip
		scope:activity = {
			set_variable = { name = terenas_action value = flag:bring_back }
		}

		stress_impact = {
			base = minor_stress_impact_gain
			trusting = medium_stress_impact_gain
			arbitrary = minor_stress_impact_gain
			impatient = minor_stress_impact_gain
		}
		
		ai_chance = {
			base = 100
			stress_impact_ai_chance_modifier = { TRAIT = trusting STRESS = medium_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = arbitrary STRESS = minor_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = impatient STRESS = minor_stress_impact_gain }
		}
	}
	# THAT'S MY BOI
	option = {
		name = wc_arthas_story_50_OPT_B
		
		stress_impact = {
			base = medium_stress_impact_gain
			paranoid = major_stress_impact_gain
			just = minor_stress_impact_gain
			patient = minor_stress_impact_gain
		}
		
		ai_chance = {
			base = 50
			stress_impact_ai_chance_modifier = { TRAIT = paranoid STRESS = major_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = just STRESS = minor_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = patient STRESS = minor_stress_impact_gain }
		}
	}
}
# You arrive in Northrend, Muradin joins, telling about the Frostmourne
wc_arthas_story.55 = {
	type = activity_event
	title = wc_arthas_story_45_TITLE
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { root = scope:host }
				desc = {
					desc = wc_arthas_story_55_DESC_arthas_beggining
					first_valid = {
						triggered_desc = {
							trigger = { has_opinion_modifier = { target = scope:muradin modifier = mentored_me_opinion } }
							desc = wc_arthas_story_55_DESC_arthas_muradin
						}
						desc = wc_arthas_story_55_DESC_arthas_not_muradin
					}
					desc = wc_arthas_story_55_DESC_arthas_ending
				}
			}
			desc = {
				desc = wc_arthas_story_55_DESC_group_beggining
				first_valid = {
					triggered_desc = {
						trigger = { scope:host = { has_opinion_modifier = { target = scope:muradin modifier = mentored_me_opinion } } }
						desc = wc_arthas_story_55_DESC_group_muradin
					}
					desc = wc_arthas_story_55_DESC_group_not_muradin
				}
				desc = wc_arthas_story_55_DESC_group_ending
			}
		}
	}
	theme = plague
	override_background = {
		reference = wc_background_northrend
	}
	right_portrait = {
		character = scope:host
		animation = personality_bold
	}
	left_portrait = {
		character = scope:muradin
		animation = happiness
	}
	
	trigger = {
		exists = scope:activity
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			find_muradin_effect = yes
			scope:muradin = {
				if = {
					limit = { is_commanding_army = yes }
					commanding_army ?= { remove_commander = yes }
				}
				else_if = {
					limit = {
						is_in_army = yes
					}
					hidden_effect = { set_knight_status = forbid }
				}
				set_location = scope:host.location
				custom_description = {
					text = join_draenor_expedition_tooltip
					
					object = scope:activity
					
					add_to_activity_without_travel = scope:activity
				}
			}

			hidden_effect = {
				if = {
					limit = {
						scope:activity = {
							any_attending_character = {
								NOT = { this = scope:host }
								is_alive = yes
								is_courtier_of = scope:host
								is_knight_of = scope:host
							}
						}
					}
					scope:activity = {
						random_attending_character = {
							limit = {
								NOT = { this = scope:host }
								is_alive = yes
								is_courtier_of = scope:host
								is_knight_of = scope:host
							}
							weight = {
								base = 1
								modifier = {
									add = 10
									prowess > 12
								}
								modifier = {
									add = 10
									has_trait = brave
								}
								modifier = {
									add = 10
									has_trait = just
								}
								modifier = {
									add = 100
									exists = character:60693
									this = character:60693
								}
							}
							save_scope_as = leader_of_alliance_camp
							scope:host.current_travel_plan = {
								remove_character = prev
							}
							scope:activity = {
								add_to_variable_list = { name = characters_left target = prev }
							}
							remove_from_activity = scope:activity
							set_location_to_default = yes
						}
					}
				}
				else = {
					create_character = {
						template = frontier_hero_template
						dynasty = generate
						gender_female_chance = root_soldier_female_chance
						employer = scope:host
						save_scope_as = leader_of_alliance_camp
					}
				}
				scope:leader_of_alliance_camp = {
					create_title_and_vassal_change = {
						type = created
						save_scope_as = title_change
						add_claim_on_loss = yes
					}
					title:c_nokeroa = {
						change_title_holder_include_vassals = {
							holder = prev
							change = scope:title_change
						}
						set_county_culture = root.culture
						set_county_faith = root.faith
					}
					title:c_wintergarde = {
						change_title_holder_include_vassals = {
							holder = prev
							change = scope:title_change
						}
						set_county_culture = root.culture
						set_county_faith = root.faith
					}
					title:c_volgovaya = {
						change_title_holder_include_vassals = {
							holder = prev
							change = scope:title_change
						}
						set_county_culture = root.culture
						set_county_faith = root.faith
					}
					title:c_carrion = {
						change_title_holder_include_vassals = {
							holder = prev
							change = scope:title_change
						}
						set_county_culture = root.culture
						set_county_faith = root.faith
					}
					title:d_wintergarde = {
						change_title_holder_include_vassals = {
							holder = prev
							change = scope:title_change
						}
					}
					resolve_title_and_vassal_change = scope:title_change
					if = {
						limit = {
							is_independent_ruler = no
						}
						create_title_and_vassal_change = {
							type = independency
							save_scope_as = change
							add_claim_on_loss = no
						}
						becomes_independent = { change = scope:change }
						resolve_title_and_vassal_change = scope:change
					}
				}
			}

			share_event_with_group_effect = { ID = wc_arthas_story.55 }
		}
	}
	
	# Just a reaction
	option = {
		name = wc_arthas_story_55_OPT_A
	}
	
	after = {
		if = {
			limit = { root = scope:host }
			trigger_event = { id = wc_arthas_story.60 days = @travel_delay }
		}
	}
}
# Terenas calls you back home
wc_arthas_story.60 = {
	type = activity_event
	title = wc_arthas_story_45_TITLE
	desc = wc_arthas_story_60_DESC
	theme = plague
	override_background = {
		reference = wc_background_northrend
	}
	right_portrait = {
		character = scope:host
		animation = rage
	}
	left_portrait = {
		character = scope:emissary
		animation = personality_callous
	}
	
	trigger = {
		exists = scope:activity
		has_global_variable = terenas_character
		global_var:terenas_character = {
			is_valid_terenas_to_kill_trigger = yes
		}
		scope:activity = {
			exists = var:terenas_action
			var:terenas_action = flag:bring_back
		}
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			
			create_character = {
				template = emissary_character
				
				gender_female_chance = this_faith_dominant_gender_female_chance
				faith = scope:host.top_liege.faith
				culture = scope:host.top_liege.culture
				employer = scope:host.top_liege
				
				after_creation = {
					save_scope_as = emissary
					add_character_flag = forced_knight_armor
				}
			}
			# So if Luc Valonforth dies, titles wont go to undeads
			hidden_effect = {
				title:c_volgovaya.holder = {
					every_vassal_or_below = {
						limit = {
							NOT ={ has_faith = prev.faith }
						}
						set_character_faith = prev.faith
						set_culture = prev.culture
						if = {
							limit = {
								has_trait = being_undead
							}
							remove_trait = being_undead
						}
					}
				}
			}
			share_event_with_group_delay_effect = { ID = wc_arthas_story.60 DAYS = 1 }
		}
	}
	
	# Burn the ships so they can't run
	option = {
		trigger = { root = scope:host }
		name = wc_arthas_story_60_OPT_burn
		
		trigger_event = { id = wc_arthas_story.65 days = 2 }
		scope:activity = { set_variable = { name = arthas_action value = yes } } #flag:burn_ships
		
		stress_impact = {
			compassionate = massive_stress_impact_gain
			sadistic = medium_stress_impact_loss
			deceitful = medium_stress_impact_loss
			arbitrary = minor_stress_impact_loss
			honest = major_stress_impact_gain
			just = medium_stress_impact_gain
		}
		
		ai_chance = {
			base = 100
			stress_impact_ai_chance_modifier = { TRAIT = compassionate STRESS = massive_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = sadistic STRESS = medium_stress_impact_loss }
			stress_impact_ai_chance_modifier = { TRAIT = deceitful STRESS = medium_stress_impact_loss }
			stress_impact_ai_chance_modifier = { TRAIT = arbitrary STRESS = minor_stress_impact_loss }
			stress_impact_ai_chance_modifier = { TRAIT = honest STRESS = major_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = just STRESS = medium_stress_impact_gain }
		}
	}
	# Let them run but you stay
	option = {
		trigger = { root = scope:host }
		name = wc_arthas_story_60_OPT_let_run
		
		custom_tooltip = some_characters_may_abandom_you
		
		stress_impact = {
			vengeful = medium_stress_impact_gain
			impatient = medium_stress_impact_gain
			wrathful = medium_stress_impact_gain
		}
		give_land_to_settler = { TO_WHO = title:e_scourge.holder COUNTY_NAME = title:c_volgovaya GIVE_INDEPENDENCY = no ADD_CLAIM_ON_LOSS = no }
		give_land_to_settler = { TO_WHO = title:e_scourge.holder COUNTY_NAME = title:c_nokeroa GIVE_INDEPENDENCY = no ADD_CLAIM_ON_LOSS = no }
		hidden_effect = {
			title:c_volgovaya = {
				set_county_culture = title:e_scourge.holder.culture
				set_county_faith = title:e_scourge.holder.faith
			}
			title:c_nokeroa = {
				set_county_culture = title:e_scourge.holder.culture
				set_county_faith = title:e_scourge.holder.faith
			}
		}
		
		ai_chance = {
			base = 50
			stress_impact_ai_chance_modifier = { TRAIT = vengeful STRESS = medium_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = impatient STRESS = medium_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = wrathful STRESS = medium_stress_impact_gain }
		}
	}
	# You stay
	option = {
		trigger = {
			NOT = {
				root = scope:host
			}
		}
		name = wc_arthas_story_60_OPT_stay
		
		ai_chance = {
			base = 100
		}
	}
	# You leave with the ships
	option = {
		trigger = {
			NOT = {
				root = scope:host
			}
		}
		name = wc_arthas_story_60_OPT_run
		
		show_as_tooltip = {
			leave_arthas_expedition_event_effect = yes
		}
		scope:activity = {
			add_to_variable_list = { name = northrend_cowards target = root }
		}
		
		ai_chance = {
			base = 50
			leave_event_modifier = yes
		}
	}
}
# Arthas burns the ships with help of mercenaries
wc_arthas_story.65 = {
	type = activity_event
	title = wc_arthas_story_45_TITLE
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { root = scope:host }
				desc = wc_arthas_story_65_DESC_arthas
			}
			desc = wc_arthas_story_65_DESC_group
		}
	}
	theme = plague
	override_background = {
		reference = wc_background_northrend
	}
	right_portrait = {
		character = scope:host
		animation = rage
	}
	left_portrait = {
		character = scope:mercenary
		animation = fear
	}
	
	trigger = {
		exists = scope:activity
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			
			create_character = {
				template = new_commander_character
				
				gender_female_chance = this_faith_dominant_gender_female_chance
				faith = faith:drakkism
				culture = culture:drakkari
				location = title:c_nokeroa.title_province
				
				save_scope_as = mercenary
			}
			scope:mercenary = { override_death_killer_effect = { death_reason = death_battle killer = root } }
			
			share_event_with_group_effect = { ID = wc_arthas_story.65 }
		}
	}
	
	# These mercenaries burnt our ships!
	option = {
		name = wc_arthas_story_65_OPT_mercenaries
		
		if = {
			limit = { root = scope:host }
			stress_impact = {
				deceitful = medium_stress_impact_loss
				honest = massive_stress_impact_gain
				compassionate = major_stress_impact_gain
				sadistic = medium_stress_impact_loss
			}
		}
	}
}
# We find Frostmourne, Muradin reads the warning, Arthas takes the sword, Muradin is wounded
wc_arthas_story.70 = {
	type = activity_event
	title = wc_arthas_story_70_TITLE
	desc = wc_arthas_story_70_DESC
	theme = plague
	override_background = {
		reference = wc_frostmourne_cave
	}
	left_portrait = {
		character = scope:host
		scripted_animation = duel_wield_weapon
	}
	right_portrait = {
		character = scope:muradin
		animation = pain
	}
	artifact = {
		target = scope:newly_created_artifact
		position = lower_left_portrait
		trigger = { exists = scope:newly_created_artifact }
	}
	
	trigger = {
		exists = scope:activity
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			
			find_muradin_effect = yes
			find_nerzhul_effect = yes
			
			scope:muradin = { trigger_event = { id = wc_arthas_story.70 days = 1 } }
			
			if = {
				limit = { NOT = { scope:activity = { exists = var:arthas_action } } }
				scope:activity = {
					every_in_list = {
						variable = northrend_cowards
						leave_arthas_expedition_event_effect = yes
					}
				}
			}
			
			create_artifact_frostmourne_effect = { OWNER = root }
			add_character_flag = wear_frostmourne_flag
			remove_list_global_variable = { name = unavailable_unique_events target = flag:frostmourne_ongoing }
		}
	}
	
	# I will give anything or pay any price, if only you will help me save my people
	option = {
		trigger = { root = scope:host }
		name = wc_arthas_story_70_OPT_pay_any_price
		
		scope:activity = { set_variable = { name = fallen_expedition value = flag:yes } } #Before raise_undead_no_notification_no_depose_effect
		set_character_faith = scope:nerzhul.faith

		scope:newly_created_artifact = {
			equip_artifact_to_owner_replace = yes
		}
		
		trigger_event = { id = wc_arthas_story.75 days = 5 }

		##nerzhul notification
		scope:nerzhul = { trigger_event = { id = wc_arthas_story.170 days = 1 } }
	}
	# Argh!
	option = {
		trigger = { NOT = { root = scope:host } }
		name = ARGH
		
		increase_wounds_no_death_effect = { REASON = scarified }
		leave_arthas_expedition_effect = yes
	}

}
# Arthas cuts undead hordes, kills Mal'Ganis, disappears in snowfall
wc_arthas_story.75 = {
	type = activity_event
	title = wc_arthas_story_70_TITLE
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { root = scope:host }
				desc = wc_arthas_story_75_DESC_arthas
			}
			desc = wc_arthas_story_75_DESC_group
		}
	}
	theme = plague
	override_background = {
		reference = wc_background_northrend
	}
	left_portrait = {
		character = scope:host
		scripted_animation = duel_wield_weapon
	}
	right_portrait = {
		character = scope:activity.var:malganis
		animation = fear
	}
	artifact = {
		target = scope:newly_created_artifact
		position = lower_left_portrait
		trigger = { exists = scope:newly_created_artifact }
	}
	
	trigger = {
		exists = scope:activity
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			
			find_malganis_effect = yes
			arthas_find_terenas_effect = yes
			
			share_event_with_group_effect = { ID = wc_arthas_story.75 }
		}
		arthas_solo_battle_roll_effect = { RISK = 5 }
	}
	
	option = {
		trigger = { root = scope:host }
		name = wc_arthas_story_75_OPT_arthas
		
		scope:activity.var:malganis = { override_death_killer_effect = { death_reason = death_battle killer = root } }
		
		share_event_with_group_delay_effect = { ID = wc_arthas_story.80 DAYS = 4 }
		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = swear_fealty
			add_claim_on_loss = yes
		}
		raise_undead_by_vassal_no_notification_effect = { MASTER = title:e_scourge.holder CHANGE = scope:swear_fealty }
		resolve_title_and_vassal_change = scope:swear_fealty
		
	}
	option = {
		trigger = { NOT = { root = scope:host } }
		name = wc_arthas_story_75_OPT_not_arthas
	}
}
# Arthas comes for you and resurrects as undead
wc_arthas_story.80 = {
	type = activity_event
	title = wc_arthas_story_80_TITLE
	desc = wc_arthas_story_80_DESC
	theme = plague
	override_background = {
		reference = wc_background_northrend
	}
	left_portrait = {
		character = scope:host
		scripted_animation = duel_wield_weapon
	}
	right_portrait = {
		character = root
		animation = fear
	}
	artifact = {
		target = scope:newly_created_artifact
		position = lower_left_portrait
		trigger = { exists = scope:newly_created_artifact }
	}
	
	trigger = {
		exists = scope:activity
	}
	
	immediate = {
		scope:host = {
			add_character_flag = wear_hood_flag
		}
	}
	
	option = {
		name = ARGH

		if = {
			limit = { any_held_title = { is_holy_order = yes } }
			override_death_killer_effect = { death_reason = death_battle killer = scope:host }
		}
		else = {
			if = {
				limit = { is_ruler = yes is_landed = yes tier_difference = { target = title:e_scourge.holder value < 0 } }
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = swear_fealty
					add_claim_on_loss = yes
				}
				change_liege = {
					liege = title:e_scourge.holder
					change = scope:swear_fealty
				}
				resolve_title_and_vassal_change = scope:swear_fealty
			}
			raise_undead_by_basic_effect = { MASTER = scope:host FROSTMOURNE = no }
		}
	}
}
# You return home, they welcome you like heroes, you enter the throne room
wc_arthas_story.85 = {
	type = activity_event
	title = wc_arthas_story_80_TITLE
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { root = scope:host }
				desc = wc_arthas_story_85_DESC_arthas
			}
			triggered_desc = {
				trigger = { root = global_var:terenas_character }
				desc = wc_arthas_story_85_DESC_terenas
			}
			desc = wc_arthas_story_85_DESC_group
		}
		triggered_desc = {
			trigger = { root = global_var:terenas_character }
			desc = wc_arthas_story_85_DESC_terenas
		}
	}
	theme = plague
	override_background = {
		reference = wc_lordaeron_throne_room
	}
	left_portrait = {
		character = scope:host
		scripted_animation = duel_wield_weapon
	}
	right_portrait = {
		character = global_var:terenas_character
		animation = fear
	}
	artifact = {
		target = scope:newly_created_artifact
		position = lower_left_portrait
		trigger = { exists = scope:newly_created_artifact }
	}
	
	trigger = {
		has_global_variable = terenas_character
		global_var:terenas_character = {
			is_valid_terenas_to_kill_trigger = yes
		}
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			global_var:terenas_character = {
				save_scope_as = background_throne_room_scope
			}
			share_event_with_group_effect = { ID = wc_arthas_story.85 }
			global_var:terenas_character = {
				if = {
					limit = { exists = court_position:bodyguard_court_position }
					court_position:bodyguard_court_position = { save_scope_as = bodyguard }
				}
			}
		}
	}
	
	on_trigger_fail = {
		if = {
			limit = { root = scope:host }
			trigger_event = wc_arthas_story.90
		}
	}
	
	option = {
		trigger = {
			root = scope:host
		}
		name = wc_arthas_story_85_OPT_arthas
		
		stress_impact = {
			ambitious = massive_stress_impact_loss
			content = minor_stress_impact_gain
			
			sadistic = medium_stress_impact_loss
			compassionate = massive_stress_impact_gain
			
			impatient = minor_stress_impact_loss
			
			deceitful = medium_stress_impact_loss
			honest = major_stress_impact_gain
			
			cynical = minor_stress_impact_loss
		}

		random_list = {
			83 = {
				modifier = { add = prowess }
				desc = wc_arthas_story.85.terenas
				save_scope_value_as = {
					name = killed_terenas
					value = flag:yes
				}
				show_as_tooltip = { murder_terenas_effect = { TERENAS = global_var:terenas_character } }

				if = {
					limit = {
						is_independent_ruler = no
						top_liege.primary_title = title:e_scourge
					}
					liege = {
						save_scope_as = scourge_liege
					}
				}

				global_var:terenas_character = { trigger_event = wc_arthas_story.86 }
				if = {
					limit = {
						is_independent_ruler = yes
						exists = scope:scourge_liege
					}

					create_title_and_vassal_change = {
						type = swear_fealty
						save_scope_as = change
						add_claim_on_loss = no
					}
					change_liege = {
						liege = scope:scourge_liege
						change = scope:change
					}
					resolve_title_and_vassal_change = scope:change
				}
				trigger_event = { id = wc_arthas_story.90 days = 1 }
				min = 3
				max = 97
			}
			17 = {
				modifier = { add = global_var:terenas_character.prowess }
				modifier = { add = { value = 0 subtract = prowess divide = 3 } }
				modifier = {
					trigger = { exists = court_position:bodyguard_court_position }
					add = {
						value = court_position:bodyguard_court_position.prowess
						divide = 2
					}
				}
				desc = wc_arthas_story.85.paladins
				if = { limit = { exists = scope:bodyguard } custom_tooltip = wc_arthas_story.85.bodyguard }
				save_scope_value_as = {
					name = killed_terenas
					value = flag:no
				}
				global_var:terenas_character = { trigger_event = wc_arthas_story.87 }
				min = 3
				max = 97
			}
		}
	}
	option = {
		trigger = {
			NOT = {
				root = scope:host
				root = global_var:terenas_character
			}
		}
		name = wc_arthas_story_85_OPT_group
		
		show_as_tooltip = {
			random_list = {
				90 = {
					scope:host = {
						murder_terenas_effect = { TERENAS = global_var:terenas_character }
					}
				}
				10 = {
					custom_tooltip = wc_arthas_story.85.paladins
				}
			}
		}
	}
}
wc_arthas_story.86 = {
	type = character_event
	title = wc_arthas_story_80_TITLE
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { root = global_var:terenas_character }
				desc = wc_arthas_story_85_DESC_terenas
			}
			desc = wc_arthas_story_85_DESC_group
		}
		triggered_desc = {
			trigger = { exists = scope:bodyguard }
			desc = wc_arthas_story.85.bodyguard_terenas
		}
	}
	theme = plague
	override_background = {
		reference = wc_lordaeron_throne_room
	}
	left_portrait = {
		character = scope:host
		scripted_animation = duel_wield_weapon
	}
	right_portrait = {
		character = global_var:terenas_character
		animation = fear
	}
	artifact = {
		target = scope:newly_created_artifact
		position = lower_left_portrait
		trigger = { exists = scope:newly_created_artifact }
	}
	
	trigger = {
		has_global_variable = terenas_character
		global_var:terenas_character = {
			is_valid_terenas_to_kill_trigger = yes
		}
		global_var:terenas_character = root
	}
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { scope:host = { is_close_family_of = global_var:terenas_character } }
						desc = wc_arthas_story_85_OPT_terenas_relative
					}
					desc = wc_arthas_story_85_OPT_terenas_stranger
				}
			}
		}
		
		capital_county = { change_development_level = -2 }

		global_var:arthas_character.liege = {
			random_character_war = {
				limit = {
					using_cb = plague_war
					casus_belli = {
						primary_defender = global_var:terenas_character
					}
				}
				save_temporary_scope_as = lordaeron_plague_war
				global_var:arthas_character.liege = { # Saving as scope doesn't work
					set_variable = {
						name = lordaeron_plague_war
						value = scope:lordaeron_plague_war
					}
				}
			}
		}

		scope:host = {
			murder_terenas_effect = { TERENAS = global_var:terenas_character }
		}
	}
}

wc_arthas_story.87 = {
	type = character_event
	title = wc_arthas_story_80_TITLE
	desc = {
		desc = wc_arthas_story_85_DESC_terenas
		desc = wc_arthas_story_85_DESC_terenas_win
		triggered_desc = {
			trigger = { exists = scope:bodyguard }
			desc = wc_arthas_story.85.bodyguard_terenas.win
		}
	}
	theme = plague
	override_background = {
		reference = wc_lordaeron_throne_room
	}
	left_portrait = {
		character = scope:host
		scripted_animation = duel_wield_weapon
	}
	right_portrait = {
		character = global_var:terenas_character
		animation = fear
	}
	artifact = {
		target = scope:newly_created_artifact
		position = lower_left_portrait
		trigger = { exists = scope:newly_created_artifact }
	}
	
	trigger = {
		has_global_variable = terenas_character
		global_var:terenas_character = {
			is_valid_terenas_to_kill_trigger = yes
		}
		global_var:terenas_character = root
	}
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { is_close_family_of = global_var:terenas_character }
						desc = wc_arthas_story_85_win_terenas_relative
					}
					desc = wc_arthas_story_85_win_terenas_stranger
				}
			}
		}
		if = {
			limit = { scope:host = { is_child_of = root } }
			custom_tooltip = wc_arthas_story.87.arthas_dying
		}
		capital_county = { change_development_level = -2 }
		# Some janky manipulations so player can keep playing as his heir -mayonez
		hidden_effect = {
			scope:host = {
				save_scope_as = thisisarthas
				set_character_faith = root.faith
				capital_county = { save_scope_as = arthas_holding }
			}
		}
		scope:activity = {
			every_attending_character = {
				limit = { NOT = { this = scope:host } } override_death_killer_effect = { death_reason = death_execution killer = root }
			}
		}
		scope:host = { override_death_killer_effect = { death_reason = death_execution killer = root } }
		hidden_effect = {
			scope:arthas_holding.holder = {
				create_title_and_vassal_change = {
					type = swear_fealty
					save_scope_as = changing_liege
				}
				change_liege = {
					liege = root
					change = scope:changing_liege
				}
				resolve_title_and_vassal_change = scope:changing_liege
			}
		}
		
	}
}

# Massacre in Lordaeron, body piles with nobles, commoners lay on streets, everyone is equal before Death
# Works as send_being_notifications_effect for Arthas
wc_arthas_story.90 = {
	type = activity_event
	title = wc_arthas_story_90_TITLE
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { root = scope:host }
				desc = wc_arthas_story_90_DESC_arthas
			}
			triggered_desc = {
				trigger = { is_in_list = prev_group_members }
				desc = {
					desc = wc_arthas_story_90_DESC_group_beginning
					triggered_desc = {
						trigger = { exists = scope:killed_terenas }
						desc = wc_arthas_story_90_DESC_group_killed_terenas
					}
					desc = wc_arthas_story_90_DESC_group_ending
				}
			}
			desc = {
				desc = wc_arthas_story_90_DESC_world_beginning
				triggered_desc = {
					trigger = { exists = scope:killed_terenas }
					desc = wc_arthas_story_90_DESC_world_killed_terenas
				}
				desc = wc_arthas_story_90_DESC_world_ending
			}
		}
	}
	theme = plague
	override_background = {
		reference = wc_undead
	}
	left_portrait = {
		character = scope:host
		scripted_animation = duel_wield_weapon
	}
	right_portrait = {
		character = global_var:terenas_character
		animation = fear
	}
	artifact = {
		target = scope:newly_created_artifact
		position = lower_left_portrait
		trigger = { exists = scope:newly_created_artifact }
	}
	
	trigger = {
		exists = scope:activity
	}
	
	immediate = {
		if = {
			limit = { root = scope:host }
			arthas_find_terenas_effect = yes
			scope:host = { save_scope_as = background_throne_room_scope }
			find_nerzhul_effect = yes
			
			scope:activity = {
				every_attending_character = {
					limit = { is_in_arthas_expedition_trigger = yes }
					add_to_list = prev_group_members
				}
			}
			
			global_var:terenas_character.faith = {
				change_fervor = {
					value = -30
					desc = fervor_loss_scourge
				}
			}
			
			# Search for relationships
			set_being_notified_list_effect = yes
			every_in_list = {
				list = being_notified_list
				add_to_list = notified_list
			}
			every_player = {
				limit = {
					NOT = { this = scope:host }
					get_news_from_region_trigger = { REGION = world_eastern_kingdoms }
				}
				add_to_list = notified_list
			}
			
			every_in_list = {
				list = notified_list
				trigger_event = wc_arthas_story.90
			}
		}
		
		if = {
			limit = { is_in_list = being_notified_list }
			calculate_stress_gain_loss_from_deceased_character_effect = {
				DYING_CHARACTER = scope:lost_character
			}
		}
	}
	
	option = {
		trigger = { root = scope:host }
		name = wc_arthas_story_90_OPT_arthas

		global_var:lordaeron_city = {
			massacre_of_lordaeron_city_effect = { ARTHAS = scope:host }
		}
	
		#complete_arthas_expedition_effect = yes
		
		show_as_tooltip = {
			liege = {
				var:lordaeron_plague_war = {
					end_war = attacker
				}
			}
		}
		
		trigger_event = { id = wc_arthas_story.160 days = 1 }
	}
	option = {
		trigger = {
			NOT = {
				root = scope:host
			}
			is_in_list = prev_group_members
		}
		name = wc_arthas_story_90_OPT_group
		
		show_as_tooltip = {
			complete_arthas_expedition_effect = yes
		}
	}
	# A part of him still alive!
	option = {
		trigger = {
			NOR = {
				root = scope:host
				is_in_list = prev_group_members
			}
			is_in_list = being_notified_list
		}
		name = WCBEI_10_OPT_A
		
		being_notification_denial_stress_effect = yes

		remove_any_good_relationship_with_target_effect = { TARGET = scope:lost_character }
	}
	option = {
		trigger = {
			NOR = {
				root = scope:host
				is_in_list = prev_group_members
				is_in_list = being_notified_list
			}
		}
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							religion = scope:nerzhul.religion
						}
						desc = wc_arthas_story_90_OPT_cultist
					}
					triggered_desc = {
						trigger = {
							OR = {
								has_trait_or_trait_is_virtue_trigger = { TRAIT = compassionate }
								AND = {
									root.culture = { has_same_culture_heritage = global_var:terenas_character.culture }
									root.religion = global_var:terenas_character.religion
								}
							}
						}
						desc = wc_arthas_story_40_OPT_B_negative
					}
					triggered_desc = {
						trigger = {
							OR = {
								has_trait_or_trait_is_virtue_trigger = { TRAIT = sadistic }
								has_trait_or_trait_is_virtue_trigger = { TRAIT = callous }
							}
						}
						desc = wc_arthas_story_40_OPT_B_positive
					}
					desc = wc_arthas_story_40_OPT_B_neutral
				}
			}
		}
	}
}

wc_arthas_story.99 = {
	scope = character
	hidden = yes
	
	immediate = {
		current_travel_plan = {
			add_travel_waypoint = title:c_lordaeron.title_province
		}
	}
}

# Hello father
wc_arthas_story.100 = {
	type = activity_event
	title = wc_arthas_story.100.t
	desc = wc_arthas_story.100.desc
	theme = crown
	override_background = {
		reference = wc_lordaeron_throne_room
	}
	left_portrait = {
		character = scope:host
		animation = throne_room_kneel_1
	}
	right_portrait = {
		character = global_var:terenas_character
		animation = admiration
	}
	
	trigger = {
		has_global_variable = terenas_character
		global_var:terenas_character = {
			is_valid_terenas_to_kill_trigger = yes
		}
	}

	immediate = {
		if = {
			limit = { root = scope:host }
			add_character_flag = { flag = no_headgear days = 5 }
			share_event_with_group_effect = { ID = wc_arthas_story.101 }
		}
	}

	option = {
		name = wc_arthas_story.100.a
		
		if = {#Arthas, Calia bonus
			limit = {
				is_child_of = global_var:terenas_character
			}
			custom_tooltip = wc_arthas_story.100.tooltip
		}
		add_trait = loyal
		add_prestige_level = 1

		set_relation_friend = global_var:terenas_character

		join_every_war_effect = { JOINER = root JOIN_TO = global_var:terenas_character }
		spawn_army = {
			uses_supply = no
			inheritable = yes
			name = alliance_elite_troops_name
			men_at_arms = {
				type = house_guard
				stacks = 3
			}
			men_at_arms = {
				type = armored_horsemen
				stacks = 3
			}
			men_at_arms = {
				type = trebuchet
				stacks = 5
			}
			location = title:c_lordaeron.title_province
			origin = title:c_lordaeron.title_province
		}
	}
	after = {
		if = {
			limit = { root = scope:host is_ai = yes }
			complete_arthas_expedition_effect = yes
		}
	}
}
#Group notification
wc_arthas_story.101 = {
	type = activity_event
	title = wc_arthas_story.100.t
	desc = wc_arthas_story.101.desc
	theme = crown
	override_background = {
		reference = wc_lordaeron_throne_room
	}
	left_portrait = {
		character = scope:host
		animation = throne_room_kneel_1
	}
	right_portrait = {
		character = global_var:terenas_character
		animation = admiration
	}

	immediate = {
		add_character_flag = { flag = no_headgear days = 5 }
	}

	option = {
		name = wc_arthas_story.101.a
		
		add_trait = loyal
		add_prestige_level = 1

		if = {
			limit = { is_ruler = yes }
			join_every_war_effect = { JOINER = root JOIN_TO = global_var:terenas_character }
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = alliance_elite_troops_name
				men_at_arms = {
					type = house_guard
					stacks = 2
				}
				men_at_arms = {
					type = armored_horsemen
					stacks = 2
				}
				location = title:c_lordaeron.title_province
				origin = title:c_lordaeron.title_province
			}
		}
	}
}






# Arthas dies so you return back home
wc_arthas_story.150 = {
	type = activity_event
	title = wc_arthas_story_150_TITLE
	desc = wc_arthas_story_150_DESC
	theme = plague
	right_portrait = {
		character = scope:host
		animation = personality_bold
	}
	left_portrait = {
		character = this
		animation = grief
	}
	
	immediate = {
		custom_tooltip = activity_arthas_expedition_invalid_tooltip
	}
	
	option = {
		name = wc_arthas_story_150_OPT_A
	}
}
# Delayed hood removing and war ending
wc_arthas_story.160 = {
	type = character_event
	hidden = yes
	
	immediate = {
		remove_character_flag = wear_hood_flag
		remove_character_flag = wear_frostmourne_flag
		title:e_lordaeron.holder ?= {
			save_scope_as = calia
		}
		liege = {
			var:lordaeron_plague_war = {
				end_war = attacker
			}
			remove_variable = lordaeron_plague_war
		}
		if = {
			limit = {
				exists = title:e_lordaeron
			}
			shatter_realm_effect = { WINNER = title:k_lordaeron.holder LOSER = title:e_lordaeron.holder }
		}
		scope:calia = {
			add_pressed_claim = title:e_lordaeron
		}
	}
}

##Lich King notification for someone touching Frostmourne
wc_arthas_story.170 = {
	type = character_event
	title = wc_arthas_story_170_TITLE
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { root = scope:nerzhul }
				desc = wc_arthas_story_170_DESC
			}
			desc = wc_arthas_story_170_DESC_group
		}
	}
	theme = plague
	override_background = {
		reference = wc_background_northrend
	}
	right_portrait = {
		character = scope:host
		animation = pain
	}
	option = {
		name = wc_arthas_story_170_OPT_A
	}
	artifact = {
		target = scope:newly_created_artifact
		position = lower_right_portrait
		trigger = { exists = scope:newly_created_artifact }
	}
}