#############################################
# Enforce the Brotherhood of Northshire		#
# by ElMariuso								#
#############################################

enforce_the_brotherhood_decision = {
	picture = "gfx/interface/illustrations/decisions/enforce_the_brotherhood.dds"
	major = yes

	ai_check_interval = 2

	desc = enforce_the_brotherhood_decision_desc
	selection_tooltip = enforce_the_brotherhood_decision_tooltip

	is_shown = {
		is_landed = yes
		is_incapable = no
		has_title = title:k_stormwind
		
		# Must follow the Church
		faith = { wc_valid_light_faith_for_northshire_trigger = yes }
		# Should be at war against a crisis
		any_war_enemy = { is_crisis_trigger = yes }
		
		# Brotherhood cannot have existed already.
		brotherhood_have_not_existed_trigger = yes
	}

	is_valid = {
		# Must be independent.
		is_independent_ruler = yes
		
		# The abbot should exist and not the ruler
		title:c_northshire.holder = {
			top_liege = root
			government_has_flag = government_is_theocracy
			NOT = { is_at_war_with = root }
		}
		
		# Repeat faith requirements
		custom_tooltip = {
			faith = { wc_valid_light_faith_for_northshire_trigger = yes }
			text = wc_valid_light_faith_for_northshire_trigger_tt
		}
		# Repeat crisis requirements
		custom_tooltip = {
			any_war_enemy = { is_crisis_trigger = yes }
			text = wc_at_war_against_crisis_trigger_tt
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		is_imprisoned = no
	}

	effect = {
		save_scope_as = founder
		title:c_northshire.holder = { save_scope_as = abbot }
		random_war_enemy = {
			limit = { is_crisis_trigger = yes }
			save_scope_as = invader
		}
		# Show the results.
		show_as_tooltip = { enforce_the_brotherhood_decision_tooltip_effect = yes }
		# Send out events.
		trigger_event = { id = wc_holy_order_decision.0001 }
		# Notification of other players is handled in the immediate block of scope:founder's event.
		# Flag to stop this repeating is filed in the scripted effect, since we might forge them via event instead.
	}

	cost = {
		piety = 300
		gold = 100
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

#############################################
# Creation of the Silver Hand 				#
# by Dione and ElMariuso					#
#############################################

form_the_silver_hand_decision = {
	picture = "gfx/interface/illustrations/decisions/form_the_silver_hand.dds"
	major = yes

	ai_check_interval = 2
	
	desc = {
		first_valid = {
			triggered_desc = {
			    trigger = {
					is_target_in_global_variable_list = {
						name = unavailable_unique_decisions
						target = flag:flag_destroyed_brotherhood
					}
			    }
			    desc = form_the_silver_hand_decision_desc
			}
			desc = form_the_silver_hand_decision_northshire_stay_desc
		}
	}
	selection_tooltip = form_the_silver_hand_decision_tooltip

	is_shown = {
		is_incapable = no
		has_title = title:k_holy_light_church
		
		# Should be in the Alliance or Northshire should be destroyed
		OR = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_destroyed_brotherhood
			}
			this_union_exists_trigger = { faction = alliance }
		}

		# Avoid triggering the thing multiple times
		NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_silver_hand_creation
			}
		}
		
		#Silver Hand should have not to already exist
		silver_hand_have_not_existed_trigger = yes
	}

	is_valid = {
		piety_level >= 1
		learning >= 10
		num_virtuous_traits >= 1
		
		# Is in Alliance
		is_in_the_alliance_trigger = yes
		# The leader of the Alliance should have an holy site
		has_an_alliance_holy_site_trigger = yes
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		is_imprisoned = no
	}

	effect = {
		save_scope_as = founder
		# Send out events.

		hidden_effect = {
			create_paladins_list_effect = yes
		}

		show_as_tooltip = {
			create_silver_hand_scripted_effect = yes
			manage_original_paladins_scripted_effect = yes
			create_and_distribute_original_librams_scripted_effect = yes
		}

		trigger_event = { days = 10 id = wc_holy_order_decision.0010 }

		# Notification
		every_player = {
			limit = {
				# No repeat
				NOT = {
					this = scope:founder
					is_ai = yes # We don't care if you are ai
				}
				OR = {
					# We notify everyone of the religion
					AND = {
						religion = religion:tyrism_religion
						this.capital_province = { geographical_region = world_eastern_kingdoms_lordaeron }
					}
					# But also everyone in the Alliance
					is_in_the_alliance_trigger = yes
					any_liege_or_above = { is_in_the_alliance_trigger = yes }
					# But also random people in Lordaeron
					this.capital_province = { geographical_region = world_eastern_kingdoms_lordaeron }
				}
			}
			trigger_event = { days = 10 id = wc_holy_order_decision.0011 }
		}
		# Notification of other players is handled in the immediate block of scope:founder's event.
		# Flag to stop this repeating is filed in the scripted effect, since we might forge them via event instead.

		# Flag the Silver Hand  as enforced.
		hidden_effect = {
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_silver_hand_creation
			}
		}
	}

	cost = {
		gold = {
			if = {
				limit = { is_ai = yes }
				value = 0
			}
			else_if = {
				limit = {
					is_target_in_global_variable_list = {
						name = unavailable_unique_decisions
						target = flag:flag_destroyed_brotherhood
					}
				}
				value = 200
			}
			else = { value = 600 }
		}
		piety = {
			if = {
				limit = { is_ai = yes }
				value = 0
			}
			else_if = {
				limit = {
					is_target_in_global_variable_list = {
						name = unavailable_unique_decisions
						target = flag:flag_destroyed_brotherhood
					}
				}
				value = 600
			}
			else = { value = 1000 }
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}