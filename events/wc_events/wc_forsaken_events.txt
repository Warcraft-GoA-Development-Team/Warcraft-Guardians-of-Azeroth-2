namespace = forsaken 

##############################################
# 0001 - 0099: Pre-Divergence Events
##############################################

# interactions between Arthas anc a character who will come to rule the Forsaken (Sylvanas or someone else)

##############################################
# 0501 - 0599: Divergence Events
##############################################

# events where that character breaks away from the scourge

##############################################
# 1001 - 1099: Reclamation of Lordaeron Events
##############################################

#vassal has taken the "develop the undercity" decision
forsaken.1000 = { 

	type = character_event
	title = forsaken.1000.title
	desc = forsaken.1000.desc
	theme = stewardship
	override_background = market

	right_portrait = { 
		character = root
		animation = steward
	}

	left_portrait = { 
		character = scope:story.story_owner
		animation = admiration
	}

	immediate = { 
		scope:story.story_owner = { 
			save_scope_as = current_owner
		}
		stress_impact = {
			arbitrary = medium_stress_impact_gain
			stubborn = medium_stress_impact_gain
			ambitious = medium_stress_impact_gain
			paranoid = medium_stress_impact_gain
			arrogant = medium_stress_impact_gain
		}
	}

	# take over the story (player only)
	option = {
		trigger = { 
			is_ai = no 
			piety_level >= 2
			prestige_level >= 2 
			is_of_forsaken_like_culture = yes
		}

		name = forsaken.1000.opt.a
		scope:story = { 
			make_story_owner = root
		}
		scope:current_owner = { 
			send_interface_toast = {
				title = forsaken.1000.manage_construction_title
				left_icon = scope:current_owner
				custom_tooltip = forsaken.1000.manage_construction_tt
				add_gold = 250
				progress_towards_rival_effect = {
					CHARACTER = root
					OPINION = -15
					REASON = forsaken.1000.manage_construction_tt
				}
				set_global_variable = { name = sylvanas_character value = root }
			}
		}
		remove_short_term_gold = 250

		stress_impact = {
			content = medium_stress_impact_gain
			humble = medium_stress_impact_gain
			arbitrary = medium_stress_impact_loss
			stubborn = minor_stress_impact_loss
			ambitious = minor_stress_impact_loss
			paranoid = medium_stress_impact_loss
			arrogant = medium_stress_impact_loss
		}
	}

	# approve - let vassal deal with it
	option = { 
		name = forsaken.1000.opt.b
		scope:current_owner = {
			send_interface_toast = {
				title = forsaken.1000.approve_title
				left_icon = root
				custom_tooltip = forsaken.1000.approve_tt
				progress_towards_friend_effect = {
					CHARACTER = root
					OPINION = 25
					REASON = forsaken.1000.approve_tt
				}
			}
		}

		ai_chance = { 
			base = 2
			ai_value_modifier = {
				ai_honor = 0.5
				ai_compassion = 1
				ai_boldness = -1
			}
		}
	}

	# disapprove - let vassal deal with it
	option = { 
		name = forsaken.1000.opt.c
		scope:current_owner = { 
			send_interface_toast = {
				title = forsaken.1000.disapprove_title
				left_icon = root
				custom_tooltip = forsaken.1000.disapprove_tt
				progress_towards_rival_effect = {
					CHARACTER = root
					OPINION = -25
					REASON = forsaken.1000.disapprove_tt
				}
			}
		}

		ai_chance = { 
			base = 2
			ai_value_modifier = {
				ai_honor = -0.5
				ai_compassion = -1
				ai_boldness = 1
			}
		}

		stress_impact = {
			arbitrary = minor_stress_impact_loss
			stubborn = minor_stress_impact_loss
			ambitious = minor_stress_impact_loss
			paranoid = minor_stress_impact_loss
			arrogant = medium_stress_impact_loss
		}
	}
}

forsaken.1001 = { 

	type = character_event
	title = forsaken.1001.title
	theme = stewardship
	override_background = market

	desc = { 
		first_valid = { # completely different perspective based on whether Lordaeron is still held by the story owner
			triggered_desc = { 
				trigger = { 
					NOR = { 
						title:b_lordaeron.holder = { any_liege_or_above = { this = scope:story.story_owner } } 
						title:b_lordaeron.holder = scope:story.story_owner 
					}
				}
				desc = forsaken.1001.desc.independent
			}
			desc = forsaken.1001.desc.owned
		}
	}

	immediate = { 
		#scope:story.story_owner = { save_scope_as = story_owner }
		title:b_lordaeron.title_province = { 
			remove_building = ruined_palace_01
			add_special_building = ruined_palace_02 
		}
		title:b_lordaeron = {
			remove_variable = develop_the_undercity
			set_variable = { name = develop_the_undercity value = flag:finished }
			hidden_effect = { if = { limit = { var:develop_the_undercity = flag:finished } } } #error.log
		}
		title:c_lordaeron = {
			set_county_culture = culture:forsaken
		}
	}

	right_portrait = { 
		character = root
		animation = steward
	}

	trigger = {
		title:b_lordaeron = {
			holder = { 
				self_or_liege_is_of_forsaken_like_culture = yes
			} 
			var:develop_the_undercity ?= flag:ready
		}
	}
	
	on_trigger_fail = { 
		title:b_lordaeron.holder = { 
			if = { 
				limit = { NOT = { this = root } self_or_liege_is_of_forsaken_like_culture = yes } 
				trigger_event = { id = forsaken.1001 days = 1 }
			}
			else = { 
				trigger_event = { id = forsaken.1002 days = 1 }
			}
		}
	}

	option = { 
		name = { 
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							NOR = { 
								title:b_lordaeron.holder = { any_liege_or_above = { this = scope:story.story_owner } } 
								title:b_lordaeron.holder = scope:story.story_owner 
							}
						 }
						desc = forsaken.1001.opt.a.independent
					}
					desc = forsaken.1001.opt.a.owned
				}
			}
		} 

		show_as_tooltip = { 
			custom_tooltip = forsaken.1001.tooltip.a
		}

		hidden_effect = { 
			global_var:sylvanas_character = { 
				if = {
					limit = { is_alive = yes }
					trigger_event = { 
						id = forsaken.1100 
						years = 2
						delayed = yes
					}
				}
			}

			create_dispersed_crypto_religionists = { FAITH = faith:forgotten_shadow }
			#TODO: Link the random vassals to the next event? could be cool to have secret faith characters randomly dispersed tho
		}

		stress_impact = {
			craven = minor_stress_impact_loss # safe in my hidey hole
			paranoid = minor_stress_impact_loss # safe in my hidey hole
			ambitious = minor_stress_impact_loss # built something great
			arrogant = minor_stress_impact_loss # built something great
		}
	}

}

# Failed construction of Undercity
forsaken.1002 = { 

	type = character_event
	title = forsaken.1002.title
	desc = forsaken.1002.desc
	theme = dungeon
	override_background = market

	right_portrait = { 
		character = root
		animation = stress
	}

	immediate = { 
		title:b_lordaeron = {
			title_province = {
				remove_province_modifier = wc_building_undercity
			}
			set_variable = { 
				name = develop_the_undercity
				value = flag:interruption
				years = 5
			}
			hidden_effect = { if = { limit = { var:develop_the_undercity = flag:interruption } } }
		}
		stress_impact = {
			lazy = minor_stress_impact_loss
			paranoid = minor_stress_impact_loss
			content = minor_stress_impact_loss
			ambitious = medium_stress_impact_gain
			stubborn = medium_stress_impact_gain
		}
	}

	option = { 
		name = forsaken.1002.opt.a
		show_as_tooltip = { 
			custom_tooltip = forsaken.1002.tooltip.a
		}
	}
	
}

#Change in story ownership
forsaken.1003 = { 

	type = character_event
	title = forsaken.1003.title
	desc = forsaken.1003.desc
	theme = skull

	right_portrait = { 
		character = root
		animation = grief
	}

	option = { 
		name = forsaken.1003.opt.a
		stress_impact = {
			lazy = minor_stress_impact_gain
			paranoid = minor_stress_impact_gain
			content = minor_stress_impact_gain
			ambitious = minor_stress_impact_loss
		}
	}
	
}

#Owner of Lordaeron who is not story_owner upon completion
forsaken.1004 = { 

	type = character_event
	title = forsaken.1004.title
	theme = stewardship

	desc = { 
		first_valid = { # Same as forsaken.1001 if they are independent...
			triggered_desc = { 
				trigger = { NOT = { title:b_lordaeron.holder = { any_liege_or_above = { this = scope:story.story_owner } } } }
				desc = forsaken.1004.desc.independent
			}
			desc = forsaken.1004.desc.vassal # ...but completely different perspective if they are a vassal
		}
	}

	left_portrait = { 
		character = root
		animation = celebrate_sword
	}

	right_portrait = { 
		character = scope:story.story_owner
		scripted_animation = {
			triggered_animation = {
				trigger = { NOT = { title:b_lordaeron.holder = { any_liege_or_above = { this = scope:story.story_owner } } } }
				animation = disapproval
			}
			animation = steward
		}
	}

	immediate = {
		stress_impact = {
			craven = minor_stress_impact_loss # safe in my hidey hole
			paranoid = minor_stress_impact_loss # safe in my hidey hole
			ambitious = minor_stress_impact_loss # built something great
			arrogant = minor_stress_impact_loss # built something great
		}
	}

	option = { 
		trigger = { NOT = { title:b_lordaeron.holder = { any_liege_or_above = { this = scope:story.story_owner } } } }
		name = forsaken.1004.opt.a
		add_prestige = 100
		add_gold = 25
		show_as_tooltip = { 
			custom_tooltip = forsaken.1004.tooltip.a
		}
		hidden_effect = { 
			title:b_lordaeron.holder = { 
				create_dispersed_crypto_religionists = { FAITH = faith:forgotten_shadow }
			}
		}
	}

	option = { 
		trigger = { title:b_lordaeron.holder = { any_liege_or_above = { this = scope:story.story_owner } } }
		name = forsaken.1004.opt.a
	}
}


#####################################
#1100 - 1199: Post-Reclamation events
#####################################

#1100 - 1109: Selenite Revival

forsaken.1100 = { 

	type = character_event
	title = forsaken.1100.title
	desc = forsaken.1100.desc
	theme = faith
	override_background = wc_undercity_throne_room

	immediate = {

		stress_impact = {
			zealous = medium_stress_impact_gain
			paranoid = medium_stress_impact_gain
			stubborn = minor_stress_impact_gain
			arbitrary = minor_stress_impact_gain
		}

		root = { 
			save_scope_as = selenite_decider
		}

		every_vassal_or_below = {
			limit = {
				faith.religion = { is_in_family = rf_shadow }
				highest_held_title_tier >= tier_county
				is_ai = yes
				NOR = { 
					faith = faith:forgotten_shadow 
					government_has_flag = government_is_theocracy 
					piety_level >= 2 
					any_held_title = { this = title:b_lordaeron }
				}
				NOR = { has_trait = zealous has_trait = loyal has_trait = holy_warrior has_trait = stubborn }
			}
			add_to_temporary_list = tmp_selinites
		}
		random_in_list = {
			list = tmp_selinites
			set_character_faith = faith:forgotten_shadow
			random_held_county = {
				set_county_faith = faith:forgotten_shadow
			}
			save_scope_as = selinite_1 
			scope:selinite_1 = { remove_from_list = tmp_selinites }
		}
		random_in_list = {
			list = tmp_selinites
			set_character_faith = faith:forgotten_shadow
			random_held_county = {
				set_county_faith = faith:forgotten_shadow
			}
			save_scope_as = selinite_2
			scope:selinite_2 = { remove_from_list = tmp_selinites }
		}
		random_in_list = {
			list = tmp_selinites
			set_character_faith = faith:forgotten_shadow
			random_held_county = {
				limit = { tier = tier_county }
				set_county_faith = faith:forgotten_shadow
			}
			save_scope_as = selinite_3 
			scope:selinite_3 = { remove_from_list = tmp_selinites }
		}
	}

	right_portrait = { 
		character = root
		animation = worry
	}

	lower_left_portrait = {
		character = scope:selinite_1
	}

	lower_center_portrait = { 
		character = scope:selinite_2
	}

	lower_right_portrait = { 
		character = scope:selinite_3
	}

	trigger = {
		self_or_liege_is_of_forsaken_like_culture = yes
	}

	option = { 
		# retain sylvanas cult of personality - AI chance 75
		name = forsaken.1100.opt.a

		if = { 
			limit = { NOT = { faith = faith:forsaken_cult } }
			set_character_faith = faith:forsaken_cult
		}

		title:c_lordaeron = { 
			if = {
				limit = { holder = root }
				set_county_faith = faith:forsaken_cult
			}
			else = { 
				holder = { 
					trigger_event = {
						id = forsaken.1103
						days = 7
					} 
				}
			}
		}

		add_character_modifier = { 
			modifier = wc_forsaken_subsumed_selinite_modifier
		}

		custom_tooltip = { 
			text = damned_will_convert_to_forsaken_cult
			trigger_event = forsaken.1101
		}

		set_variable = { 
			name = selinite_decision
			value = flag:subsumed
		}
		
		stress_impact = {
			arbitrary = minor_stress_impact_loss
			zealous = minor_stress_impact_loss
		}
		
		ai_chance = { 
			base = 75
			ai_value_modifier = {
				ai_honor = -0.5
				ai_compassion = -1
				ai_boldness = 1
				ai_rationality = 1
			}
		}
	}

	option = { 
		# convert and delegate religious authority to cult of forgotten shadow - AI chance 20
		name = forsaken.1100.opt.b

		trigger = { NOT = { any_held_title = { is_head_of_faith = yes } } }

		if = { 
			limit = { NOT = { faith = faith:forgotten_shadow } }
			set_character_faith = faith:forgotten_shadow
		}

		title:c_lordaeron = { 
			if = {
				limit = { holder = root }
				set_county_faith = faith:forgotten_shadow
			}
			else = { 
				holder = { 
					trigger_event = {
						id = forsaken.1103
						days = 7
					} 
				}
			}
		}

		custom_tooltip = { 
			text = cultists_will_convert_to_forgotten_shadow
			trigger_event = forsaken.1102
		}

		set_variable = { 
			name = selinite_decision
			value = flag:embraced
		}

		add_character_modifier = wc_forsaken_embraced_selinite_modifier

		stress_impact = {
			zealous = major_stress_impact_gain
			stubborn = medium_stress_impact_gain
			ambitious = medium_stress_impact_gain
			lazy = minor_stress_impact_loss
			content = minor_stress_impact_loss
			fickle = minor_stress_impact_loss
		}

		ai_chance = { 
			base = 20
			ai_value_modifier = {
				ai_honor = -0.5
				ai_boldness = 1
				ai_zeal = -1
			}
			modifier = {
				has_trait = zealous
				factor = 0
			}
		}
	}

	option = { 
		# retain cult of personality but grant religious freedom to selinites - AI chance 5
		name = forsaken.1100.opt.c
		#vassal_contract_set_obligation_level = { type = religious_rights level = 1 } wanted to do this but necro govt blocks it
		
		chance_convert_county_to_selinite = yes

		set_variable = { 
			name = selinite_decision
			value = flag:tolerated
		}
		
		add_character_modifier = wc_forsaken_tolerated_selinite_modifier

		stress_impact = {
			compassionate = minor_stress_impact_loss
			content = minor_stress_impact_loss
			just = minor_stress_impact_loss
			cynical = minor_stress_impact_gain
			arbitrary = medium_stress_impact_gain
			paranoid = medium_stress_impact_gain
		}

		ai_chance = { 
			base = 5
			ai_value_modifier = {
				ai_honor = 0.5
				ai_compassion = 1
				ai_boldness = -1
				ai_zeal = -1
			}
			modifier = {
				has_trait = just
				has_trait = compassionate
				factor = 100
			}
			modifier = {
				has_trait = cynical
				add = 70
			}
		}
	}
}

forsaken.1101 = { 
	hidden = yes 
	type = character_event

	immediate = { 

		save_scope_as = actor

		primary_title = {
			every_in_de_facto_hierarchy = {
				limit = { 
					tier = tier_county  
					faith = faith:death_god 
				}
				set_county_faith = faith:forsaken_cult 
			}
		}

		every_courtier_or_guest = {
			limit = { 
				OR = {
					culture = culture:scourge
					faith = faith:death_god
				}
			}
			save_temporary_scope_as = recipient
			new_faith_created_conversion_effect = yes
		}

		every_vassal_or_below = { 
			limit = { 
				OR = {
					culture = culture:scourge 
					faith = faith:death_god
				}
			}

			save_temporary_scope_as = recipient
			new_faith_created_conversion_effect = yes

			every_courtier_or_guest = {
				limit = { 
					OR = {
						culture = culture:scourge
						faith = faith:death_god
					}
				}
				save_temporary_scope_as = recipient
				new_faith_created_conversion_effect = yes
			}
		}
	}
}

forsaken.1102 = { 
	hidden = yes 
	type = character_event

	immediate = { 
		save_temporary_scope_as = recipient 
		save_scope_as = actor 

		new_faith_created_conversion_effect = yes

		every_courtier_or_guest = {
			limit = { 
				OR = {
					culture = culture:forsaken 
					faith = faith:forsaken_cult
					faith = faith:death_god
				}
			}
			save_temporary_scope_as = recipient
			new_faith_created_conversion_effect = yes
		}

		every_vassal_or_below = { 
			limit = { 
				OR = {
					culture = culture:forsaken 
					faith = faith:forsaken_cult
					faith = faith:death_god
				}
			}
			save_temporary_scope_as = recipient
			new_faith_created_conversion_effect = yes

			every_courtier_or_guest = {
				limit = { 
					OR = {
						culture = culture:forsaken 
						faith = faith:forsaken_cult
						faith = faith:death_god
					}
				}
				save_temporary_scope_as = recipient
				new_faith_created_conversion_effect = yes
			}
		}
	}
}

forsaken.1103 = { 
	type = character_event
	title = forsaken.1103.title
	theme = faith
	override_background = wc_undercity_throne_room

	desc = { 
		first_valid = { 
			triggered_desc = { # each version has a different sentence describing story owner's actions.
				trigger = { scope:story.story_owner = { var:selinite_decision = flag:subsumed } }
				desc = forsaken.1103.desc.subsumed
			} 
			triggered_desc = { 
				trigger = { scope:story.story_owner = { var:selinite_decision = flag:embraced } }
				desc = forsaken.1103.desc.embraced
			}
			desc = forsaken.1103.desc.tolerated
		}
	}

	immediate = {
		stress_impact = {
			zealous = medium_stress_impact_gain
			paranoid = medium_stress_impact_gain
			stubborn = minor_stress_impact_gain
			arbitrary = minor_stress_impact_gain
		}
	}

	trigger = { 
		is_of_forsaken_like_culture = yes
		NOT = { faith = faith:forgotten_shadow }
	}

	option = { 
		name = forsaken.1103.opt.a 

		if = { 
			limit = { NOT = { faith = faith:forsaken_cult } }
			set_character_faith = faith:forsaken_cult
		}

		title:c_lordaeron = { 
			set_county_faith = faith:forsaken_cult
		}

		custom_tooltip = { 
			text = damned_will_convert_to_forsaken_cult
			trigger_event = forsaken.1101
		}

		if = { 
			limit = { 
				scope:story.story_owner = { var:selinite_decision = flag:subsumed } 
			 	any_liege_or_above = { this = scope:story.story_owner } 
			} 
			progress_towards_friend_effect = {
				CHARACTER = scope:story.story_owner
				OPINION = 50
				REASON = forsaken.1103.obeyed
			}
		} 
		else_if = { 
			limit = { scope:story.story_owner = { var:selinite_decision = flag:embraced } }
			if = { 
				limit = { any_liege_or_above = { this = scope:story.story_owner } } 
				progress_towards_rival_effect = {
					CHARACTER = scope:story.story_owner
					OPINION = -50
					REASON = forsaken.1103.disobeyed
				}
				add_piety = 100
			} else = { 
				add_character_modifier = wc_forsaken_subsumed_selinite_modifier
			} 
		} 
		else_if = { 
			limit = { 
				scope:story.story_owner = { var:selinite_decision = flag:tolerated } 
			} 
			if = { 
				limit = { any_liege_or_above = { this = scope:story.story_owner } }
				progress_towards_rival_effect = {
					CHARACTER = scope:story.story_owner
					OPINION = -20
					REASON = forsaken.1103.disobeyed
				}
				add_piety = 100
			} else = { 
				add_character_modifier =  wc_forsaken_subsumed_selinite_modifier
			} 
		}
		
		stress_impact = {
			arbitrary = minor_stress_impact_loss
			zealous = minor_stress_impact_loss
		}
		
		ai_chance = { 
			base = 75
			ai_value_modifier = {
				ai_honor = -0.5
				ai_compassion = -1
				ai_boldness = 1
				ai_rationality = 1
			}
		}
	}

	option = { 
		name = forsaken.1103.opt.b 

		title:c_lordaeron = { 
			set_county_faith = faith:forgotten_shadow
		}

		if = { 
			limit = { NOT = { faith = faith:forgotten_shadow } }
			set_character_faith = faith:forgotten_shadow
		}

		custom_tooltip = { 
			text = cultists_will_convert_to_forgotten_shadow
			trigger_event = forsaken.1102
		}
		if = { 
			limit = { 
				scope:story.story_owner = { var:selinite_decision = flag:embraced }
				any_liege_or_above = { this = scope:story.story_owner } 
			} 
			progress_towards_friend_effect = {
				CHARACTER = scope:story.story_owner
				OPINION = 50
				REASON = forsaken.1103.obeyed
			}
			
		} 
		else_if = { 
			limit = { scope:story.story_owner = { var:selinite_decision = flag:subsumed } }
			if = { 
				limit = { any_liege_or_above = { this = scope:story.story_owner } } 
				progress_towards_rival_effect = {
					CHARACTER = scope:story.story_owner
					OPINION = -50
					REASON = forsaken.1103.disobeyed
				}
				add_piety = 100
			} else = { 
				add_character_modifier = wc_forsaken_embraced_selinite_modifier
			}
		} 
		else_if = { 
			limit = { 
				scope:story.story_owner = { var:selinite_decision = flag:tolerated } 
				NOT = { any_liege_or_above = { this = scope:story.story_owner } }
			}
			add_character_modifier = wc_forsaken_embraced_selinite_modifier
		}

		stress_impact = {
			zealous = major_stress_impact_gain
			stubborn = medium_stress_impact_gain
			ambitious = medium_stress_impact_gain
			lazy = minor_stress_impact_loss
			content = minor_stress_impact_loss
			fickle = minor_stress_impact_loss
		}

		ai_chance = { 
			base = 20
			ai_value_modifier = {
				ai_honor = -0.5
				ai_boldness = 1
				ai_zeal = -1
			}
			modifier = {
				has_trait = zealous
				factor = 0
			}
		}
	}

	option = { 
		name = forsaken.1103.opt.c
		
		if = { 
			limit = { 
				scope:story.story_owner = { var:selinite_decision = flag:tolerated } 
				any_liege_or_above = { this = scope:story.story_owner } 
			}
			progress_towards_friend_effect = {
				CHARACTER = scope:story.story_owner
				OPINION = 50
				REASON = forsaken.1103.obeyed
			}
		} 
		else_if = { 
			limit = { scope:story.story_owner = { var:selinite_decision = flag:subsumed } } 
			if = { 
				limit = { any_liege_or_above = { this = scope:story.story_owner } } 
				progress_towards_rival_effect = {
					CHARACTER = scope:story.story_owner
					OPINION = -20
					REASON = forsaken.1103.disobeyed
				}
				add_character_modifier =  wc_forsaken_tolerated_selinite_modifier
			}
		} 
		else_if = { 
			limit = { 
				scope:story.story_owner = { var:selinite_decision = flag:embraced } 
				NOT = { any_liege_or_above = { this = scope:story.story_owner } }
			} 
			add_character_modifier =  wc_forsaken_tolerated_selinite_modifier
		}

		chance_convert_county_to_selinite = yes

		stress_impact = {
			compassionate = minor_stress_impact_loss
			content = minor_stress_impact_loss
			just = minor_stress_impact_loss
			cynical = minor_stress_impact_gain
			arbitrary = medium_stress_impact_gain
			paranoid = medium_stress_impact_gain
		}

		ai_chance = { 
			base = 5
			ai_value_modifier = {
				ai_honor = 0.5
				ai_compassion = 1
				ai_boldness = -1
				ai_zeal = -1
			}
			modifier = {
				has_trait = just
				has_trait = compassionate
				factor = 100
			}
			modifier = {
				has_trait = cynical
				add = 70
			}
		}
	}

}


######################################
#9000 - 9099: Random occurrence events
######################################

# religious minority caught stealing arcane works
forsaken.9001 = { 

	type = character_event
	title = forsaken.9001.title
	theme = intrigue

	desc = { 
		first_valid = { 
			triggered_desc = { 
				trigger = { scope:new_character.faith = faith:echo_of_life }
				desc = forsaken.9001.desc.echoseeker # they are seen as dangerous but not threatening
			}
			triggered_desc = { 
				trigger = { scope:new_character.faith = faith:alchemical_materialism }
				desc = forsaken.9001.desc.alchemist # they are seen as a bit more dangerous but slightly less threatening
			}
			triggered_desc = { 
				trigger = { scope:new_character.faith = faith:forsaken_cult }
				desc = forsaken.9001.desc.forsaken # they are seen as not dangerous but highly threatening
			}
			desc = forsaken.9001.desc.forgotten #they are seen as both dangerous and highly threatening
		}
	}

	trigger = { NOT = { has_character_flag = forsaken_9001 }}

	immediate = { 

		add_character_flag = { 
			flag = forsaken_9001
			days = 1825
		}

		stress_impact = {
			greedy = minor_stress_impact_gain
			paranoid = medium_stress_impact_gain
		}
		
		create_character = {
			age = { 18 40 }
			diplomacy = { min_template_low_skill max_template_decent_skill }
			martial = { min_template_low_skill max_template_low_skill }
			stewardship = { min_template_low_skill max_template_average_skill }
			intrigue = { min_template_decent_skill max_template_decent_skill }
			learning = { min_template_decent_skill max_template_decent_skill }
			faith = faith:holy_light
			culture = root.culture
			location = root.location
			random_traits_list = {
				count = 1
				education_intrigue_2 = {}
				education_learning_2 = {}
			}
			random_traits = yes
			gender_female_chance = 50
			save_scope_as = new_character
			after_creation = { 
				trigger_race_giving_no_gene_effect = yes
				become_undead_effect = yes
				random_list = { 
					50 = {
						modifier = { 
							factor = 0
							root.faith = faith:echo_of_life
						}
						set_character_faith = faith:echo_of_life 
					}
					50 = { 
						modifier = { 
							factor = 0
							OR = { 
								root.faith = faith:alchemical_materialism 
								NOT = { 
									title:b_lordaeron = { 
										var:develop_the_undercity ?= flag:finished
									}
								}
							}
						}
						set_character_faith = faith:alchemical_materialism 
					}
					50 = {
						trigger = { 
							OR = { 
								root.faith = faith:echo_of_life
								root.faith = faith:alchemical_materialism
							}
							title:b_lordaeron = { 
								var:develop_the_undercity ?= flag:finished
							}
						}
						set_character_faith = faith:forgotten_shadow 
						add_trait = devoted
					}
					50 = {
						trigger = { 
							OR = { 
								root.faith = faith:echo_of_life
								root.faith = faith:alchemical_materialism
							}
							NOT = { 
								title:b_lordaeron = { 
									var:develop_the_undercity ?= flag:finished
								}
							}
						}
						set_character_faith = faith:forsaken_cult
					}
				}
			}
		} 
		hidden_effect = {
			add_visiting_courtier = scope:new_character
			add_opinion = { 
				target = scope:new_character
				modifier = theft_opinion
			}
		}
        stress_impact = {
			base = minor_stress_impact_gain
			paranoid = medium_stress_impact_gain
		}
	}

	right_portrait = { 
		character = scope:new_character
		animation = shame
	}

	left_portrait = { 
		character = root
		animation = disapproval
	}

	#execute them
	option = { 
		name = forsaken.9001.opt.e
		show_as_tooltip = {
			execute_prisoner_effect = {
				VICTIM = scope:new_character
				EXECUTIONER = root
			}
		}
		add_dread = 5
		add_character_modifier = { 
			modifier = wc_executed_religious_minority_modifier
			years = 2
		}

		stress_impact = {
			compassionate = major_stress_impact_gain
			just = minor_stress_impact_gain
			sadistic = minor_stress_impact_loss
			paranoid = medium_stress_impact_loss
		}

		ai_chance = { 
			base = 0
			ai_value_modifier = {
				ai_vengefulness = 5
			}
			modifier = {
				has_trait = compassionate
				add = -1000
			}
		}
	}

	#imprison them
	option = { 
		name = forsaken.9001.opt.a
		imprison_character_effect = {
			TARGET = scope:new_character
			IMPRISONER = root
		}
		ai_chance = { 
			base = 2
			ai_value_modifier = {
				ai_honor = 2
			}
		}
	}

	#fine them
	option = { 
		name = forsaken.9001.opt.b
		trigger = { 
			NOT = { scope:new_character.faith = faith:forsaken_cult}
			stewardship >= decent_skill_rating 
		}
		add_gold = 50
		add_hook = {
			type = indebted_hook
			target = scope:new_character
		} 
		remove_courtier_or_guest = { 
			character = scope:new_character
			new_location = title:b_dalaran.title_province
		}
		ai_chance = {
			base = -2
			ai_value_modifier = {
				ai_greed = 5
				ai_sociability = 1
			}
		}
		stress_impact = {
			vengeful = minor_stress_impact_gain
		}
	}

	#invite them to court and get hook
	option = { 
		name = forsaken.9001.opt.c
		trigger = { NOT = { scope:new_character.faith = faith:forsaken_cult}}
		scope:new_character = { 
			progress_towards_friend_effect = {
				REASON = friend_showed_mercy
				CHARACTER = root
				OPINION = 50
			}
		}
		add_hook = {
			target = scope:new_character
			type = loyalty_hook
		}
		ai_chance = {
			base = 1
			ai_value_modifier = {
				ai_sociability = 2
				ai_compassion = 4
			}
			modifier = {
				has_trait = vengeful
				add = -1000
			}
		}
		stress_impact = {
			vengeful = major_stress_impact_gain
		}
	}

	#give them passage to Dalaran and get hook
	option = { 
		name = forsaken.9001.opt.d
		trigger = { learning >= decent_skill_rating }
		add_hook = {
			target = scope:new_character
			type = loyalty_hook
		}
		show_as_tooltip = { 
			random_list = { 
				25 = { 
					remove_courtier_or_guest = { 
						character = scope:new_character
						new_location = title:b_dalaran.title_province
					}
				}
				25 = { 
					remove_courtier_or_guest = { 
						character = scope:new_character
						new_location = title:b_caer_darrow.title_province
					}
				}
				25 = { 
					remove_courtier_or_guest = { 
						character = scope:new_character
						new_location = title:b_karazhan.title_province
					}
				}
				25 = { 
					remove_courtier_or_guest = { 
						character = scope:new_character
						new_location = title:b_gnomeregan.title_province
					}
				}
				25 = { 
					remove_courtier_or_guest = { 
						character = scope:new_character
						new_location = title:b_falthrien.title_province
					}
				}
				25 = { 
					trigger = { in_diplomatic_range = title:b_narthalas_ruins.holder}
					remove_courtier_or_guest = { 
						character = scope:new_character
						new_location = title:b_narthalas_ruins.title_province
					}
				}
			}
		}
		ai_chance = {
			base = 2
			ai_value_modifier = {
				ai_boldness = 3
				ai_rationality = 2
			}
		}
	}
}

#Apothecary offers to enhance soldiers OR Echoseeker offers to train casters
forsaken.9002 = { 

	type = character_event
	title = forsaken.9002.title
	theme = learning

	left_portrait = { 
		character = root
		animation = personality_cynical
	}

	right_portrait = { 
		character = scope:new_character
		animation = flirtation
	}

	trigger = { 
		NOT = { has_character_flag = forsaken_9002 }
	}

	desc = { 
		first_valid = { # just slightly different wording and titles
			triggered_desc = { 
				trigger = { scope:new_character.faith = faith:echo_of_life }
				desc = forsaken.9002.desc.echoseeker
			}
			triggered_desc = { 
				trigger = { scope:new_character.faith = faith:forsaken_cult }
				desc = forsaken.9002.desc.cultist
			}
			desc = forsaken.9002.desc.alchemist
		}
	}


	immediate = { 

		add_character_flag = { 
			flag = forsaken_9002
			days = 1825
		}

		create_character = { 
			template = scholar_character
			location = root.location
			faith = root.faith
			culture = root.culture
			save_scope_as = new_character

			after_creation = {
				# Warcraft
				trigger_race_giving_no_gene_effect = yes
				add_trait = being_undead
				scope:new_character = {
					random_list = { 
						50 = {
							if = { 
								limit = { faith = faith:echo_of_life } 
								set_character_faith = faith:forsaken_cult
							}
							else = { 
								set_character_faith = faith:echo_of_life 
							}
						}
						50 = { 
							if = {
								limit = { 
									OR = { 
										NOT = { 
											title:b_lordaeron = { 
												var:develop_the_undercity ?= flag:finished
											}
										}
										faith = faith:alchemical_materialism
									}
								}
								set_character_faith = faith:forsaken_cult
							}
							else = { 
								set_character_faith = faith:alchemical_materialism 
							}
						}
					}
				}
			}
		}
		random_knight = { 
			limit = { NOT = { exists = primary_title } }
			save_scope_as = doomed_knight
		}
	}

	# yes, let them alter our troops
	option = { 
		name = forsaken.9002.opt.a
		if = { 
			limit = { scope:new_character.faith = faith:echo_of_life }
			random_list = { 
				50 = { 
					send_interface_toast = {
						title = forsaken.9002.education_successful
						left_icon = root
						custom_tooltip = forsaken.9002.education_successful_tt
						add_character_modifier = { 
							modifier = wc_arcanist_educated_casters
							years = 2
						}
						scope:new_character = {
							add_opinion = {
								modifier = intrigue_helped_me_out_opinion
								target = root
							}
						}
					}
				}
				50 = { 
					send_interface_toast = {
						title = forsaken.9002.education_failed
						left_icon = root
						custom_tooltip = forsaken.9002.education_failed_tt
						scope:doomed_knight = { 
							override_death_effect = {
								death_reason = death_arcane_explosion 
							}
						}
						scope:new_character = {
							override_death_effect = {
								death_reason = death_arcane_explosion 
							}
						}
					}
				}
			}
		}
		else = { 
			random_list = { 
				50 = { 
	
					send_interface_toast = {
						title = forsaken.9002.alterations_successful
						left_icon = root
						custom_tooltip = forsaken.9002.alterations_successful_tt
	
						add_character_modifier = { 
							modifier = wc_alchemist_altered_troops
							years = 2
						}
						scope:new_character = {
							add_opinion = {
								modifier = intrigue_helped_me_out_opinion
								target = root
							}
						}
					}
				}
				50 = { 
					send_interface_toast = {
						title = forsaken.9002.alterations_failed
						left_icon = root
						custom_tooltip = forsaken.9002.alterations_failed_tt
						scope:doomed_knight = { 
							override_death_effect = {
								death_reason = death_poison
							}
						}
						scope:new_character = {
							override_death_effect = {
								death_reason = death_poison
							}
						}
					}
				}

			}
		}
		ai_chance = {
			base = 0
			ai_value_modifier = {
				ai_zeal = -1
				ai_compassion = -1 
				ai_honor = -1
				ai_boldness = 1
			}
			modifier = { # AI will use this excuse to execute a disliked knight
				opinion = { 
					target = scope:doomed_knight
					value < 70
				}
				NOT = { has_trait = compassionate has_trait = just has_trait = forgiving }
				add = 100
			}
			modifier = { # but AI will NOT this to execute a family member unless they hate them
				scope:doomed_knight = { 
					is_close_or_extended_family_of = root
				}
				NOT = { has_trait = sadistic }
				add = -90
			}
		}
		stress_impact = {
			compassionate = medium_stress_impact_gain
			just = minor_stress_impact_gain
			callous = minor_stress_impact_loss
			arbitrary = minor_stress_impact_loss
			sadistic = medium_stress_impact_loss
		}
	}

	# no, pursue a safer option 
	option = { 
		name = forsaken.9002.opt.b
		if = { 
			limit = { scope:new_character.faith = faith:alchemical_materialism }
			add_character_modifier = { 
				modifier = wc_alchemist_equipped_troops
				years = 2
			}
		}
		else = { 
			add_character_modifier = { 
				modifier = wc_arcanist_equipped_troops
				years = 2
			}
		}
		remove_short_term_gold = minor_gold_value
		ai_chance = {
			base = 3
			ai_value_modifier = {
				ai_compassion = 1 
				ai_boldness = -1
				ai_honor = 1
			}
			modifier = {
				OR = {
					has_character_modifier = wc_arcanist_equipped_troops 
					has_character_modifier = wc_alchemist_equipped_troops 
				}
				add = -1000
			}
			modifier = { 
				short_term_gold < minor_gold_value_check
				add = -1000
			}
		}
	}

	# reject their help
	option = { 
		name = forsaken.9002.opt.c

		ai_chance = { 
			base = 1
			ai_value_modifier = {
				ai_zeal = 2
				ai_boldness = -1
			}
		}

		hidden_effect = {
			scope:new_character = {
				override_death_effect = { death_reason = death_vanished }
			}
		}
	}
}

# laboratory accident
forsaken.9003 = { 
	type = character_event
	title = forsaken.9003.title
	theme = battle

	override_background = {
		reference = burning_building
	}

	right_portrait = { 
		character = root
		animation = worry
	}

	desc = { 
		first_valid = { 
			triggered_desc = { 
				trigger = { 
					faith = faith:echo_of_life
				}
				desc = forsaken.9003.desc.arcanist # sinister decription, it's our facility
			}
			triggered_desc = { 
				trigger = { 
					OR = { faith = faith:forsaken_cult faith = faith:alchemical_materialism }
				}
				desc = forsaken.9003.desc.alchemist # dispassionate decription, it's our facility
			}
			desc = forsaken.9003.desc.other_alchemist # empathetic decription, it's not our facility
		}
	}

	trigger = { 
		NOR = { 
			var:propaganda_campaign ?= flag:religious
			var:propaganda_campaign ?= flag:cultural_and_religious
			has_character_flag = forsaken_9003
		}
		any_held_county = {
			development_level > 2
			any_province = {
				has_building_or_higher = temple_01
			}
		}
	}

	immediate = {
		random_held_county = {
			limit = { 
				development_level > 2
				any_province = {
					has_building_or_higher = temple_01
				}
			}
			change_development_progress_with_overflow = -125
			save_scope_as = affected_county
		}
		add_character_flag = { 
			flag = forsaken_9003
			days = 1825
		}
	}

	# rebuild the laboratory
	option = { 
		trigger = { 
			OR = { faith = faith:forsaken_cult faith = faith:alchemical_materialism faith = faith:echo_of_life }
		}
		name = forsaken.9003.opt.a
		remove_short_term_gold = medium_gold_value
		scope:affected_county = {
			# placeholder until we add a lab building
			add_county_modifier = {
				modifier = wc_medium_development_growth_factor
				years = 2
			}
		}
		ai_chance = {
			base = 1
			ai_value_modifier = {
				ai_rationality = 1
			}
			modifier = { 
				short_term_gold < medium_gold_value_check
				add = -1000
			}
		}
	}

	# salvage materials
	option = { 
		name = forsaken.9003.opt.b
		add_gold = minor_gold_value
		scope:affected_county = {
			add_county_modifier = {
				modifier = wc_wreckage_salvaging
				years = 2
			}
		}
		ai_chance = {
			base = 1
			ai_value_modifier = {
				ai_greed = 1
			}
		}
	}

	# cast blame on religious minorities
	option = {
		trigger = { 
			any_held_county = {

				NOT = { faith = root.faith }
			}
			NOR = { 
				var:propaganda_campaign ?= flag:religious
				var:propaganda_campaign ?= flag:cultural_and_religious
			} 
		}
		name = forsaken.9003.opt.c
		
		if = { 
			limit = { var:propaganda_campaign ?= flag:cultural }
			custom_tooltip = { 
				text = propaganda_campaign_cultural_and_religious_tooltip
				start_cultural_and_religious_propaganda_campaign = yes
			}
		} else = { 
			custom_tooltip = { 
				text = propaganda_campaign_religious_tooltip
				start_religious_propaganda_campaign = yes
			}
		}
		ai_chance = {
			base = 1
			ai_value_modifier = {
				ai_zeal = 2
			}
		}
	}
}

# neighbor raids 
forsaken.9004 = { 
	type = character_event
	title = forsaken.9004.title
	desc = forsaken.9004.desc
	theme = battle

	right_portrait = { 
		character = root
		animation = rage
	}

	lower_left_portrait = {
		character = scope:raider_source.holder
	}

	trigger = { 

		NOT = { has_character_flag = forsaken_9004 }

		any_held_county = {
			culture = culture:forsaken 
			any_neighboring_county = { 
				NOT = { 
					holder = { is_allied_to = root } # allies won't do this
					culture = culture:forsaken 		 # forsaken won't do this
					AND = {
						# faiths who don't hate undead won't do this...
						OR = { 
							county.faith = { has_doctrine = doctrine_death_magic_accepted }
							county.faith = { has_doctrine = doctrine_death_magic_approved }
						} 
						# ...but demonic and eldritch governments will do this anyway
						holder = { NOR = { has_government = demonic_government has_government = eldritch_government } }
					}
				} 
			} 
		}
	}

	immediate = { 

		add_character_flag = { 
			flag = forsaken_9004
			days = 1825
		}

		random_held_county = { 
			limit = { 
				culture = culture:forsaken
			}
			county = { 
				change_county_control = medium_county_control_loss 
			}
			save_scope_as = raider_target

			random_neighboring_county = { 
				limit = { 
					NOT = { 
						holder = { is_allied_to = root }
						AND = {
							OR = { 
								county.faith = { has_doctrine = doctrine_death_magic_accepted }
								county.faith = { has_doctrine = doctrine_death_magic_approved }
							} 
							holder = { NOR = { has_government = demonic_government has_government = eldritch_government } }
						}
					} 
				} 
				save_scope_as = raider_source
			}
		}
	}

	# divert local levies to defense
	option = { 
		name = forsaken.9004.opt.a

		scope:raider_target = { 
			add_county_modifier = {
				modifier = stewardship_domain_roadside_guard_patrols_modifier 
				years = 2
			}
		}
		ai_chance = {
			base = 0
			ai_value_modifier = {
				ai_boldness = -1
				ai_compassion = 1
				ai_rationality = 1
			}
		}
	}

	# pay money for better walls
	option = { 
		name = forsaken.9004.opt.b

		remove_short_term_gold = medium_gold_value 

		scope:raider_target = { 
			add_county_modifier = {
				modifier = hold_court_8010_fortifications_modifier  
				years = 2
			}
		}
		ai_chance = {
			base = 1
			ai_value_modifier = {
				ai_boldness = -1
				ai_compassion = 1
				ai_honor = 1
			}
			modifier = {
				short_term_gold < medium_gold_value_check
				add = -1000
			}
		}
	}

	option = { 
		name = forsaken.9004.opt.d

		trigger = { 
			any_held_county = {
				county = { 
					NOT = { culture = root.culture }
				}
			}
			NOR = { 
				var:propaganda_campaign ?= flag:cultural
				var:propaganda_campaign ?= flag:cultural_and_religious
			} 
		}
		if = { 
			limit = { var:propaganda_campaign ?= flag:religious }
			custom_tooltip = { 
				text = propaganda_campaign_cultural_and_religious_tooltip
				start_cultural_and_religious_propaganda_campaign = yes
			}
		} else = { 
			custom_tooltip = { 
				text = propaganda_campaign_cultural_tooltip
				start_cultural_propaganda_campaign = yes
			}
		}
		ai_chance = {
			base = 5
			ai_value_modifier = {
				ai_zeal = 5
			}
		}
	}

# raid them back!
	option = { 
		name = forsaken.9004.opt.c

		trigger = { 
			OR = { 
				has_trait = vengeful has_trait = wrathful has_trait = brave 
			}
			scope:raider_source = { development_level > 2 }
		}
		
		duel = {
			skill = martial
			target = scope:raider_source.holder
			
			#You Win
			50 = {
				desc = forsaken.9004.opt.c.duel.win 

				compare_modifier = {
					value = scope:duel_value
					multiplier = 2.5
				}
				modifier = {
					scope:raider_source.holder = { has_trait = craven }
					add = 15
				}
				modifier = {
					scope:raider_source.holder = { has_dread_level_towards = { target = prev level >= 1 } }
					add = 15
				}
				modifier = {
					OR = {
						has_trait = aggressive_attacker
						has_trait = berserker
						has_trait = reaver
						has_trait = organizer
						has_trait = strategist
					}
					add = 20
				}

				scope:raider_source = { 
					holder = {
						send_interface_message = {
							type = event_martial_bad
							title = forsaken.9004.t
							left_icon = root
							show_as_tooltip = { 
								scope:raider_source.county = { 
									change_development_progress_with_overflow = -75 
									change_county_control = medium_county_control_loss
								}
								stress_impact = {
									base = medium_stress_impact_gain
								}
								#desc = forsaken.9004.tt
							}
						}
					}
				}

				hidden_effect = {
					progress_towards_rival_effect = {
						REASON = rival_humiliated
						CHARACTER = scope:raider_source.holder
						OPINION = -15
					}
				}
			
				send_interface_message = {
					type = event_martial_good
					title = forsaken.9004.t
					left_icon = root
					scope:raider_target = {
						county = { 
							change_county_control = minor_county_control_gain
							change_development_progress_with_overflow = 50
						}
					}
					stress_impact = {
						base = minor_stress_impact_loss
					}
				}

				add_gold = minor_gold_value
			}	

			#You Lose
			50 = {
				
				desc = forsaken.9004.opt.c.duel.lose
				
				modifier = {
					has_trait = craven
					add = -15
				}
				modifier = {
					has_trait = wounded
					add = -15
				}
				modifier = { 
					has_trait = flexible_leader
					has_trait = unyielding_defender
					has_trait = organizer
					has_trait = cautious_leader
					has_trait = strategist
					add = 10
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2.5
				}
				send_interface_message = {
					type = event_martial_bad
					title = forsaken.9004.t
					left_icon = scope:root
					show_as_tooltip = { 
						remove_short_term_gold = minor_gold_value
						add_dread = minor_dread_loss
						stress_impact = {
							base = minor_stress_impact_gain
							brave = minor_stress_impact_gain
						}
					}
				}
				
				hidden_effect = {
					progress_towards_rival_effect = {
						REASON = rival_humiliated
						CHARACTER = scope:raider_source.holder
						OPINION = -15
					}
				}
			}
		}
		
		culture = { 
			change_cultural_acceptance = {
				target = scope:raider_source.holder.culture
				value = {
					value = -20
					multiply = scope:raider_source.county.development_level
					divide = 100
				}
				desc = wc_brushfire_conflict
			}		
		}

		stress_impact = {
			craven = medium_stress_impact_gain
			brave = minor_stress_impact_loss
			sadistic = minor_stress_impact_loss
		}

		ai_chance = {
			base = 5
			ai_value_modifier = {
				ai_energy = 2
				ai_boldness = 2
				ai_vengefulness = 2
				ai_honor = 2
			}
			modifier = {
				martial < 9
				add = -99
			}
		}
		
	}
}
