usurp_all_titles_effect = {
	custom_description = {
		text = usurp_all_titles_effect
		object = $TARGET$
		
		save_temporary_scope_as = temp_root
		$TARGET$ = { capital_county ?= { save_temporary_scope_as = temp_capital } }
		
		create_title_and_vassal_change = {
			type = usurped
			save_scope_as = change
			add_claim_on_loss = yes
		}
		$TARGET$ = {
			every_held_title = {
				limit = {
					is_capital_barony = no # They're taken with county
				}
				if = {
					limit = {
						OR = {
							$TAKE_EMPIRE$ = yes

							AND = {
								$TAKE_EMPIRE$ = no
								NOT = {
									tier = tier_empire
								}
							}
						}
					}
					change_title_holder_include_vassals = {
						holder = scope:temp_root
						change = scope:change
						take_baronies = no
					}
				}
			}
		}
	}
}

usurp_entire_title_effect = {
	custom_description = {
		text = usurp_entire_title_effect
		subject = scope:temp_root
		object = $TITLE$
		save_temporary_scope_as = temp_root
		$TARGET$ = { capital_county ?= { save_temporary_scope_as = temp_capital } }

		$TITLE$ = { # Steal all of k_lordaeron
			if = {
				limit = {
					$TAKE_TITLE$ = yes
				}
				change_title_holder_include_vassals = {
					holder = scope:temp_root
					change = scope:change
					take_baronies = no
				}
			}

			every_in_de_jure_hierarchy = {
				limit = {
					exists = holder
					trigger_if = {
						limit = {
							$ONLY_DIRECT$ = yes
						}
						holder = $TARGET$
					}
					trigger_else = {
						holder = {
							is_vassal_or_below_of = $TARGET$
						}
					}
					# NOT = {
					# 	is_capital_barony = no
					# }
				}
				change_title_holder_include_vassals = {
					holder = scope:temp_root
					change = scope:change
					take_baronies = no
				}
			}

			every_in_de_jure_hierarchy = { # Steal any k_lordaeron vassals that are undead
				limit = {
					exists = holder
					NOR = {
						holder = scope:temp_root
						is_capital_barony = no
					}
					holder = {
						highest_held_title_tier >= tier_county
						has_trait = being_undead
					}
				}
				holder = {
					change_liege = {
						liege = scope:temp_root
						change = scope:change
					}
				}
			}
		}

		$TARGET$ = { # Steal all sub-realm titles from target that have an undead ruler
			every_sub_realm_title = {
				limit = {
					holder = {
						liege = {
							NOT = {
								has_trait = being_undead
							}
						}
						highest_held_title_tier >= tier_county
						has_trait = being_undead
					}
				}
				holder = {
					change_liege = {
						liege = scope:temp_root
						change = scope:change
					}
				}
			}
		}
	}
}
usurp_all_titles_resolve_effect = {
	resolve_title_and_vassal_change = scope:change
	
	hidden_effect = { if = { limit = { exists = scope:temp_capital } set_realm_capital = scope:temp_capital } }
}