borrow_loan_goblin_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/goblin_money_borrow.dds" }

	ai_check_interval = 24

	cost = {
		piety = 100
	}

	cooldown = { days = 3650 }

	is_shown = {
		is_landed = yes
		trigger_if = {
			limit = { is_ai = no }
			highest_held_title_tier >= tier_county
		}
		trigger_else = {
			highest_held_title_tier >= tier_duchy
		}
		exists = title:k_goblin_bankers.holder
		NOR = {
			exists = var:loan_amount_owed_goblins
			exists = var:loan_quarters_paid
		}
	}

	is_valid_showing_failures_only = {
		is_available = yes
		trigger_if = {
			limit = { is_ai = yes }
			gold < 100
			custom_tooltip = {
				text = borrow_from_goblin_bankers_gold_condition
				title:k_goblin_bankers.holder = {
					gold >= root.holy_order_gold_value
				}
			}
		}
		custom_tooltip = {
			text = borrow_from_goblin_bankers_gold_condition2
			NOT = { has_character_flag = cannot_take_goblin_loans }
		}
	}

	effect = {
		hidden_effect = {
			title:k_goblin_bankers = {
				holder = {
					save_scope_as = recipient
				}
				add_to_variable_list = { name = debtor_list target = root}
			}
			trigger_event = goblin_loan.200
		}
		title:k_goblin_bankers.holder = { add_prestige = 10 }
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 0
		modifier = {
			add = 25
			has_trait = greedy
		}
		modifier = {
			add = 5
			has_trait = ambitious
		}
		modifier = {
			add = 33
			is_at_war = yes
			gold < 0
		}
		modifier = {
			add = 5
			OR = {
				has_trait = intellect_good_1
				has_trait = intellect_good_2
				has_trait = intellect_good_3
				has_trait = shrewd
				has_trait = architect
				has_trait = administrator
			}
		}
	}
}

##################################################
# Repay Loan Goblin version
# by Linnéa Thimrén and Mayonez_kun :)
##################################################

repay_loan_goblin_decision = {
	picture = { reference = "gfx/interface/illustrations/decisions/goblin_money_borrow.dds" }

	ai_check_interval = 0

	is_shown = {
		exists = var:loan_amount_owed_goblins #loan_amount_owed
		exists = var:loan_quarters_paid #loan_holder
		exists = title:k_goblin_bankers.holder
	}

	is_valid_showing_failures_only = {
		gold >= quarter_of_your_owe_plus_percent
	}

	effect = {
		title:k_goblin_bankers.holder = {
			save_scope_as = recipient
		}
		pay_short_term_gold = {
			gold = quarter_of_your_owe_plus_percent
			target = scope:recipient
		}
		
		change_variable = { name = loan_quarters_paid add = 1 }
		
		if = {
			limit = {
				var:loan_quarters_paid >= 4
			}
			remove_variable = original_debtor
			remove_variable = loan_amount_owed_goblins
			remove_variable = loan_quarters_paid
			title:k_goblin_bankers = {
				remove_list_variable = {
					name = debtor_list
					target = root
				}
			}
			if = { limit = { has_character_flag = defend_four_years } remove_character_flag = defend_four_years }
			if = { limit = { has_character_flag = ask_for_time } remove_character_flag = ask_for_time }
		}
		else = {
			add_character_flag = {
				flag = defend_four_years
				years = 4
			}
		}
	}
	
	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 0
	}
}